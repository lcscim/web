<!DOCTYPE html>
<!-- saved from url=(0056)https://www.cnblogs.com/yuanchenqi/articles/6083427.html -->
<html lang="zh-cn"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="referrer" content="origin">
<title>Django～1 - Yuan先生 - 博客园</title>
<meta property="og:description" content="一 什么是web框架？ 框架，即framework，特指为解决一个开放性问题而设计的具有一定约束性的支撑结构，使用框架可以帮你快速开发特定的系统，简单地说，就是你用别人搭建好的舞台来做表演。 对于所有">
<link type="text/css" rel="stylesheet" href="./Web框架Django_files/blog-common.css">
<link id="MainCss" type="text/css" rel="stylesheet" href="./Web框架Django_files/bundle-summerGarden.css">
<link type="text/css" rel="stylesheet" href="./Web框架Django_files/262677.css">
<link id="mobile-style" media="only screen and (max-width: 767px)" type="text/css" rel="stylesheet" href="./Web框架Django_files/bundle-summerGarden-mobile.css">
<link title="RSS" type="application/rss+xml" rel="alternate" href="https://www.cnblogs.com/yuanchenqi/rss">
<link title="RSD" type="application/rsd+xml" rel="EditURI" href="https://www.cnblogs.com/yuanchenqi/rsd.xml">
<link type="application/wlwmanifest+xml" rel="wlwmanifest" href="https://www.cnblogs.com/yuanchenqi/wlwmanifest.xml">
<script async="" src="./Web框架Django_files/analytics.js.下载"></script><script type="text/javascript" src="./Web框架Django_files/encoder.js.下载"></script><script src="./Web框架Django_files/jquery-2.2.0.min.js.下载"></script><style type="text/css" abt="234"></style>
<script type="text/javascript">var currentBlogApp = 'yuanchenqi', cb_enable_mathjax=false;var isLogined=false;</script>
<script src="./Web框架Django_files/blog-common.js.下载" type="text/javascript"></script>
<link rel="preload" href="./Web框架Django_files/f.txt" as="script"><script type="text/javascript" src="./Web框架Django_files/f.txt"></script><script src="./Web框架Django_files/pubads_impl_263.js.下载" async=""></script><script>//remove 17173 video ad
doAdblock();
function doAdblock(){
    (function() {
        function A() {}
        A.prototype = {
            rules: {
                '17173_in':{
                    'find':/http:\/\/f\.v\.17173cdn\.com\/(\d+\/)?flash\/PreloaderFile(Customer)?\.swf/,
                    'replace':"http://swf.adtchrome.com/17173_in_20150522.swf"
                },
                '17173_out':{
                    'find':/http:\/\/f\.v\.17173cdn\.com\/(\d+\/)?flash\/PreloaderFileFirstpage\.swf/,
                    'replace':"http://swf.adtchrome.com/17173_out_20150522.swf"
                },
                '17173_live':{
                    'find':/http:\/\/f\.v\.17173cdn\.com\/(\d+\/)?flash\/Player_stream(_firstpage)?\.swf/,
                    'replace':"http://swf.adtchrome.com/17173_stream_20150522.swf"
                },
                '17173_live_out':{
                    'find':/http:\/\/f\.v\.17173cdn\.com\/(\d+\/)?flash\/Player_stream_(custom)?Out\.swf/,
                    'replace':"http://swf.adtchrome.com/17173.out.Live.swf"
                }
            },
            _done: null,
            get done() {
                if(!this._done) {
                    this._done = new Array();
                }
                return this._done;
            },
            addAnimations: function() {
                var style = document.createElement('style');
                style.type = 'text/css';
                style.innerHTML = 'object,embed{\
                -webkit-animation-duration:.001s;-webkit-animation-name:playerInserted;\
                -ms-animation-duration:.001s;-ms-animation-name:playerInserted;\
                -o-animation-duration:.001s;-o-animation-name:playerInserted;\
                animation-duration:.001s;animation-name:playerInserted;}\
                @-webkit-keyframes playerInserted{from{opacity:0.99;}to{opacity:1;}}\
                @-ms-keyframes playerInserted{from{opacity:0.99;}to{opacity:1;}}\
                @-o-keyframes playerInserted{from{opacity:0.99;}to{opacity:1;}}\
                @keyframes playerInserted{from{opacity:0.99;}to{opacity:1;}}';
                document.getElementsByTagName('head')[0].appendChild(style);
            },
            animationsHandler: function(e) {
                if(e.animationName === 'playerInserted') {
                    this.replace(e.target);
                }
            },
            replace: function(elem) {
                if(this.done.indexOf(elem) != -1) return;
                this.done.push(elem);
                var player = elem.data || elem.src;
                if(!player) return;
                var i, find, replace = false;
                for(i in this.rules) {
                    find = this.rules[i]['find'];
                    if(find.test(player)) {
                        replace = this.rules[i]['replace'];
                        if('function' === typeof this.rules[i]['preHandle']) {
                            this.rules[i]['preHandle'].bind(this, elem, find, replace, player)();
                        }else{
                            this.reallyReplace.bind(this, elem, find, replace)();
                        }
                        break;
                    }
                }
            },
            reallyReplace: function(elem, find, replace) {
                elem.data && (elem.data = elem.data.replace(find, replace)) || elem.src && ((elem.src = elem.src.replace(find, replace)) && (elem.style.display = 'block'));
                var b = elem.querySelector("param[name='movie']");
                this.reloadPlugin(elem);
            },
            reloadPlugin: function(elem) {
                var nextSibling = elem.nextSibling;
                var parentNode = elem.parentNode;
                parentNode.removeChild(elem);
                var newElem = elem.cloneNode(true);
                this.done.push(newElem);
                if(nextSibling) {
                    parentNode.insertBefore(newElem, nextSibling);
                } else {
                    parentNode.appendChild(newElem);
                }
            },
            init: function() {
                var handler = this.animationsHandler.bind(this);
                document.body.addEventListener('webkitAnimationStart', handler, false);
                document.body.addEventListener('msAnimationStart', handler, false);
                document.body.addEventListener('oAnimationStart', handler, false);
                document.body.addEventListener('animationstart', handler, false);
                this.addAnimations();
            }
        };
        new A().init();
    })();
}
//remove baidu search ad
if(document.URL.indexOf('www.baidu.com') >= 0){
    if(document && document.getElementsByTagName && document.getElementById && document.body){
        var aa = function(){
            var all = document.body.querySelectorAll("#content_left div,#content_left table");
            for(var i = 0; i < all.length; i++){
                if(/display:\s?(table|block)\s!important/.test(all[i].getAttribute("style"))){all[i].style.display= "none";all[i].style.visibility='hidden';}
            }
            all = document.body.querySelectorAll('.result.c-container[id="1"]');
            //if(all.length == 1) return;
            for(var i = 0; i < all.length; i++){
                if(all[i].innerHTML && all[i].innerHTML.indexOf('广告')>-1){
                    all[i].style.display= "none";all[i].style.visibility='hidden';
                }
            }
        }
        aa();
        document.getElementById('wrapper_wrapper').addEventListener('DOMSubtreeModified',aa)
    };
}
//remove sohu video ad
if (document.URL.indexOf("tv.sohu.com") >= 0){
    if (document.cookie.indexOf("fee_status=true")==-1){document.cookie='fee_status=true'};
}
//remove 56.com video ad
if (document.URL.indexOf("56.com") >= 0){
    if (document.cookie.indexOf("fee_status=true")==-1){document.cookie='fee_status=true'};
}
//fore iqiyi enable html5 player function
if (document.URL.indexOf("iqiyi.com") >= 0){
    if (document.cookie.indexOf("player_forcedType=h5_VOD")==-1){
        document.cookie='player_forcedType=h5_VOD'
        if(localStorage.reloadTime && Date.now() - parseInt(localStorage.reloadTime)<60000){
            console.log('no reload')
        }else{
            location.reload()
            localStorage.reloadTime = Date.now();
        }
    }
}
</script><style type="text/css">object,embed{                -webkit-animation-duration:.001s;-webkit-animation-name:playerInserted;                -ms-animation-duration:.001s;-ms-animation-name:playerInserted;                -o-animation-duration:.001s;-o-animation-name:playerInserted;                animation-duration:.001s;animation-name:playerInserted;}                @-webkit-keyframes playerInserted{from{opacity:0.99;}to{opacity:1;}}                @-ms-keyframes playerInserted{from{opacity:0.99;}to{opacity:1;}}                @-o-keyframes playerInserted{from{opacity:0.99;}to{opacity:1;}}                @keyframes playerInserted{from{opacity:0.99;}to{opacity:1;}}</style></head>
<body>
<a name="top"></a>

<!--done-->
<div id="home">
<div id="header">
	<div id="blogTitle">
	<a id="lnkBlogLogo" href="https://www.cnblogs.com/yuanchenqi/"><img id="blogLogo" src="./Web框架Django_files/logo.gif" alt="返回主页"></a>			
		
<!--done-->
<h1><a id="Header1_HeaderTitle" class="headermaintitle" href="https://i.cnblogs.com/EditArticles.aspx">Yuan先生</a></h1>
<h2></h2>



		
	</div><!--end: blogTitle 博客的标题和副标题 -->
	<div id="navigator">
		
<ul id="navList">
	<li></li>
	<li></li>
	<li><a href="http://news.cnblogs.com/">新闻</a></li>
	<li></li>
	<li></li>
	<li><a id="blog_nav_admin" class="menu" rel="nofollow" href="https://i.cnblogs.com/">管理</a></li>
	<li>
	</li>
</ul>


		<div class="blogStats">
			
			
			
		</div><!--end: blogStats -->
	</div><!--end: navigator 博客导航栏 -->
</div><!--end: header 头部 -->

<div id="main">
	<div id="mainContent">
	<div class="forFlow">
		
<div id="post_detail">
<!--done-->
<div id="topics">
	<div class="post">
		<h1 class="postTitle">
			<a id="cb_post_title_url" class="postTitle2" href="https://www.cnblogs.com/yuanchenqi/articles/6083427.html">Django～1</a>
		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body" class="blogpost-body"><h3>一 什么是web框架？</h3>
<p>框架，即framework，特指为解决一个开放性问题而设计的具有一定约束性的支撑结构，使用框架可以帮你快速开发特定的系统，简单地说，就是你用别人搭建好的舞台来做表演。</p>
<p>对于所有的Web应用，本质上其实就是一个socket服务端，用户的浏览器其实就是一个socket客户端。</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;38f4151e-2991-4a80-9de1-ea4e3dd92ad6&#39;)"><img id="code_img_closed_38f4151e-2991-4a80-9de1-ea4e3dd92ad6" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_38f4151e-2991-4a80-9de1-ea4e3dd92ad6" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;38f4151e-2991-4a80-9de1-ea4e3dd92ad6&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_38f4151e-2991-4a80-9de1-ea4e3dd92ad6" class="cnblogs_code_hide">
<pre><span style="color: #000000;">import socket

def handle_request(client):

    buf </span>= client.recv(<span style="color: #800080;">1024</span><span style="color: #000000;">)
    client.send(</span><span style="color: #800000;">"</span><span style="color: #800000;">HTTP/1.1 200 OK\r\n\r\n</span><span style="color: #800000;">"</span>.encode(<span style="color: #800000;">"</span><span style="color: #800000;">utf8</span><span style="color: #800000;">"</span><span style="color: #000000;">))
    client.send(</span><span style="color: #800000;">"</span><span style="color: #800000;">&lt;h1 style='color:red'&gt;Hello, yuan&lt;/h1&gt;</span><span style="color: #800000;">"</span>.encode(<span style="color: #800000;">"</span><span style="color: #800000;">utf8</span><span style="color: #800000;">"</span><span style="color: #000000;">))

def main():

    sock </span>=<span style="color: #000000;"> socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    sock.bind((</span><span style="color: #800000;">'</span><span style="color: #800000;">localhost</span><span style="color: #800000;">'</span>,<span style="color: #800080;">8001</span><span style="color: #000000;">))
    sock.listen(</span><span style="color: #800080;">5</span><span style="color: #000000;">)

    </span><span style="color: #0000ff;">while</span><span style="color: #000000;"> True:
        connection, address </span>=<span style="color: #000000;"> sock.accept()
        handle_request(connection)
        connection.close()

</span><span style="color: #0000ff;">if</span> __name__ == <span style="color: #800000;">'</span><span style="color: #800000;">__main__</span><span style="color: #800000;">'</span><span style="color: #000000;">:

    main()</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 最简单的Web应用就是先把HTML用文件保存好，用一个现成的HTTP服务器软件，接收用户请求，从文件中读取HTML，返回。</p>
<p>如果要动态生成HTML，就需要把上述步骤自己来实现。不过，接受HTTP请求、解析HTTP请求、发送HTTP响应都是苦力活，如果我们自己来写这些底层代码，还没开始写动态HTML呢，就得花个把月去读HTTP规范。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 正确的做法是底层代码由专门的服务器软件实现，我们用Python专注于生成HTML文档。因为我们不希望接触到TCP连接、HTTP原始请求和响应格式，所以，需要一个统一的接口，让我们专心用Python编写Web业务。</p>
<p>这个接口就是WSGI：Web Server Gateway Interface。</p>
<p><strong><span style="font-size: 15px; color: #800080;">-----------------------------<span style="color: #4164bd; font-size: 18px;">Do a web&nbsp; framework ourselves</span><strong><span style="font-size: 15px; color: #800080;">---------------------------</span></strong></span></strong></p>
<h4>step 1:</h4>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;1431c825-7fbe-41c5-8a7b-98cde4c624e5&#39;)"><img id="code_img_closed_1431c825-7fbe-41c5-8a7b-98cde4c624e5" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_1431c825-7fbe-41c5-8a7b-98cde4c624e5" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;1431c825-7fbe-41c5-8a7b-98cde4c624e5&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_1431c825-7fbe-41c5-8a7b-98cde4c624e5" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">from</span><span style="color: #000000;"> wsgiref.simple_server import make_server


def application(environ, start_response):
    start_response(</span><span style="color: #800000;">'</span><span style="color: #800000;">200 OK</span><span style="color: #800000;">'</span>, [(<span style="color: #800000;">'</span><span style="color: #800000;">Content-Type</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">text/html</span><span style="color: #800000;">'</span><span style="color: #000000;">)])
    </span><span style="color: #0000ff;">return</span> [b<span style="color: #800000;">'</span><span style="color: #800000;">&lt;h1&gt;Hello, web!&lt;/h1&gt;</span><span style="color: #800000;">'</span><span style="color: #000000;">]


httpd </span>= make_server(<span style="color: #800000;">''</span>, <span style="color: #800080;">8080</span><span style="color: #000000;">, application)

print(</span><span style="color: #800000;">'</span><span style="color: #800000;">Serving HTTP on port 8000...</span><span style="color: #800000;">'</span><span style="color: #000000;">)
# 开始监听HTTP请求:
httpd.serve_forever()</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>注意：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;32b586d5-fe39-4983-b2e8-a21991b92456&#39;)"><img id="code_img_closed_32b586d5-fe39-4983-b2e8-a21991b92456" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_32b586d5-fe39-4983-b2e8-a21991b92456" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;32b586d5-fe39-4983-b2e8-a21991b92456&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_32b586d5-fe39-4983-b2e8-a21991b92456" class="cnblogs_code_hide">
<pre><span style="color: #000000;">整个application()函数本身没有涉及到任何解析HTTP的部分，也就是说，底层代码不需要我们自己编写，
我们只负责在更高层次上考虑如何响应请求就可以了。

application()函数必须由WSGI服务器来调用。有很多符合WSGI规范的服务器，我们可以挑选一个来用。

Python内置了一个WSGI服务器，这个模块叫wsgiref    
    
    
application()函数就是符合WSGI标准的一个HTTP处理函数，它接收两个参数：

        </span>//<span style="color: #000000;">environ：一个包含所有HTTP请求信息的dict对象；
        
        </span>//<span style="color: #000000;">start_response：一个发送HTTP响应的函数。

在application()函数中，调用：

start_response(</span><span style="color: #800000;">'</span><span style="color: #800000;">200 OK</span><span style="color: #800000;">'</span>, [(<span style="color: #800000;">'</span><span style="color: #800000;">Content-Type</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">text/html</span><span style="color: #800000;">'</span><span style="color: #000000;">)])

就发送了HTTP响应的Header，注意Header只能发送一次，也就是只能调用一次start_response()函数。
start_response()函数接收两个参数，一个是HTTP响应码，一个是一组list表示的HTTP Header，每
个Header用一个包含两个str的tuple表示。

通常情况下，都应该把Content</span>-<span style="color: #000000;">Type头发送给浏览器。其他很多常用的HTTP Header也应该发送。

然后，函数的返回值b</span><span style="color: #800000;">'</span><span style="color: #800000;">&lt;h1&gt;Hello, web!&lt;/h1&gt;</span><span style="color: #800000;">'</span><span style="color: #000000;">将作为HTTP响应的Body发送给浏览器。

有了WSGI，我们关心的就是如何从environ这个dict对象拿到HTTP请求信息，然后构造HTML，
通过start_response()发送Header，最后返回Body。</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h4>step 2</h4>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;c8cf8ea7-58dc-4e5b-8853-93eb543eda52&#39;)"><img id="code_img_closed_c8cf8ea7-58dc-4e5b-8853-93eb543eda52" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_c8cf8ea7-58dc-4e5b-8853-93eb543eda52" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;c8cf8ea7-58dc-4e5b-8853-93eb543eda52&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_c8cf8ea7-58dc-4e5b-8853-93eb543eda52" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">print</span>(environ[<span style="color: #800000;">'</span><span style="color: #800000;">PATH_INFO</span><span style="color: #800000;">'</span><span style="color: #000000;">])
    path</span>=environ[<span style="color: #800000;">'</span><span style="color: #800000;">PATH_INFO</span><span style="color: #800000;">'</span><span style="color: #000000;">]
    start_response(</span><span style="color: #800000;">'</span><span style="color: #800000;">200 OK</span><span style="color: #800000;">'</span>, [(<span style="color: #800000;">'</span><span style="color: #800000;">Content-Type</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">text/html</span><span style="color: #800000;">'</span><span style="color: #000000;">)])
    f1</span>=open(<span style="color: #800000;">"</span><span style="color: #800000;">index1.html</span><span style="color: #800000;">"</span>,<span style="color: #800000;">"</span><span style="color: #800000;">rb</span><span style="color: #800000;">"</span><span style="color: #000000;">)
    data1</span>=<span style="color: #000000;">f1.read()
    f2</span>=open(<span style="color: #800000;">"</span><span style="color: #800000;">index2.html</span><span style="color: #800000;">"</span>,<span style="color: #800000;">"</span><span style="color: #800000;">rb</span><span style="color: #800000;">"</span><span style="color: #000000;">)
    data2</span>=<span style="color: #000000;">f2.read()

    </span><span style="color: #0000ff;">if</span> path==<span style="color: #800000;">"</span><span style="color: #800000;">/yuan</span><span style="color: #800000;">"</span><span style="color: #000000;">:
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> [data1]
    </span><span style="color: #0000ff;">elif</span> path==<span style="color: #800000;">"</span><span style="color: #800000;">/alex</span><span style="color: #800000;">"</span><span style="color: #000000;">:
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> [data2]
    </span><span style="color: #0000ff;">else</span><span style="color: #000000;">:
        </span><span style="color: #0000ff;">return</span> [<span style="color: #800000;">"</span><span style="color: #800000;">&lt;h1&gt;404&lt;/h1&gt;</span><span style="color: #800000;">"</span>.encode(<span style="color: #800000;">'</span><span style="color: #800000;">utf8</span><span style="color: #800000;">'</span>)]</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h4>step3</h4>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;d477dfc2-0984-41c1-a747-a69df50994a4&#39;)"><img id="code_img_closed_d477dfc2-0984-41c1-a747-a69df50994a4" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_d477dfc2-0984-41c1-a747-a69df50994a4" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;d477dfc2-0984-41c1-a747-a69df50994a4&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_d477dfc2-0984-41c1-a747-a69df50994a4" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">from</span> wsgiref.simple_server <span style="color: #0000ff;">import</span><span style="color: #000000;"> make_server

</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> f1():
    f1</span>=open(<span style="color: #800000;">"</span><span style="color: #800000;">index1.html</span><span style="color: #800000;">"</span>,<span style="color: #800000;">"</span><span style="color: #800000;">rb</span><span style="color: #800000;">"</span><span style="color: #000000;">)
    data1</span>=<span style="color: #000000;">f1.read()
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> [data1]

</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> f2():
    f2</span>=open(<span style="color: #800000;">"</span><span style="color: #800000;">index2.html</span><span style="color: #800000;">"</span>,<span style="color: #800000;">"</span><span style="color: #800000;">rb</span><span style="color: #800000;">"</span><span style="color: #000000;">)
    data2</span>=<span style="color: #000000;">f2.read()
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> [data2]

</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> application(environ, start_response):

    </span><span style="color: #0000ff;">print</span>(environ[<span style="color: #800000;">'</span><span style="color: #800000;">PATH_INFO</span><span style="color: #800000;">'</span><span style="color: #000000;">])
    path</span>=environ[<span style="color: #800000;">'</span><span style="color: #800000;">PATH_INFO</span><span style="color: #800000;">'</span><span style="color: #000000;">]
    start_response(</span><span style="color: #800000;">'</span><span style="color: #800000;">200 OK</span><span style="color: #800000;">'</span>, [(<span style="color: #800000;">'</span><span style="color: #800000;">Content-Type</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">text/html</span><span style="color: #800000;">'</span><span style="color: #000000;">)])


    </span><span style="color: #0000ff;">if</span> path==<span style="color: #800000;">"</span><span style="color: #800000;">/yuan</span><span style="color: #800000;">"</span><span style="color: #000000;">:
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> f1()

    </span><span style="color: #0000ff;">elif</span> path==<span style="color: #800000;">"</span><span style="color: #800000;">/alex</span><span style="color: #800000;">"</span><span style="color: #000000;">:
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> f2()

    </span><span style="color: #0000ff;">else</span><span style="color: #000000;">:
        </span><span style="color: #0000ff;">return</span> [<span style="color: #800000;">"</span><span style="color: #800000;">&lt;h1&gt;404&lt;/h1&gt;</span><span style="color: #800000;">"</span>.encode(<span style="color: #800000;">"</span><span style="color: #800000;">utf8</span><span style="color: #800000;">"</span><span style="color: #000000;">)]


httpd </span>= make_server(<span style="color: #800000;">''</span>, 8502<span style="color: #000000;">, application)

</span><span style="color: #0000ff;">print</span>(<span style="color: #800000;">'</span><span style="color: #800000;">Serving HTTP on port 8084...</span><span style="color: #800000;">'</span><span style="color: #000000;">)

</span><span style="color: #008000;">#</span><span style="color: #008000;"> 开始监听HTTP请求:</span>
httpd.serve_forever()</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h4>step4</h4>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;6cc7c8e8-8aaa-4f5b-9d57-05b943d673ed&#39;)"><img id="code_img_closed_6cc7c8e8-8aaa-4f5b-9d57-05b943d673ed" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_6cc7c8e8-8aaa-4f5b-9d57-05b943d673ed" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;6cc7c8e8-8aaa-4f5b-9d57-05b943d673ed&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_6cc7c8e8-8aaa-4f5b-9d57-05b943d673ed" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">from</span> wsgiref.simple_server <span style="color: #0000ff;">import</span><span style="color: #000000;"> make_server


</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> f1(req):
    </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(req)
    </span><span style="color: #0000ff;">print</span>(req[<span style="color: #800000;">"</span><span style="color: #800000;">QUERY_STRING</span><span style="color: #800000;">"</span><span style="color: #000000;">])

    f1</span>=open(<span style="color: #800000;">"</span><span style="color: #800000;">index1.html</span><span style="color: #800000;">"</span>,<span style="color: #800000;">"</span><span style="color: #800000;">rb</span><span style="color: #800000;">"</span><span style="color: #000000;">)
    data1</span>=<span style="color: #000000;">f1.read()
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> [data1]

</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> f2(req):

    f2</span>=open(<span style="color: #800000;">"</span><span style="color: #800000;">index2.html</span><span style="color: #800000;">"</span>,<span style="color: #800000;">"</span><span style="color: #800000;">rb</span><span style="color: #800000;">"</span><span style="color: #000000;">)
    data2</span>=<span style="color: #000000;">f2.read()
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> [data2]

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> time

</span><span style="color: #0000ff;">def</span> f3(req):        <span style="color: #008000;">#</span><span style="color: #008000;">模版以及数据库</span>
<span style="color: #000000;">
    f3</span>=open(<span style="color: #800000;">"</span><span style="color: #800000;">index3.html</span><span style="color: #800000;">"</span>,<span style="color: #800000;">"</span><span style="color: #800000;">rb</span><span style="color: #800000;">"</span><span style="color: #000000;">)
    data3</span>=<span style="color: #000000;">f3.read()
    times</span>=time.strftime(<span style="color: #800000;">"</span><span style="color: #800000;">%Y-%m-%d %X</span><span style="color: #800000;">"</span><span style="color: #000000;">, time.localtime())
    data3</span>=str(data3,<span style="color: #800000;">"</span><span style="color: #800000;">utf8</span><span style="color: #800000;">"</span>).replace(<span style="color: #800000;">"</span><span style="color: #800000;">!time!</span><span style="color: #800000;">"</span><span style="color: #000000;">,str(times))


    </span><span style="color: #0000ff;">return</span> [data3.encode(<span style="color: #800000;">"</span><span style="color: #800000;">utf8</span><span style="color: #800000;">"</span><span style="color: #000000;">)]


</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> routers():

    urlpatterns </span>=<span style="color: #000000;"> (
        (</span><span style="color: #800000;">'</span><span style="color: #800000;">/yuan</span><span style="color: #800000;">'</span><span style="color: #000000;">,f1),
        (</span><span style="color: #800000;">'</span><span style="color: #800000;">/alex</span><span style="color: #800000;">'</span><span style="color: #000000;">,f2),
        (</span><span style="color: #800000;">"</span><span style="color: #800000;">/cur_time</span><span style="color: #800000;">"</span><span style="color: #000000;">,f3)
    )
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> urlpatterns


</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> application(environ, start_response):

    </span><span style="color: #0000ff;">print</span>(environ[<span style="color: #800000;">'</span><span style="color: #800000;">PATH_INFO</span><span style="color: #800000;">'</span><span style="color: #000000;">])
    path</span>=environ[<span style="color: #800000;">'</span><span style="color: #800000;">PATH_INFO</span><span style="color: #800000;">'</span><span style="color: #000000;">]
    start_response(</span><span style="color: #800000;">'</span><span style="color: #800000;">200 OK</span><span style="color: #800000;">'</span>, [(<span style="color: #800000;">'</span><span style="color: #800000;">Content-Type</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">text/html</span><span style="color: #800000;">'</span><span style="color: #000000;">)])


    urlpatterns </span>=<span style="color: #000000;"> routers()
    func </span>=<span style="color: #000000;"> None
    </span><span style="color: #0000ff;">for</span> item <span style="color: #0000ff;">in</span><span style="color: #000000;"> urlpatterns:
        </span><span style="color: #0000ff;">if</span> item[0] ==<span style="color: #000000;"> path:
            func </span>= item[1<span style="color: #000000;">]
            </span><span style="color: #0000ff;">break</span>
    <span style="color: #0000ff;">if</span><span style="color: #000000;"> func:
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> func(environ)
    </span><span style="color: #0000ff;">else</span><span style="color: #000000;">:
        </span><span style="color: #0000ff;">return</span> [<span style="color: #800000;">"</span><span style="color: #800000;">&lt;h1&gt;404&lt;/h1&gt;</span><span style="color: #800000;">"</span>.encode(<span style="color: #800000;">"</span><span style="color: #800000;">utf8</span><span style="color: #800000;">"</span><span style="color: #000000;">)]

httpd </span>= make_server(<span style="color: #800000;">''</span>, 8518<span style="color: #000000;">, application)

</span><span style="color: #0000ff;">print</span>(<span style="color: #800000;">'</span><span style="color: #800000;">Serving HTTP on port 8084...</span><span style="color: #800000;">'</span><span style="color: #000000;">)

</span><span style="color: #008000;">#</span><span style="color: #008000;"> 开始监听HTTP请求:</span>
<span style="color: #000000;">
httpd.serve_forever()</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>伙计们，不知不觉我们自己已经写出一个web框架啦！</p>
<h3>二 MVC和MTV模式</h3>
<p>著名的MVC模式：所谓MVC就是把web应用分为模型(M),控制器(C),视图(V)三层；他们之间以一种插件似的，松耦合的方式连接在一起。</p>
<p>模型负责业务对象与数据库的对象(ORM),视图负责与用户的交互(页面)，控制器(C)接受用户的输入调用模型和视图完成用户的请求。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <img src="./Web框架Django_files/877318-20161120225443185-1471035329.png" alt="" width="327" height="244"></p>
<p>Django的MTV模式本质上与MVC模式没有什么差别，也是各组件之间为了保持松耦合关系，只是定义上有些许不同，Django的MTV分别代表：</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp;Model(模型)：负责业务对象与数据库的对象(ORM)</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp;Template(模版)：负责如何把页面展示给用户</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp;View(视图)：负责业务逻辑，并在适当的时候调用Model和Template</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp;此外，Django还有一个url分发器，它的作用是将一个个URL的页面请求分发给不同的view处理，view再调用相应的Model和Template</p>
<p><img src="./Web框架Django_files/877318-20161120225842607-1712687818.png" alt="" width="699" height="341"></p>
<h3>&nbsp;三 django的流程和命令行工具</h3>
<h4><strong>django</strong>实现流程</h4>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;eb7fb9b3-6376-4c3e-a01e-ed503f95a705&#39;)"><img id="code_img_closed_eb7fb9b3-6376-4c3e-a01e-ed503f95a705" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_eb7fb9b3-6376-4c3e-a01e-ed503f95a705" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;eb7fb9b3-6376-4c3e-a01e-ed503f95a705&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_eb7fb9b3-6376-4c3e-a01e-ed503f95a705" class="cnblogs_code_hide">
<pre><span style="color: #000000;">django
    </span><span style="color: #008000;">#</span><span style="color: #008000;">安装： pip3 install django</span>
<span style="color: #000000;">
          添加环境变量

    </span><span style="color: #008000;">#</span><span style="color: #008000;">1  创建project</span>
       django-<span style="color: #000000;">admin startproject mysite

       </span>---<span style="color: #000000;">mysite

          </span>---<span style="color: #000000;">settings.py
          </span>---<span style="color: #000000;">url.py
          </span>---<span style="color: #000000;">wsgi.py

       </span>----<span style="color: #000000;"> manage.py(启动文件)  

    </span><span style="color: #008000;">#</span><span style="color: #008000;">2  创建APP       </span>
<span style="color: #000000;">       python mannage.py startapp  app01

    </span><span style="color: #008000;">#</span><span style="color: #008000;">3  settings配置</span>
<span style="color: #000000;">    
       TEMPLATES

       STATICFILES_DIRS</span>=<span style="color: #000000;">(
            os.path.join(BASE_DIR,</span><span style="color: #800000;">"</span><span style="color: #800000;">statics</span><span style="color: #800000;">"</span><span style="color: #000000;">),
        )

       STATIC_URL </span>= <span style="color: #800000;">'</span><span style="color: #800000;">/static/</span><span style="color: #800000;">'</span> 
       <span style="color: #008000;">#</span><span style="color: #008000;">  我们只能用 STATIC_URL，但STATIC_URL会按着你的STATICFILES_DIRS去找#4  根据需求设计代码</span>
<span style="color: #000000;">           url.py
           view.py

    </span><span style="color: #008000;">#</span><span style="color: #008000;">5  使用模版</span>
       render(req,<span style="color: #800000;">"</span><span style="color: #800000;">index.html</span><span style="color: #800000;">"</span><span style="color: #000000;">)   

    </span><span style="color: #008000;">#</span><span style="color: #008000;">6  启动项目</span>
       python manage.py runserver  127.0.0.1:8090

    <span style="color: #008000;">#</span><span style="color: #008000;">7  连接数据库，操作数据</span>
       model.py</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h4><strong>django的命令行工具</strong></h4>
<p>django-admin.py 是Django的一个用于管理任务的命令行工具，manage.py是对django－admin.py的简单包装,每一个Django Project里都会有一个mannage.py。</p>
<p>&lt;1&gt; 创建一个django工程 : django-admin.py startproject mysite</p>
<p>&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; 当前目录下会生成mysite的工程，目录结构如下：</p>
<p>&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; <img src="./Web框架Django_files/877318-20160724114201404-1121087959.png" alt="" width="239" height="181"></p>
<ul>
<li class="p0">manage.py&nbsp;-----&nbsp;Django项目里面的工具，通过它可以调用django&nbsp;shell和数据库等。</li>
<li class="p0">settings.py&nbsp;----&nbsp;包含了项目的默认设置，包括数据库信息，调试标志以及其他一些工作的变量。</li>
<li class="p0">urls.py&nbsp;-----&nbsp;负责把URL模式映射到应用程序。</li>
</ul>
<p>&lt;2&gt;在mysite目录下创建blog应用:&nbsp;python manage.py startapp blog</p>
<p>&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; <img src="./Web框架Django_files/877318-20160724114930826-472002646.png" alt="" width="197" height="193"></p>
<p>&lt;3&gt;启动django项目：python manage.py runserver 8080</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp;这样我们的django就启动起来了！当我们访问：http://127.0.0.1:8080/时就可以看到：</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp;<img src="./Web框架Django_files/877318-20160724120547497-22629173.png" alt="" width="543" height="92"></p>
<p>&lt;4&gt;生成同步数据库的脚本：python&nbsp;manage.py&nbsp;makemigrations &nbsp;</p>
<p><strong>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp; </strong>同步数据库: &nbsp;python&nbsp;manage.py&nbsp;migrate &nbsp;&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #000080;">注意：在开发过程中，数据库同步误操作之后，难免会遇到后面不能同步成功的情况，解决这个问题的一个简单粗暴方法是把migrations目录下</span></p>
<p><span style="color: #ff0000;"><span style="color: #000080;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;的脚本（除__init__.py之外）全部删掉，再把数据库删掉之后创建一个新的数据库，数据库同步操作再重新做一遍。 &nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></p>
<p>&lt;5&gt;当我们访问http://127.0.0.1:8080/admin/时，会出现：</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp;<img src="./Web框架Django_files/877318-20160724122151841-768137904.png" alt="" width="503" height="293"></p>
<p>&nbsp; &nbsp; &nbsp; &nbsp;所以我们需要为进入这个项目的后台创建超级管理员：python&nbsp;manage.py&nbsp;createsuperuser<span style="color: #000000;"><strong><span style="font-size: 18px; color: #ff6600;"><span style="color: #000000; font-size: 15px;">，</span></span></strong><span style="font-size: 18px; color: #ff6600;"><span style="color: #000000; font-size: 15px;"><span style="font-size: 14px;">设置好用户名和密码后便可登录啦！</span></span></span></span></p>
<p>&lt;6&gt;清空数据库：python&nbsp;manage.py&nbsp; flush</p>
<p>&lt;7&gt;查询某个命令的详细信息： django-admin.py &nbsp;help&nbsp; startapp</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp;admin&nbsp;是Django&nbsp;自带的一个后台数据库管理系统。</p>
<p>&lt;8&gt;启动交互界面 ：python&nbsp;manage.py&nbsp;&nbsp;shell</p>
<p><span style="color: #ff6600; font-size: 18px;"><strong>&nbsp; &nbsp; </strong><span style="font-size: 14px;">&nbsp;<span style="color: #800080;">这个命令和直接运行 python 进入 shell 的区别是：你可以在这个 shell 里面调用当前项目的 models.py 中的 API，对于操作数据，还有一些小测试非常方便。</span></span></span></p>
<p>&lt;9&gt;<strong>&nbsp;</strong>终端上输入python&nbsp;manage.py&nbsp;可以看到详细的列表，在忘记子名称的时候特别有用<strong>。</strong></p>
<h4><strong>实例练习1－提交数据并展示</strong></h4>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;27e0f705-d049-4155-89ba-2dd867b0c3b1&#39;)"><img id="code_img_closed_27e0f705-d049-4155-89ba-2dd867b0c3b1" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_27e0f705-d049-4155-89ba-2dd867b0c3b1" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;27e0f705-d049-4155-89ba-2dd867b0c3b1&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_27e0f705-d049-4155-89ba-2dd867b0c3b1" class="cnblogs_code_hide">
<pre>&lt;!DOCTYPE html&gt;
&lt;html lang=<span style="color: #800000;">"</span><span style="color: #800000;">en</span><span style="color: #800000;">"</span>&gt;
&lt;head&gt;
    &lt;meta charset=<span style="color: #800000;">"</span><span style="color: #800000;">UTF-8</span><span style="color: #800000;">"</span>&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;创建个人信息&lt;/h1&gt;

&lt;form action=<span style="color: #800000;">"</span><span style="color: #800000;">/userInfor/</span><span style="color: #800000;">"</span> method=<span style="color: #800000;">"</span><span style="color: #800000;">post</span><span style="color: #800000;">"</span>&gt;

    &lt;p&gt;姓名&lt;input type=<span style="color: #800000;">"</span><span style="color: #800000;">text</span><span style="color: #800000;">"</span> name=<span style="color: #800000;">"</span><span style="color: #800000;">username</span><span style="color: #800000;">"</span>&gt;&lt;/p&gt;
    &lt;p&gt;性别&lt;input type=<span style="color: #800000;">"</span><span style="color: #800000;">text</span><span style="color: #800000;">"</span> name=<span style="color: #800000;">"</span><span style="color: #800000;">sex</span><span style="color: #800000;">"</span>&gt;&lt;/p&gt;
    &lt;p&gt;邮箱&lt;input type=<span style="color: #800000;">"</span><span style="color: #800000;">text</span><span style="color: #800000;">"</span> name=<span style="color: #800000;">"</span><span style="color: #800000;">email</span><span style="color: #800000;">"</span>&gt;&lt;/p&gt;
    &lt;p&gt;&lt;input type=<span style="color: #800000;">"</span><span style="color: #800000;">submit</span><span style="color: #800000;">"</span> value=<span style="color: #800000;">"</span><span style="color: #800000;">submit</span><span style="color: #800000;">"</span>&gt;&lt;/p&gt;

&lt;/form&gt;

&lt;hr&gt;

&lt;h1&gt;信息展示&lt;/h1&gt;

&lt;table border=<span style="color: #800000;">"</span><span style="color: #800000;">1</span><span style="color: #800000;">"</span>&gt;

    &lt;tr&gt;
        &lt;td&gt;姓名&lt;/td&gt;
        &lt;td&gt;性别&lt;/td&gt;
        &lt;td&gt;邮箱&lt;/td&gt;
    &lt;/tr&gt;<span style="color: #000000;">
    {</span>% <span style="color: #0000ff;">for</span> i <span style="color: #0000ff;">in</span> info_list %<span style="color: #000000;">}

        </span>&lt;tr&gt;
            &lt;td&gt;{{ i.username }}&lt;/td&gt;
            &lt;td&gt;{{ i.sex }}&lt;/td&gt;
            &lt;td&gt;{{ i.email }}&lt;/td&gt;
        &lt;/tr&gt;<span style="color: #000000;">

    {</span>% endfor %<span style="color: #000000;">}

</span>&lt;/table&gt;

&lt;/body&gt;
&lt;/html&gt;


-----------------------url.py---------------------------------------<span style="color: #000000;">
url(r</span><span style="color: #800000;">'</span><span style="color: #800000;">^userInfor/</span><span style="color: #800000;">'</span><span style="color: #000000;">, views.userInfor)

</span>-----------------------views.py--------------------------------------<span style="color: #000000;">

info_list</span>=<span style="color: #000000;">[]

</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> userInfor(req):

    </span><span style="color: #0000ff;">if</span> req.method==<span style="color: #800000;">"</span><span style="color: #800000;">POST</span><span style="color: #800000;">"</span><span style="color: #000000;">:
        username</span>=req.POST.get(<span style="color: #800000;">"</span><span style="color: #800000;">username</span><span style="color: #800000;">"</span><span style="color: #000000;">,None)
        sex</span>=req.POST.get(<span style="color: #800000;">"</span><span style="color: #800000;">sex</span><span style="color: #800000;">"</span><span style="color: #000000;">,None)
        email</span>=req.POST.get(<span style="color: #800000;">"</span><span style="color: #800000;">email</span><span style="color: #800000;">"</span><span style="color: #000000;">,None)

        info</span>={<span style="color: #800000;">"</span><span style="color: #800000;">username</span><span style="color: #800000;">"</span>:username,<span style="color: #800000;">"</span><span style="color: #800000;">sex</span><span style="color: #800000;">"</span>:sex,<span style="color: #800000;">"</span><span style="color: #800000;">email</span><span style="color: #800000;">"</span><span style="color: #000000;">:email}
        info_list.append(info)

    </span><span style="color: #0000ff;">return</span> render(req,<span style="color: #800000;">"</span><span style="color: #800000;">userInfor.html</span><span style="color: #800000;">"</span>,{<span style="color: #800000;">"</span><span style="color: #800000;">info_list</span><span style="color: #800000;">"</span>:info_list})</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h4><strong>实例练习2－提交数据并展示(数据库)</strong></h4>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;77712882-0464-40f5-839c-39d6f6d8f14f&#39;)"><img id="code_img_closed_77712882-0464-40f5-839c-39d6f6d8f14f" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_77712882-0464-40f5-839c-39d6f6d8f14f" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;77712882-0464-40f5-839c-39d6f6d8f14f&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_77712882-0464-40f5-839c-39d6f6d8f14f" class="cnblogs_code_hide">
<pre>&lt;!DOCTYPE html&gt;
&lt;html lang=<span style="color: #800000;">"</span><span style="color: #800000;">en</span><span style="color: #800000;">"</span>&gt;
&lt;head&gt;
    &lt;meta charset=<span style="color: #800000;">"</span><span style="color: #800000;">UTF-8</span><span style="color: #800000;">"</span>&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;创建个人信息&lt;/h1&gt;

&lt;form action=<span style="color: #800000;">"</span><span style="color: #800000;">/userInfor/</span><span style="color: #800000;">"</span> method=<span style="color: #800000;">"</span><span style="color: #800000;">post</span><span style="color: #800000;">"</span>&gt;

    &lt;p&gt;姓名&lt;input type=<span style="color: #800000;">"</span><span style="color: #800000;">text</span><span style="color: #800000;">"</span> name=<span style="color: #800000;">"</span><span style="color: #800000;">username</span><span style="color: #800000;">"</span>&gt;&lt;/p&gt;
    &lt;p&gt;性别&lt;input type=<span style="color: #800000;">"</span><span style="color: #800000;">text</span><span style="color: #800000;">"</span> name=<span style="color: #800000;">"</span><span style="color: #800000;">sex</span><span style="color: #800000;">"</span>&gt;&lt;/p&gt;
    &lt;p&gt;邮箱&lt;input type=<span style="color: #800000;">"</span><span style="color: #800000;">text</span><span style="color: #800000;">"</span> name=<span style="color: #800000;">"</span><span style="color: #800000;">email</span><span style="color: #800000;">"</span>&gt;&lt;/p&gt;
    &lt;p&gt;&lt;input type=<span style="color: #800000;">"</span><span style="color: #800000;">submit</span><span style="color: #800000;">"</span> value=<span style="color: #800000;">"</span><span style="color: #800000;">submit</span><span style="color: #800000;">"</span>&gt;&lt;/p&gt;

&lt;/form&gt;

&lt;hr&gt;

&lt;h1&gt;信息展示&lt;/h1&gt;

&lt;table border=<span style="color: #800000;">"</span><span style="color: #800000;">1</span><span style="color: #800000;">"</span>&gt;

    &lt;tr&gt;
        &lt;td&gt;姓名&lt;/td&gt;
        &lt;td&gt;性别&lt;/td&gt;
        &lt;td&gt;邮箱&lt;/td&gt;
    &lt;/tr&gt;<span style="color: #000000;">
    {</span>% <span style="color: #0000ff;">for</span> i <span style="color: #0000ff;">in</span> info_list %<span style="color: #000000;">}

        </span>&lt;tr&gt;
            &lt;td&gt;{{ i.username }}&lt;/td&gt;
            &lt;td&gt;{{ i.sex }}&lt;/td&gt;
            &lt;td&gt;{{ i.email }}&lt;/td&gt;
        &lt;/tr&gt;<span style="color: #000000;">

    {</span>% endfor %<span style="color: #000000;">}

</span>&lt;/table&gt;

&lt;/body&gt;
&lt;/html&gt;


----------------------------------------------<span style="color: #000000;">models.py
</span><span style="color: #0000ff;">from</span> django.db <span style="color: #0000ff;">import</span><span style="color: #000000;"> models

</span><span style="color: #008000;">#</span><span style="color: #008000;"> Create your models here.</span>


<span style="color: #0000ff;">class</span><span style="color: #000000;"> UserInfor(models.Model):

    username</span>=models.CharField(max_length=64<span style="color: #000000;">)
    sex</span>=models.CharField(max_length=64<span style="color: #000000;">)
    email</span>=models.CharField(max_length=64<span style="color: #000000;">)

</span>----------------------------------------------<span style="color: #000000;">views.py

</span><span style="color: #0000ff;">from</span> django.shortcuts <span style="color: #0000ff;">import</span><span style="color: #000000;"> render

</span><span style="color: #0000ff;">from</span> app01 <span style="color: #0000ff;">import</span><span style="color: #000000;"> models
</span><span style="color: #008000;">#</span><span style="color: #008000;"> Create your views here.</span>


<span style="color: #0000ff;">def</span><span style="color: #000000;"> userInfor(req):

    </span><span style="color: #0000ff;">if</span> req.method==<span style="color: #800000;">"</span><span style="color: #800000;">POST</span><span style="color: #800000;">"</span><span style="color: #000000;">:
        u</span>=req.POST.get(<span style="color: #800000;">"</span><span style="color: #800000;">username</span><span style="color: #800000;">"</span><span style="color: #000000;">,None)
        s</span>=req.POST.get(<span style="color: #800000;">"</span><span style="color: #800000;">sex</span><span style="color: #800000;">"</span><span style="color: #000000;">,None)
        e</span>=req.POST.get(<span style="color: #800000;">"</span><span style="color: #800000;">email</span><span style="color: #800000;">"</span><span style="color: #000000;">,None)


       </span><span style="color: #008000;">#</span><span style="color: #008000;">---------表中插入数据方式一</span>
            <span style="color: #008000;">#</span><span style="color: #008000;"> info={"username":u,"sex":e,"email":e}</span>
            <span style="color: #008000;">#</span><span style="color: #008000;"> models.UserInfor.objects.create(**info)</span>

       <span style="color: #008000;">#</span><span style="color: #008000;">---------表中插入数据方式二</span>
<span style="color: #000000;">        models.UserInfor.objects.create(
            username</span>=<span style="color: #000000;">u,
            sex</span>=<span style="color: #000000;">s,
            email</span>=<span style="color: #000000;">e
        )

        info_list</span>=<span style="color: #000000;">models.UserInfor.objects.all()

        </span><span style="color: #0000ff;">return</span> render(req,<span style="color: #800000;">"</span><span style="color: #800000;">userInfor.html</span><span style="color: #800000;">"</span>,{<span style="color: #800000;">"</span><span style="color: #800000;">info_list</span><span style="color: #800000;">"</span><span style="color: #000000;">:info_list})

    </span><span style="color: #0000ff;">return</span> render(req,<span style="color: #800000;">"</span><span style="color: #800000;">userInfor.html</span><span style="color: #800000;">"</span>)</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h3>四 Django的配置文件(settings)</h3>
<h4>静态文件设置:</h4>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;99b631fe-2a22-4942-87ea-d00a554758a1&#39;)"><img id="code_img_closed_99b631fe-2a22-4942-87ea-d00a554758a1" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_99b631fe-2a22-4942-87ea-d00a554758a1" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;99b631fe-2a22-4942-87ea-d00a554758a1&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_99b631fe-2a22-4942-87ea-d00a554758a1" class="cnblogs_code_hide">
<pre><span style="color: #000000;">一、概述：

     </span><span style="color: #008000;">#</span><span style="color: #008000;">静态文件交由Web服务器处理，Django本身不处理静态文件。简单的处理逻辑如下(以nginx为例)：</span>

     <span style="color: #008000;">#</span><span style="color: #008000;">          URI请求-----&gt; 按照Web服务器里面的配置规则先处理，以nginx为例，主要求配置在nginx.</span>
                             <span style="color: #008000;">#</span><span style="color: #008000;">conf里的location</span>

                         |----------&gt;<span style="color: #000000;">如果是静态文件，则由nginx直接处理

                         </span>|----------&gt;<span style="color: #000000;">如果不是则交由Django处理，Django根据urls.py里面的规则进行匹配

    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 以上是部署到Web服务器后的处理方式，为了便于开发，Django提供了在开发环境的对静态文件的处理机制，方法是这样：</span>

    <span style="color: #008000;">#</span><span style="color: #008000;">1、在INSTALLED_APPS里面加入'django.contrib.staticfiles',</span>

    <span style="color: #008000;">#</span><span style="color: #008000;">2、在urls.py里面加入</span>
       <span style="color: #0000ff;">if</span><span style="color: #000000;"> settings.DEBUG:  
           urlpatterns </span>+= patterns(<span style="color: #800000;">''</span>, url(r<span style="color: #800000;">'</span><span style="color: #800000;">^media/(?P&lt;path&gt;.*)$</span><span style="color: #800000;">'</span><span style="color: #000000;">, 
           </span><span style="color: #800000;">'</span><span style="color: #800000;">django.views.static.serve</span><span style="color: #800000;">'</span>, {<span style="color: #800000;">'</span><span style="color: #800000;">document_root</span><span style="color: #800000;">'</span><span style="color: #000000;">: settings.MEDIA_ROOT }),   
            url(r</span><span style="color: #800000;">'</span><span style="color: #800000;">^static/(?P&lt;path&gt;.*)$</span><span style="color: #800000;">'</span><span style="color: #000000;">,
          </span><span style="color: #800000;">'</span><span style="color: #800000;">django.views.static.serve</span><span style="color: #800000;">'</span>,{<span style="color: #800000;">'</span><span style="color: #800000;">document_root</span><span style="color: #800000;">'</span><span style="color: #000000;">:settings.STATIC_ROOT}), )  

    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 3、这样就可以在开发阶段直接使用静态文件了。</span>
<span style="color: #000000;">
二、MEDIA_ROOT和MEDIA_URL

        </span><span style="color: #008000;">#</span><span style="color: #008000;">而静态文件的处理又包括STATIC和MEDIA两类，这往往容易混淆，在Django里面是这样定义的：</span>

        <span style="color: #008000;">#</span><span style="color: #008000;">MEDIA:指用户上传的文件，比如在Model里面的FileFIeld，ImageField上传的文件。如果你定义</span>

        <span style="color: #008000;">#</span><span style="color: #008000;">MEDIA_ROOT=c:\temp\media，那么File=models.FileField(upload_to="abc/")＃，上传的文件就会被保存到c:\temp\media\abc  </span>
        <span style="color: #008000;">#</span><span style="color: #008000;">eg：</span>
            <span style="color: #0000ff;">class</span><span style="color: #000000;"> blog(models.Model):  
                   Title</span>=models.charField(max_length=64<span style="color: #000000;">)  
                   Photo</span>=models.ImageField(upload_to=<span style="color: #800000;">"</span><span style="color: #800000;">photo</span><span style="color: #800000;">"</span><span style="color: #000000;">) 
        </span><span style="color: #008000;">#</span><span style="color: #008000;">     上传的图片就上传到c:\temp\media\photo，而在模板中要显示该文件，则在这样写</span>
        <span style="color: #008000;">#</span><span style="color: #008000;">在settings里面设置的MEDIA_ROOT必须是本地路径的绝对路径，一般是这样写:</span>
                 BASE_DIR= os.path.abspath(os.path.dirname(<span style="color: #800080;">__file__</span><span style="color: #000000;">))  
                 MEDIA_ROOT</span>=os.path.join(BASE_DIR,<span style="color: #800000;">'</span><span style="color: #800000;">media/</span><span style="color: #800000;">'</span>).replace(<span style="color: #800000;">'</span><span style="color: #800000;">\\</span><span style="color: #800000;">'</span>,<span style="color: #800000;">'</span><span style="color: #800000;">/</span><span style="color: #800000;">'</span><span style="color: #000000;">) 

        </span><span style="color: #008000;">#</span><span style="color: #008000;">MEDIA_URL是指从浏览器访问时的地址前缀，举个例子：</span>
            MEDIA_ROOT=<span style="color: #000000;">c:\temp\media\photo  
            MEDIA_URL</span>=<span style="color: #800000;">"</span><span style="color: #800000;">/data/</span><span style="color: #800000;">"</span>
        <span style="color: #008000;">#</span><span style="color: #008000;">在开发阶段,media的处理由django处理：</span>

        <span style="color: #008000;">#</span><span style="color: #008000;">    访问http://localhost/data/abc/a.png就是访问c:\temp\media\photo\abc\a.png</span>

        <span style="color: #008000;">#</span><span style="color: #008000;">    在模板里面这样写&lt;img src="{{MEDIA_URL}}abc/a.png"&gt;</span>

        <span style="color: #008000;">#</span><span style="color: #008000;">    在部署阶段最大的不同在于你必须让web服务器来处理media文件，因此你必须在web服务器中配置，</span>
        <span style="color: #008000;">#</span><span style="color: #008000;">  以便能让web服务器能访问media文件</span>
        <span style="color: #008000;">#</span><span style="color: #008000;">    以nginx为例，可以在nginx.conf里面这样：</span>
<span style="color: #000000;">
                 location </span>~/media/<span style="color: #000000;">{
                       root</span>/temp/
                       <span style="color: #0000ff;">break</span><span style="color: #000000;">;
                    }

        </span><span style="color: #008000;">#</span><span style="color: #008000;">    具体可以参考如何在nginx部署django的资料。</span>
<span style="color: #000000;">
三、STATIC_ROOT和STATIC_URL、
    STATIC主要指的是如css,js,images这样文件，在settings里面可以配置STATIC_ROOT和STATIC_URL,
    配置方式与MEDIA_ROOT是一样的，但是要注意

    </span><span style="color: #008000;">#</span><span style="color: #008000;">STATIC文件一般保存在以下位置：</span>

    <span style="color: #008000;">#</span><span style="color: #008000;">1、STATIC_ROOT：在settings里面设置，一般用来放一些公共的js,css,images等。</span>

    <span style="color: #008000;">#</span><span style="color: #008000;">2、app的static文件夹，在每个app所在文夹均可以建立一个static文件夹，然后当运行collectstatic时，</span>
    <span style="color: #008000;">#</span><span style="color: #008000;">    Django会遍历INSTALL_APPS里面所有app的static文件夹，将里面所有的文件复制到STATIC_ROOT。因此，</span>
    <span style="color: #008000;">#</span><span style="color: #008000;">   如果你要建立可复用的app，那么你要将该app所需要的静态文件放在static文件夹中。</span>

    <span style="color: #008000;">#</span><span style="color: #008000;"> 也就是说一个项目引用了很多app，那么这个项目所需要的css,images等静态文件是分散在各个app的static文件的，比</span>
    <span style="color: #008000;">#</span><span style="color: #008000;">  较典型的是admin应用。当你要发布时，需要将这些分散的static文件收集到一个地方就是STATIC_ROOT。</span>

    <span style="color: #008000;">#</span><span style="color: #008000;">3、STATIC文件还可以配置STATICFILES_DIRS，指定额外的静态文件存储位置。</span>
    <span style="color: #008000;">#</span><span style="color: #008000;">  STATIC_URL的含义与MEDIA_URL类似。</span>

    <span style="color: #008000;">#</span><span style="color: #008000;"> ----------------------------------------------------------------------------</span>
    <span style="color: #008000;">#</span><span style="color: #008000;">注意1:</span>
        <span style="color: #008000;">#</span><span style="color: #008000;">为了后端的更改不会影响前端的引入，避免造成前端大量修改</span>
<span style="color: #000000;">
        STATIC_URL </span>= <span style="color: #800000;">'</span><span style="color: #800000;">/static/</span><span style="color: #800000;">'</span>               <span style="color: #008000;">#</span><span style="color: #008000;">引用名</span>
        STATICFILES_DIRS =<span style="color: #000000;"> (
            os.path.join(BASE_DIR,</span><span style="color: #800000;">"</span><span style="color: #800000;">statics</span><span style="color: #800000;">"</span>)  <span style="color: #008000;">#</span><span style="color: #008000;">实际名 ,即实际文件夹的名字</span>
<span style="color: #000000;">        )

        </span><span style="color: #008000;">#</span><span style="color: #008000;">django对引用名和实际名进行映射,引用时,只能按照引用名来,不能按实际名去找</span>
        <span style="color: #008000;">#</span><span style="color: #008000;">&lt;script src="/statics/jquery-3.1.1.js"&gt;&lt;/script&gt;</span>
        <span style="color: #008000;">#</span><span style="color: #008000;">------error－－－－－不能直接用，必须用STATIC_URL = '/static/':</span>
        <span style="color: #008000;">#</span><span style="color: #008000;">&lt;script src="/static/jquery-3.1.1.js"&gt;&lt;/script&gt;</span>

    <span style="color: #008000;">#</span><span style="color: #008000;">注意2(statics文件夹写在不同的app下,静态文件的调用):</span>
<span style="color: #000000;">
        STATIC_URL </span>= <span style="color: #800000;">'</span><span style="color: #800000;">/static/</span><span style="color: #800000;">'</span><span style="color: #000000;">

        STATICFILES_DIRS</span>=<span style="color: #000000;">(
            (</span><span style="color: #800000;">'</span><span style="color: #800000;">hello</span><span style="color: #800000;">'</span>,os.path.join(BASE_DIR,<span style="color: #800000;">"</span><span style="color: #800000;">app01</span><span style="color: #800000;">"</span>,<span style="color: #800000;">"</span><span style="color: #800000;">statics</span><span style="color: #800000;">"</span><span style="color: #000000;">)) ,
        )

        </span><span style="color: #008000;">#</span><span style="color: #008000;">&lt;script src="/static/hello/jquery-1.8.2.min.js"&gt;&lt;/script&gt;</span>

    <span style="color: #008000;">#</span><span style="color: #008000;">注意3:</span>
        STATIC_URL = <span style="color: #800000;">'</span><span style="color: #800000;">/static/</span><span style="color: #800000;">'</span><span style="color: #000000;">
        {</span>% load staticfiles %<span style="color: #000000;">}
       </span><span style="color: #008000;">#</span><span style="color: #008000;"> &lt;script src={% static "jquery-1.8.2.min.js" %}&gt;&lt;/script&gt;</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h4>其它重要参数设置：</h4>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./Web框架Django_files/copycode.gif" alt="复制代码"></a></span></div>
<pre><span style="color: #000000;">APPEND_SLASH
       Default: True
       When set to True, </span><span style="color: #0000ff;">if</span> the request URL does <span style="color: #0000ff;">not</span> match any of the patterns <span style="color: #0000ff;">in</span> the URLconf <span style="color: #0000ff;">and</span> it <br>       doesn’t end <span style="color: #0000ff;">in</span> a slash, an HTTP redirect <span style="color: #0000ff;">is</span> issued to the same URL with a slash appended. Note <br>       that the redirect may cause any data submitted <span style="color: #0000ff;">in</span> a POST request to be lost.</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./Web框架Django_files/copycode.gif" alt="复制代码"></a></span></div></div>
<h3>五 Django URL (路由系统)</h3>
<p>&nbsp;&nbsp;&nbsp;&nbsp; URL配置(URLconf)就像Django 所支撑网站的目录。它的本质是URL模式以及要为该URL模式调用的视图函数之间的映射表；你就是以这种方式告诉Django，对于这个URL调用这段代码，对于那个URL调用那段代码。</p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_953385" class="syntaxhighlighter  csharp"><div class="toolbar"><span><a href="https://www.cnblogs.com/yuanchenqi/articles/6083427.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="csharp plain">urlpatterns = [</code></div><div class="line number2 index1 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">url(正则表达式, views视图函数，参数，别名),</code></div><div class="line number3 index2 alt2"><code class="csharp plain">]</code></div></div></td></tr></tbody></table></div></div>
</div>
<p>参数说明：</p>
<ul>
<li>一个正则表达式字符串</li>
<li>一个可调用对象，通常为一个视图函数或一个指定视图函数路径的字符串</li>
<li>可选的要传递给视图函数的默认参数（字典形式）</li>
<li>一个可选的name参数</li>
</ul>
<h4>5.1 Here’s a sample URLconf:</h4>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./Web框架Django_files/copycode.gif" alt="复制代码"></a></span></div>
<pre><span style="color: #0000ff;">from</span> django.conf.urls <span style="color: #0000ff;">import</span><span style="color: #000000;"> url
</span><span style="color: #0000ff;">from</span> django.contrib <span style="color: #0000ff;">import</span><span style="color: #000000;"> admin

</span><span style="color: #0000ff;">from</span> app01 <span style="color: #0000ff;">import</span><span style="color: #000000;"> views

urlpatterns </span>=<span style="color: #000000;"> [

    url(r</span><span style="color: #800000;">'</span><span style="color: #800000;">^articles/2003/$</span><span style="color: #800000;">'</span><span style="color: #000000;">, views.special_case_2003),

    </span><span style="color: #008000;">#</span><span style="color: #008000;">url(r'^articles/[0-9]{4}/$', views.year_archive),</span>
<span style="color: #000000;">
    url(r</span><span style="color: #800000;">'</span><span style="color: #800000;">^articles/([0-9]{4})/$</span><span style="color: #800000;">'</span>, views.year_archive),  <span style="color: #008000;">#</span><span style="color: #008000;">no_named group</span>
<span style="color: #000000;">
    url(r</span><span style="color: #800000;">'</span><span style="color: #800000;">^articles/([0-9]{4})/([0-9]{2})/$</span><span style="color: #800000;">'</span><span style="color: #000000;">, views.month_archive),

    url(r</span><span style="color: #800000;">'</span><span style="color: #800000;">^articles/([0-9]{4})/([0-9]{2})/([0-9]+)/$</span><span style="color: #800000;">'</span><span style="color: #000000;">, views.article_detail),

]</span></pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./Web框架Django_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p><span style="color: #800080;"><strong>Note:</strong></span></p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;febd348e-071b-4660-b9b2-190d77f0597d&#39;)"><img id="code_img_closed_febd348e-071b-4660-b9b2-190d77f0597d" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_febd348e-071b-4660-b9b2-190d77f0597d" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;febd348e-071b-4660-b9b2-190d77f0597d&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_febd348e-071b-4660-b9b2-190d77f0597d" class="cnblogs_code_hide">
<pre><span style="color: #008000;">#</span><span style="color: #008000;">1   There’s no need to add a leading slash, because every URL has that. For</span><span style="color: #008000;">
#</span><span style="color: #008000;">    example, it’s ^articles, not ^/articles.</span>

<span style="color: #008000;">#</span><span style="color: #008000;">2   A request to /articles/2005/03/ would match the third entry in the list.</span><span style="color: #008000;">
#</span><span style="color: #008000;">    Django would call the function views.month_archive(request, '2005', '03').</span>

<span style="color: #008000;">#</span><span style="color: #008000;">3   /articles/2005/3/ would not match any URL patterns</span>

<span style="color: #008000;">#</span><span style="color: #008000;">4   /articles/2003/ would match the first pattern in the list, not the second one</span>

<span style="color: #008000;">#</span><span style="color: #008000;">5   /articles/2003/03/03/ would match the final pattern. Django would call the</span><span style="color: #008000;">
#</span><span style="color: #008000;">    functionviews.article_detail(request, '2003', '03', '03').</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h4>5.2 Named groups</h4>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The above example used simple,&nbsp;<em>non-named</em>&nbsp;regular-expression groups (via parenthesis) to capture bits of the URL and pass them as&nbsp;<em>positional</em>&nbsp;arguments to a view. In more advanced usage, it’s possible to use&nbsp;<em>named</em>&nbsp;regular-expression groups to capture URL bits and pass them as&nbsp;<em>keyword</em>&nbsp;arguments to a view.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; In Python regular expressions, the syntax for named regular-expression groups is&nbsp;<code class="docutils literal">(?P&lt;name&gt;pattern)</code>, where&nbsp;<code class="docutils literal">name</code>&nbsp;is the name of the group and&nbsp;<code class="docutils literal">pattern</code>&nbsp;is some pattern to match.</p>
<p>Here’s the above example URLconf, rewritten to use named groups:</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;85780bb7-e735-4399-9d3d-ae6d9d41944b&#39;)"><img id="code_img_closed_85780bb7-e735-4399-9d3d-ae6d9d41944b" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_85780bb7-e735-4399-9d3d-ae6d9d41944b" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;85780bb7-e735-4399-9d3d-ae6d9d41944b&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_85780bb7-e735-4399-9d3d-ae6d9d41944b" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">import</span><span style="color: #000000;"> re

ret</span>=re.search(<span style="color: #800000;">'</span><span style="color: #800000;">(?P&lt;id&gt;\d{3})/(?P&lt;name&gt;\w{3})</span><span style="color: #800000;">'</span>,<span style="color: #800000;">'</span><span style="color: #800000;">weeew34ttt123/ooo</span><span style="color: #800000;">'</span><span style="color: #000000;">)

</span><span style="color: #0000ff;">print</span><span style="color: #000000;">(ret.group())
</span><span style="color: #0000ff;">print</span>(ret.group(<span style="color: #800000;">'</span><span style="color: #800000;">id</span><span style="color: #800000;">'</span><span style="color: #000000;">))
</span><span style="color: #0000ff;">print</span>(ret.group(<span style="color: #800000;">'</span><span style="color: #800000;">name</span><span style="color: #800000;">'</span>))</pre>
</div>
<span class="cnblogs_code_collapse">ready</span></div>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./Web框架Django_files/copycode.gif" alt="复制代码"></a></span></div>
<pre><span style="color: #0000ff;">from</span> django.conf.urls <span style="color: #0000ff;">import</span><span style="color: #000000;"> url
  
</span><span style="color: #0000ff;">from</span> . <span style="color: #0000ff;">import</span><span style="color: #000000;"> views
  
urlpatterns </span>=<span style="color: #000000;"> [
    url(r</span><span style="color: #800000;">'</span><span style="color: #800000;">^articles/2003/$</span><span style="color: #800000;">'</span><span style="color: #000000;">, views.special_case_2003),
    url(r</span><span style="color: #800000;">'</span><span style="color: #800000;">^articles/(?P&lt;year&gt;[0-9]{4})/$</span><span style="color: #800000;">'</span><span style="color: #000000;">, views.year_archive),
    url(r</span><span style="color: #800000;">'</span><span style="color: #800000;">^articles/(?P&lt;year&gt;[0-9]{4})/(?P&lt;month&gt;[0-9]{2})/$</span><span style="color: #800000;">'</span><span style="color: #000000;">, views.month_archive),
    url(r</span><span style="color: #800000;">'</span><span style="color: #800000;">^articles/(?P&lt;year&gt;[0-9]{4})/(?P&lt;month&gt;[0-9]{2})/(?P&lt;day&gt;[0-9]{2})/$</span><span style="color: #800000;">'</span><span style="color: #000000;">, views.article_detail),
]</span></pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./Web框架Django_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; This accomplishes exactly the same thing as the previous example, with one subtle difference: The captured values are passed to view functions as keyword arguments rather than positional arguments.</p>
<h4>5.3&nbsp; Passing extra options to view functions</h4>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; URLconfs have a hook that lets you pass extra arguments to your view functions, as a Python dictionary.</p>
<p>The&nbsp;<a class="reference internal" title="django.conf.urls.url" href="https://docs.djangoproject.com/en/1.9/ref/urls/#django.conf.urls.url"><code class="xref py py-func docutils literal"><span class="pre">django.conf.urls.url()</span></code></a>&nbsp;function can take an optional third argument which should be a dictionary of extra keyword arguments to pass to the view function.</p>
<p>For example:</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">from</span> django.conf.urls <span style="color: #0000ff;">import</span><span style="color: #000000;"> url
</span><span style="color: #0000ff;">from</span> . <span style="color: #0000ff;">import</span><span style="color: #000000;"> views
  
urlpatterns </span>=<span style="color: #000000;"> [
    url(r</span><span style="color: #800000;">'</span><span style="color: #800000;">^blog/(?P&lt;year&gt;[0-9]{4})/$</span><span style="color: #800000;">'</span>, views.year_archive, {<span style="color: #800000;">'</span><span style="color: #800000;">foo</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">bar</span><span style="color: #800000;">'</span><span style="color: #000000;">}),
]</span></pre>
</div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; In this example, for a request to&nbsp;<code class="docutils literal">/blog/2005/</code>, Django will call&nbsp;<code class="docutils literal"><span class="pre">views.year_archive(request,&nbsp;<span class="pre">year='2005',<span class="pre">foo='bar')</span></span></span></code>.</p>
<p>This technique is used in the&nbsp;<a class="reference internal" href="https://docs.djangoproject.com/en/1.9/ref/contrib/syndication/">syndication framework</a>&nbsp;to pass metadata and options to views.</p>
<div class="admonition-dealing-with-conflicts admonition">
<p class="first admonition-title">Dealing with conflicts</p>
<p class="last">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; It’s possible to have a URL pattern which captures named keyword arguments, and also passes arguments with the same names in its dictionary of extra arguments. When this happens, the arguments in the dictionary will be used instead of the arguments captured in the URL.</p>
</div>
<h4>5.4 <span style="font-size: 1em; line-height: 1.5;">name param</span></h4>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;69aca7f7-be75-4feb-b826-880364af5297&#39;)"><img id="code_img_closed_69aca7f7-be75-4feb-b826-880364af5297" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_69aca7f7-be75-4feb-b826-880364af5297" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;69aca7f7-be75-4feb-b826-880364af5297&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_69aca7f7-be75-4feb-b826-880364af5297" class="cnblogs_code_hide">
<pre>urlpatterns =<span style="color: #000000;"> [
    url(r</span><span style="color: #800000;">'</span><span style="color: #800000;">^index</span><span style="color: #800000;">'</span>,views.index,name=<span style="color: #800000;">'</span><span style="color: #800000;">bieming</span><span style="color: #800000;">'</span><span style="color: #000000;">),
    url(r</span><span style="color: #800000;">'</span><span style="color: #800000;">^admin/</span><span style="color: #800000;">'</span><span style="color: #000000;">, admin.site.urls),
    </span><span style="color: #008000;">#</span><span style="color: #008000;"> url(r'^articles/2003/$', views.special_case_2003),</span>
    url(r<span style="color: #800000;">'</span><span style="color: #800000;">^articles/([0-9]{4})/$</span><span style="color: #800000;">'</span><span style="color: #000000;">, views.year_archive),
    </span><span style="color: #008000;">#</span><span style="color: #008000;"> url(r'^articles/([0-9]{4})/([0-9]{2})/$', views.month_archive),</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> url(r'^articles/([0-9]{4})/([0-9]{2})/([0-9]+)/$', views.article_detail),</span>
<span style="color: #000000;">
]
</span><span style="color: #008000;">#</span><span style="color: #008000;">##################</span>

<span style="color: #0000ff;">def</span><span style="color: #000000;"> index(req):
    </span><span style="color: #0000ff;">if</span> req.method==<span style="color: #800000;">'</span><span style="color: #800000;">POST</span><span style="color: #800000;">'</span><span style="color: #000000;">:
        username</span>=req.POST.get(<span style="color: #800000;">'</span><span style="color: #800000;">username</span><span style="color: #800000;">'</span><span style="color: #000000;">)
        password</span>=req.POST.get(<span style="color: #800000;">'</span><span style="color: #800000;">password</span><span style="color: #800000;">'</span><span style="color: #000000;">)
        </span><span style="color: #0000ff;">if</span> username==<span style="color: #800000;">'</span><span style="color: #800000;">alex</span><span style="color: #800000;">'</span> <span style="color: #0000ff;">and</span> password==<span style="color: #800000;">'</span><span style="color: #800000;">123</span><span style="color: #800000;">'</span><span style="color: #000000;">:
            </span><span style="color: #0000ff;">return</span> HttpResponse(<span style="color: #800000;">"</span><span style="color: #800000;">登陆成功</span><span style="color: #800000;">"</span><span style="color: #000000;">)



    </span><span style="color: #0000ff;">return</span> render(req,<span style="color: #800000;">'</span><span style="color: #800000;">index.html</span><span style="color: #800000;">'</span><span style="color: #000000;">)

</span><span style="color: #008000;">#</span><span style="color: #008000;">####################</span>

&lt;!DOCTYPE html&gt;
&lt;html lang=<span style="color: #800000;">"</span><span style="color: #800000;">en</span><span style="color: #800000;">"</span>&gt;
&lt;head&gt;
    &lt;meta charset=<span style="color: #800000;">"</span><span style="color: #800000;">UTF-8</span><span style="color: #800000;">"</span>&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;<span style="color: #000000;">
{</span><span style="color: #008000;">#</span><span style="color: #008000;">     &lt;form action="/index/" method="post"&gt;#}</span>
     &lt;form action=<span style="color: #800000;">"</span><span style="color: #800000;">{% url 'bieming' %}</span><span style="color: #800000;">"</span> method=<span style="color: #800000;">"</span><span style="color: #800000;">post</span><span style="color: #800000;">"</span>&gt;<span style="color: #000000;">
         用户名:</span>&lt;input type=<span style="color: #800000;">"</span><span style="color: #800000;">text</span><span style="color: #800000;">"</span> name=<span style="color: #800000;">"</span><span style="color: #800000;">username</span><span style="color: #800000;">"</span>&gt;<span style="color: #000000;">
         密码:</span>&lt;input type=<span style="color: #800000;">"</span><span style="color: #800000;">password</span><span style="color: #800000;">"</span> name=<span style="color: #800000;">"</span><span style="color: #800000;">password</span><span style="color: #800000;">"</span>&gt;
         &lt;input type=<span style="color: #800000;">"</span><span style="color: #800000;">submit</span><span style="color: #800000;">"</span> value=<span style="color: #800000;">"</span><span style="color: #800000;">submit</span><span style="color: #800000;">"</span>&gt;
     &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;


<span style="color: #008000;">#</span><span style="color: #008000;">######################</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h4>5.5 Including other URLconfs</h4>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./Web框架Django_files/copycode.gif" alt="复制代码"></a></span></div>
<pre><span style="color: #008000;">#</span><span style="color: #008000;">At any point, your urlpatterns can “include” other URLconf modules. This</span><span style="color: #008000;">
#</span><span style="color: #008000;">essentially “roots” a set of URLs below other ones.</span>

<span style="color: #008000;">#</span><span style="color: #008000;">For example, here’s an excerpt of the URLconf for the Django website itself.</span><span style="color: #008000;">
#</span><span style="color: #008000;">It includes a number of other URLconfs:</span>


<span style="color: #0000ff;">from</span> django.conf.urls <span style="color: #0000ff;">import</span><span style="color: #000000;"> include, url

urlpatterns </span>=<span style="color: #000000;"> [
   url(r</span><span style="color: #800000;">'</span><span style="color: #800000;">^admin/</span><span style="color: #800000;">'</span><span style="color: #000000;">, admin.site.urls),
   url(r</span><span style="color: #800000;">'</span><span style="color: #800000;">^blog/</span><span style="color: #800000;">'</span>, include(<span style="color: #800000;">'</span><span style="color: #800000;">blog.urls</span><span style="color: #800000;">'</span><span style="color: #000000;">)),
]</span></pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./Web框架Django_files/copycode.gif" alt="复制代码"></a></span></div></div>
<h3>六 Django Views（视图函数）</h3>
<p><img src="./Web框架Django_files/877318-20160725101445044-1768854009.jpg" alt="" width="368" height="276"></p>
<p>http请求中产生两个核心对象：</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; http请求：HttpRequest对象</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; http响应：HttpResponse对象</p>
<p>所在位置：django.http</p>
<p>之前我们用到的参数request就是HttpRequest &nbsp; &nbsp;检测方法：isinstance(request,HttpRequest)</p>
<h4>1 HttpRequest对象的属性和方法：</h4>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;51c5e4d3-7b9f-4ad3-91b5-e41626f20c6f&#39;)"><img id="code_img_closed_51c5e4d3-7b9f-4ad3-91b5-e41626f20c6f" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_51c5e4d3-7b9f-4ad3-91b5-e41626f20c6f" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;51c5e4d3-7b9f-4ad3-91b5-e41626f20c6f&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_51c5e4d3-7b9f-4ad3-91b5-e41626f20c6f" class="cnblogs_code_hide">
<pre><span style="color: #008000;">#</span><span style="color: #008000;"> path：       请求页面的全路径，不包括域名</span><span style="color: #008000;">
#
#</span><span style="color: #008000;"> method：     请求中使用的HTTP方法的字符串表示。全大写表示。例如</span><span style="color: #008000;">
#
#</span><span style="color: #008000;">                    if  req.method=="GET":</span><span style="color: #008000;">
#
#</span><span style="color: #008000;">                              do_something()</span><span style="color: #008000;">
#
#</span><span style="color: #008000;">                    elseif req.method=="POST":</span><span style="color: #008000;">
#
#</span><span style="color: #008000;">                              do_something_else()</span><span style="color: #008000;">
#
#</span><span style="color: #008000;"> GET:         包含所有HTTP GET参数的类字典对象</span><span style="color: #008000;">
#
#</span><span style="color: #008000;"> POST：       包含所有HTTP POST参数的类字典对象</span><span style="color: #008000;">
#
#</span><span style="color: #008000;">              服务器收到空的POST请求的情况也是可能发生的，也就是说，表单form通过</span><span style="color: #008000;">
#</span><span style="color: #008000;">              HTTP POST方法提交请求，但是表单中可能没有数据，因此不能使用</span><span style="color: #008000;">
#</span><span style="color: #008000;">              if req.POST来判断是否使用了HTTP POST 方法；应该使用  if req.method=="POST"</span><span style="color: #008000;">
#
#
#
#</span><span style="color: #008000;"> COOKIES:     包含所有cookies的标准Python字典对象；keys和values都是字符串。</span><span style="color: #008000;">
#
#</span><span style="color: #008000;"> FILES：      包含所有上传文件的类字典对象；FILES中的每一个Key都是&lt;input type="file" name="" /&gt;标签中                     name属性的值，FILES中的每一个value同时也是一个标准的python字典对象，包含下面三个Keys：</span><span style="color: #008000;">
#
#</span><span style="color: #008000;">             filename：      上传文件名，用字符串表示</span><span style="color: #008000;">
#</span><span style="color: #008000;">             content_type:   上传文件的Content Type</span><span style="color: #008000;">
#</span><span style="color: #008000;">             content：       上传文件的原始内容</span><span style="color: #008000;">
#
#
#</span><span style="color: #008000;"> user：       是一个django.contrib.auth.models.User对象，代表当前登陆的用户。如果访问用户当前</span><span style="color: #008000;">
#</span><span style="color: #008000;">              没有登陆，user将被初始化为django.contrib.auth.models.AnonymousUser的实例。你</span><span style="color: #008000;">
#</span><span style="color: #008000;">              可以通过user的is_authenticated()方法来辨别用户是否登陆：</span><span style="color: #008000;">
#</span><span style="color: #008000;">              if req.user.is_authenticated();只有激活Django中的AuthenticationMiddleware</span><span style="color: #008000;">
#</span><span style="color: #008000;">              时该属性才可用</span><span style="color: #008000;">
#
#</span><span style="color: #008000;"> session：    唯一可读写的属性，代表当前会话的字典对象；自己有激活Django中的session支持时该属性才可用。</span>

<span style="color: #008000;">#</span><span style="color: #008000;">方法</span>
get_full_path(),   比如：http://127.0.0.1:8000/index33/?name=123 ,req.get_full_path()得到的结果就是/index33/?name=123<span style="color: #000000;">
req.path:</span>/index33</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h4>注意一个常用方法：<span style="color: #008080;">request.POST.getlist('')</span></h4>
<h4>2&nbsp;HttpResponse对象：</h4>
<p>&nbsp; 对于HttpRequest对象来说，是由django自动创建的，但是，HttpResponse对象就必须我们自己创建。每个view请求处理方法必须返回一个HttpResponse对象。</p>
<p>&nbsp;&nbsp;HttpResponse类在django.http.HttpResponse</p>
<p>&nbsp; 在HttpResponse对象上扩展的常用方法：</p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_287704" class="syntaxhighlighter  csharp"><div class="toolbar"><span><a href="https://www.cnblogs.com/yuanchenqi/articles/6083427.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="csharp plain">页面渲染：&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; render()（推荐）&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; render_to_response(),</code></div><div class="line number2 index1 alt1"><code class="csharp plain">页面跳转：&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; redirect(</code><code class="csharp string">"路径"</code><code class="csharp plain">)</code></div><div class="line number3 index2 alt2"><code class="csharp plain">locals()：&nbsp;&nbsp;&nbsp; 可以直接将函数中所有的变量传给模板</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><strong><span style="color: #333399;">补充：</span></strong></p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;19215232-8319-4589-81e0-3e729e394e26&#39;)"><img id="code_img_closed_19215232-8319-4589-81e0-3e729e394e26" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_19215232-8319-4589-81e0-3e729e394e26" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;19215232-8319-4589-81e0-3e729e394e26&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_19215232-8319-4589-81e0-3e729e394e26" class="cnblogs_code_hide">
<pre>-----------------------------------<span style="color: #000000;">url.py

 url(r</span><span style="color: #800000;">"</span><span style="color: #800000;">login</span><span style="color: #800000;">"</span><span style="color: #000000;">,   views.login),
 url(r</span><span style="color: #800000;">"</span><span style="color: #800000;">yuan_back</span><span style="color: #800000;">"</span><span style="color: #000000;">,   views.yuan_back),

</span>-----------------------------------<span style="color: #000000;">views.py
</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> login(req):
    </span><span style="color: #0000ff;">if</span> req.method==<span style="color: #800000;">"</span><span style="color: #800000;">POST</span><span style="color: #800000;">"</span><span style="color: #000000;">:
        </span><span style="color: #0000ff;">if</span> 1<span style="color: #000000;">:
            </span><span style="color: #008000;">#</span><span style="color: #008000;"> return redirect("/yuan_back/")</span>
            name=<span style="color: #800000;">"</span><span style="color: #800000;">yuanhao</span><span style="color: #800000;">"</span>

            <span style="color: #0000ff;">return</span> render(req,<span style="color: #800000;">"</span><span style="color: #800000;">my backend.html</span><span style="color: #800000;">"</span><span style="color: #000000;">,locals())

    </span><span style="color: #0000ff;">return</span> render(req,<span style="color: #800000;">"</span><span style="color: #800000;">login.html</span><span style="color: #800000;">"</span><span style="color: #000000;">,locals())


</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> yuan_back(req):

    name</span>=<span style="color: #800000;">"</span><span style="color: #800000;">苑昊</span><span style="color: #800000;">"</span>

    <span style="color: #0000ff;">return</span> render(req,<span style="color: #800000;">"</span><span style="color: #800000;">my backend.html</span><span style="color: #800000;">"</span><span style="color: #000000;">,locals())

</span>-----------------------------------<span style="color: #000000;">login.html

</span>&lt;form action=<span style="color: #800000;">"</span><span style="color: #800000;">/login/</span><span style="color: #800000;">"</span> method=<span style="color: #800000;">"</span><span style="color: #800000;">post</span><span style="color: #800000;">"</span>&gt;
    &lt;p&gt;姓名&lt;input type=<span style="color: #800000;">"</span><span style="color: #800000;">text</span><span style="color: #800000;">"</span> name=<span style="color: #800000;">"</span><span style="color: #800000;">username</span><span style="color: #800000;">"</span>&gt;&lt;/p&gt;
    &lt;p&gt;性别&lt;input type=<span style="color: #800000;">"</span><span style="color: #800000;">text</span><span style="color: #800000;">"</span> name=<span style="color: #800000;">"</span><span style="color: #800000;">sex</span><span style="color: #800000;">"</span>&gt;&lt;/p&gt;
    &lt;p&gt;邮箱&lt;input type=<span style="color: #800000;">"</span><span style="color: #800000;">text</span><span style="color: #800000;">"</span> name=<span style="color: #800000;">"</span><span style="color: #800000;">email</span><span style="color: #800000;">"</span>&gt;&lt;/p&gt;
    &lt;p&gt;&lt;input type=<span style="color: #800000;">"</span><span style="color: #800000;">submit</span><span style="color: #800000;">"</span> value=<span style="color: #800000;">"</span><span style="color: #800000;">submit</span><span style="color: #800000;">"</span>&gt;&lt;/p&gt;
&lt;/form&gt;
-----------------------------------<span style="color: #000000;">my backend.html
</span>&lt;h1&gt;用户{{ name }}你好&lt;/h1&gt;

<span style="color: #008000;">#</span><span style="color: #008000;">总结: render和redirect的区别:</span><span style="color: #008000;">
#</span><span style="color: #008000;">   1 if render的页面需要模板语言渲染,需要的将数据库的数据加载到html,那么所有的这一部分</span><span style="color: #008000;">
#</span><span style="color: #008000;">     除了写在yuan_back的视图函数中,必须还要写在login中,代码重复,没有解耦.</span>

<span style="color: #008000;">#</span><span style="color: #008000;">   2 the most important: url没有跳转到/yuan_back/,而是还在/login/,所以当刷新后</span><span style="color: #008000;">
#</span><span style="color: #008000;">     又得重新登录.</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code <br></span></div>
<h2>七 Template基础&nbsp;</h2>
<h3>模板系统的介绍</h3>
<p>你可能已经注意到我们在例子视图中返回文本的方式有点特别。 也就是说，HTML被直接硬编码在 Python代码之中。</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">def</span><span style="color: #000000;"> current_datetime(request):
    now </span>=<span style="color: #000000;"> datetime.datetime.now()
    html </span>= <span style="color: #800000;">"</span><span style="color: #800000;">&lt;html&gt;&lt;body&gt;It is now %s.&lt;/body&gt;&lt;/html&gt;</span><span style="color: #800000;">"</span> %<span style="color: #000000;"> now
    </span><span style="color: #0000ff;">return</span> HttpResponse(html)</pre>
</div>
<p>尽管这种技术便于解释视图是如何工作的，但直接将HTML硬编码到你的视图里却并不是一个好主意。 让我们来看一下为什么：</p>
<ul class="simple">
<li id="cn5" class="cn">
<p id="cn5" class="first cn">对页面设计进行的任何改变都必须对 Python 代码进行相应的修改。 站点设计的修改往往比底层 Python 代码的修改要频繁得多，因此如果可以在不进行 Python 代码修改的情况下变更设计，那将会方便得多。</p>
</li>
</ul>
<ul class="simple">
<li id="cn6" class="cn">
<p id="cn6" class="first cn">Python 代码编写和 HTML 设计是两项不同的工作，大多数专业的网站开发环境都将他们分配给不同的人员（甚至不同部门）来完成。 设计者和HTML/CSS的编码人员不应该被要求去编辑Python的代码来完成他们的工作。</p>
</li>
</ul>
<ul class="simple">
<li id="cn7" class="cn">
<p id="cn7" class="first cn">程序员编写 Python代码和设计人员制作模板两项工作同时进行的效率是最高的，远胜于让一个人等待另一个人完成对某个既包含 Python又包含 HTML 的文件的编辑工作。</p>
</li>
</ul>
<p>基于这些原因，将页面的设计和Python的代码分离开会更干净简洁更容易维护。 我们可以使用 Django的&nbsp;<em>模板系统</em>&nbsp;(Template System)来实现这种模式，这就是本章要具体讨论的问题。</p>
<p>-<span style="color: #800080;">-----------------------------------------------------------------<span style="font-size: 16px;"><strong>模板语法-</strong></span>-----------------------------------------------------------------</span></p>
<h3>一模版的组成</h3>
<p><strong>组成：HTML代码＋逻辑控制代码</strong></p>
<h3>二 逻辑控制代码的组成</h3>
<h4><strong>1 &nbsp;变量（使用双大括号来引用变量）：</strong></h4>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_637733" class="syntaxhighlighter  csharp"><div class="toolbar"><span><a href="https://www.cnblogs.com/yuanchenqi/articles/6083427.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="csharp plain">语法格式：&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {{var_name}}</code></div></div></td></tr></tbody></table></div></div>
</div>
<p class="brush:csharp;gutter:true;"><span style="color: #000080;"><strong>－－－－－－Template和Context对象 </strong></span></p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;2154cce6-c8a9-455a-997b-e709de018101&#39;)"><img id="code_img_closed_2154cce6-c8a9-455a-997b-e709de018101" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_2154cce6-c8a9-455a-997b-e709de018101" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;2154cce6-c8a9-455a-997b-e709de018101&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_2154cce6-c8a9-455a-997b-e709de018101" class="cnblogs_code_hide">
<pre>&gt;&gt;&gt;<span style="color: #000000;"> python manange.py shell  (进入该django项目的环境)
</span>&gt;&gt;&gt; <span style="color: #0000ff;">from</span> django.template <span style="color: #0000ff;">import</span><span style="color: #000000;"> Context, Template
</span>&gt;&gt;&gt; t = Template(<span style="color: #800000;">'</span><span style="color: #800000;">My name is {{ name }}.</span><span style="color: #800000;">'</span><span style="color: #000000;">)
</span>&gt;&gt;&gt; c = Context({<span style="color: #800000;">'</span><span style="color: #800000;">name</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">Stephane</span><span style="color: #800000;">'</span><span style="color: #000000;">})
</span>&gt;&gt;&gt;<span style="color: #000000;"> t.render(c)
</span><span style="color: #800000;">'</span><span style="color: #800000;">My name is Stephane.</span><span style="color: #800000;">'</span>


<span style="color: #008000;">#</span><span style="color: #008000;"> 同一模板，多个上下文，一旦有了模板对象，你就可以通过它渲染多个context，无论何时我们都可以</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 像这样使用同一模板源渲染多个context，只进行 一次模板创建然后多次调用render()方法渲染会</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 更为高效：</span><span style="color: #008000;">
#</span><span style="color: #008000;"> Low</span>
<span style="color: #0000ff;">for</span> name <span style="color: #0000ff;">in</span> (<span style="color: #800000;">'</span><span style="color: #800000;">John</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">Julie</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">Pat</span><span style="color: #800000;">'</span><span style="color: #000000;">):
    t </span>= Template(<span style="color: #800000;">'</span><span style="color: #800000;">Hello, {{ name }}</span><span style="color: #800000;">'</span><span style="color: #000000;">)
    </span><span style="color: #0000ff;">print</span> t.render(Context({<span style="color: #800000;">'</span><span style="color: #800000;">name</span><span style="color: #800000;">'</span><span style="color: #000000;">: name}))

</span><span style="color: #008000;">#</span><span style="color: #008000;"> Good</span>
t = Template(<span style="color: #800000;">'</span><span style="color: #800000;">Hello, {{ name }}</span><span style="color: #800000;">'</span><span style="color: #000000;">)
</span><span style="color: #0000ff;">for</span> name <span style="color: #0000ff;">in</span> (<span style="color: #800000;">'</span><span style="color: #800000;">John</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">Julie</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">Pat</span><span style="color: #800000;">'</span><span style="color: #000000;">):
    </span><span style="color: #0000ff;">print</span> t.render(Context({<span style="color: #800000;">'</span><span style="color: #800000;">name</span><span style="color: #800000;">'</span>: name}))</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>&nbsp;Django 模板解析非常快捷。 大部分的解析工作都是在后台通过对简短正则表达式一次性调用来完成。 这和基于 XML 的模板引擎形成鲜明对比，那些引擎承担了 XML 解析器的开销，且往往比 Django 模板渲染引擎要慢上几个数量级。</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;82a0e322-5149-403c-b694-d0ce80264b48&#39;)"><img id="code_img_closed_82a0e322-5149-403c-b694-d0ce80264b48" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_82a0e322-5149-403c-b694-d0ce80264b48" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;82a0e322-5149-403c-b694-d0ce80264b48&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_82a0e322-5149-403c-b694-d0ce80264b48" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">from</span> django.shortcuts <span style="color: #0000ff;">import</span><span style="color: #000000;"> render,HttpResponse
</span><span style="color: #0000ff;">from</span> django.template.loader <span style="color: #0000ff;">import</span> get_template <span style="color: #008000;">#</span><span style="color: #008000;">记得导入</span><span style="color: #008000;">
#</span><span style="color: #008000;"> Create your views here.</span>


<span style="color: #0000ff;">import</span><span style="color: #000000;"> datetime
</span><span style="color: #0000ff;">from</span> django.template <span style="color: #0000ff;">import</span><span style="color: #000000;"> Template,Context

</span><span style="color: #008000;">#</span><span style="color: #008000;"> def current_time(req):</span>
    <span style="color: #008000;">#</span><span style="color: #008000;">原始的视图函数</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> now=datetime.datetime.now()</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> html="&lt;html&gt;&lt;body&gt;现在时刻：&lt;h1&gt;%s.&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;" %now</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> return HttpResponse(html)</span>



<span style="color: #008000;">#</span><span style="color: #008000;"> def current_time(req):</span>

      <span style="color: #008000;">#</span><span style="color: #008000;">django模板修改的视图函数</span><span style="color: #008000;">
#</span><span style="color: #008000;">     now=datetime.datetime.now()</span><span style="color: #008000;">
#</span><span style="color: #008000;">     t=Template('&lt;html&gt;&lt;body&gt;现在时刻是:&lt;h1 style="color:red"&gt;{{current_date}}&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;')</span>
      <span style="color: #008000;">#</span><span style="color: #008000;">t=get_template('current_datetime.html')</span><span style="color: #008000;">
#</span><span style="color: #008000;">     c=Context({'current_date':now})</span><span style="color: #008000;">
#</span><span style="color: #008000;">     html=t.render(c)</span><span style="color: #008000;">
#</span><span style="color: #008000;">     return HttpResponse(html)</span>

<span style="color: #008000;">#</span><span style="color: #008000;">另一种写法(推荐)</span>

<span style="color: #0000ff;">def</span><span style="color: #000000;"> current_time(req):

    now</span>=<span style="color: #000000;">datetime.datetime.now()

    </span><span style="color: #0000ff;">return</span> render(req, <span style="color: #800000;">'</span><span style="color: #800000;">current_datetime.html</span><span style="color: #800000;">'</span>, {<span style="color: #800000;">'</span><span style="color: #800000;">current_date</span><span style="color: #800000;">'</span>:now})</pre>
</div>
<span class="cnblogs_code_collapse">推荐方式</span></div>
<p id="cn86" class="cn"><span style="color: #000080;"><strong><strong>－－－－－－</strong>深度变量的查找（万能的句点号）</strong></span></p>
<p id="cn87" class="cn">在到目前为止的例子中，我们通过 context 传递的简单参数值主要是字符串，然而，模板系统能够非常简洁地处理更加复杂的数据结构，例如list、dictionary和自定义的对象。</p>
<p id="cn88" class="cn">在 Django 模板中遍历复杂数据结构的关键是句点字符 (<tt class="docutils literal"><span class="pre">.</span></tt>)。</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;69ad8321-ff0b-47de-ab06-46de9c2f7dc3&#39;)"><img id="code_img_closed_69ad8321-ff0b-47de-ab06-46de9c2f7dc3" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_69ad8321-ff0b-47de-ab06-46de9c2f7dc3" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;69ad8321-ff0b-47de-ab06-46de9c2f7dc3&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_69ad8321-ff0b-47de-ab06-46de9c2f7dc3" class="cnblogs_code_hide">
<pre><span style="color: #008000;">#</span><span style="color: #008000;">最好是用几个例子来说明一下。</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 首先，句点可用于访问列表索引，例如：</span>

&gt;&gt;&gt; <span style="color: #0000ff;">from</span> django.template <span style="color: #0000ff;">import</span><span style="color: #000000;"> Template, Context
</span>&gt;&gt;&gt; t = Template(<span style="color: #800000;">'</span><span style="color: #800000;">Item 2 is {{ items.2 }}.</span><span style="color: #800000;">'</span><span style="color: #000000;">)
</span>&gt;&gt;&gt; c = Context({<span style="color: #800000;">'</span><span style="color: #800000;">items</span><span style="color: #800000;">'</span>: [<span style="color: #800000;">'</span><span style="color: #800000;">apples</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">bananas</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">carrots</span><span style="color: #800000;">'</span><span style="color: #000000;">]})
</span>&gt;&gt;&gt;<span style="color: #000000;"> t.render(c)
</span><span style="color: #800000;">'</span><span style="color: #800000;">Item 2 is carrots.</span><span style="color: #800000;">'</span>

<span style="color: #008000;">#</span><span style="color: #008000;">假设你要向模板传递一个 Python 字典。 要通过字典键访问该字典的值，可使用一个句点：</span>
&gt;&gt;&gt; <span style="color: #0000ff;">from</span> django.template <span style="color: #0000ff;">import</span><span style="color: #000000;"> Template, Context
</span>&gt;&gt;&gt; person = {<span style="color: #800000;">'</span><span style="color: #800000;">name</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">Sally</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">age</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">43</span><span style="color: #800000;">'</span><span style="color: #000000;">}
</span>&gt;&gt;&gt; t = Template(<span style="color: #800000;">'</span><span style="color: #800000;">{{ person.name }} is {{ person.age }} years old.</span><span style="color: #800000;">'</span><span style="color: #000000;">)
</span>&gt;&gt;&gt; c = Context({<span style="color: #800000;">'</span><span style="color: #800000;">person</span><span style="color: #800000;">'</span><span style="color: #000000;">: person})
</span>&gt;&gt;&gt;<span style="color: #000000;"> t.render(c)
</span><span style="color: #800000;">'</span><span style="color: #800000;">Sally is 43 years old.</span><span style="color: #800000;">'</span>

<span style="color: #008000;">#</span><span style="color: #008000;">同样，也可以通过句点来访问对象的属性。 比方说， Python 的 datetime.date 对象有</span><span style="color: #008000;">
#</span><span style="color: #008000;">year 、 month 和 day 几个属性，你同样可以在模板中使用句点来访问这些属性：</span>

&gt;&gt;&gt; <span style="color: #0000ff;">from</span> django.template <span style="color: #0000ff;">import</span><span style="color: #000000;"> Template, Context
</span>&gt;&gt;&gt; <span style="color: #0000ff;">import</span><span style="color: #000000;"> datetime
</span>&gt;&gt;&gt; d = datetime.date(1993, 5, 2<span style="color: #000000;">)
</span>&gt;&gt;&gt;<span style="color: #000000;"> d.year
</span>1993
&gt;&gt;&gt;<span style="color: #000000;"> d.month
</span>5
&gt;&gt;&gt;<span style="color: #000000;"> d.day
</span>2
&gt;&gt;&gt; t = Template(<span style="color: #800000;">'</span><span style="color: #800000;">The month is {{ date.month }} and the year is {{ date.year }}.</span><span style="color: #800000;">'</span><span style="color: #000000;">)
</span>&gt;&gt;&gt; c = Context({<span style="color: #800000;">'</span><span style="color: #800000;">date</span><span style="color: #800000;">'</span><span style="color: #000000;">: d})
</span>&gt;&gt;&gt;<span style="color: #000000;"> t.render(c)
</span><span style="color: #800000;">'</span><span style="color: #800000;">The month is 5 and the year is 1993.</span><span style="color: #800000;">'</span>

<span style="color: #008000;">#</span><span style="color: #008000;"> 这个例子使用了一个自定义的类，演示了通过实例变量加一点(dots)来访问它的属性，这个方法适</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 用于任意的对象。</span>
&gt;&gt;&gt; <span style="color: #0000ff;">from</span> django.template <span style="color: #0000ff;">import</span><span style="color: #000000;"> Template, Context
</span>&gt;&gt;&gt; <span style="color: #0000ff;">class</span><span style="color: #000000;"> Person(object):
...     </span><span style="color: #0000ff;">def</span> <span style="color: #800080;">__init__</span><span style="color: #000000;">(self, first_name, last_name):
...         self.first_name, self.last_name </span>=<span style="color: #000000;"> first_name, last_name
</span>&gt;&gt;&gt; t = Template(<span style="color: #800000;">'</span><span style="color: #800000;">Hello, {{ person.first_name }} {{ person.last_name }}.</span><span style="color: #800000;">'</span><span style="color: #000000;">)
</span>&gt;&gt;&gt; c = Context({<span style="color: #800000;">'</span><span style="color: #800000;">person</span><span style="color: #800000;">'</span>: Person(<span style="color: #800000;">'</span><span style="color: #800000;">John</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">Smith</span><span style="color: #800000;">'</span><span style="color: #000000;">)})
</span>&gt;&gt;&gt;<span style="color: #000000;"> t.render(c)
</span><span style="color: #800000;">'</span><span style="color: #800000;">Hello, John Smith.</span><span style="color: #800000;">'</span>

<span style="color: #008000;">#</span><span style="color: #008000;"> 点语法也可以用来引用对象的方法。 例如，每个 Python 字符串都有 upper() 和 isdigit()</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 方法，你在模板中可以使用同样的句点语法来调用它们：</span>
&gt;&gt;&gt; <span style="color: #0000ff;">from</span> django.template <span style="color: #0000ff;">import</span><span style="color: #000000;"> Template, Context
</span>&gt;&gt;&gt; t = Template(<span style="color: #800000;">'</span><span style="color: #800000;">{{ var }} -- {{ var.upper }} -- {{ var.isdigit }}</span><span style="color: #800000;">'</span><span style="color: #000000;">)
</span>&gt;&gt;&gt; t.render(Context({<span style="color: #800000;">'</span><span style="color: #800000;">var</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">hello</span><span style="color: #800000;">'</span><span style="color: #000000;">}))
</span><span style="color: #800000;">'</span><span style="color: #800000;">hello -- HELLO -- False</span><span style="color: #800000;">'</span>
&gt;&gt;&gt; t.render(Context({<span style="color: #800000;">'</span><span style="color: #800000;">var</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">123</span><span style="color: #800000;">'</span><span style="color: #000000;">}))
</span><span style="color: #800000;">'</span><span style="color: #800000;">123 -- 123 -- True</span><span style="color: #800000;">'</span>

<span style="color: #008000;">#</span><span style="color: #008000;"> 注意这里调用方法时并* 没有* 使用圆括号 而且也无法给该方法传递参数；你只能调用不需参数的</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 方法。</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p><span style="font-size: 14px; color: #000080;"><strong><strong>－－－－－－</strong>变量的过滤器(filter)的使用</strong></span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_808230" class="syntaxhighlighter  csharp"><div class="toolbar"><span><a href="https://www.cnblogs.com/yuanchenqi/articles/6083427.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="csharp plain">语法格式：&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {{obj|filter:param}}</code></div></div></td></tr></tbody></table></div></div>
</div>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;fcc382d5-5ebc-45ab-ab30-3e81ba2b5616&#39;)"><img id="code_img_closed_fcc382d5-5ebc-45ab-ab30-3e81ba2b5616" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_fcc382d5-5ebc-45ab-ab30-3e81ba2b5616" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;fcc382d5-5ebc-45ab-ab30-3e81ba2b5616&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_fcc382d5-5ebc-45ab-ab30-3e81ba2b5616" class="cnblogs_code_hide">
<pre> <span style="color: #008000;">#</span><span style="color: #008000;"> 1  add          ：   给变量加上相应的值</span>
   <span style="color: #008000;">#
</span>   <span style="color: #008000;">#</span><span style="color: #008000;"> 2  addslashes   :    给变量中的引号前加上斜线</span>
   <span style="color: #008000;">#
</span>   <span style="color: #008000;">#</span><span style="color: #008000;"> 3  capfirst     :    首字母大写</span>
   <span style="color: #008000;">#
</span>   <span style="color: #008000;">#</span><span style="color: #008000;"> 4  cut          ：   从字符串中移除指定的字符</span>
   <span style="color: #008000;">#
</span>   <span style="color: #008000;">#</span><span style="color: #008000;"> 5  date         ：   格式化日期字符串</span>
   <span style="color: #008000;">#
</span>   <span style="color: #008000;">#</span><span style="color: #008000;"> 6  default      ：   如果值是False,就替换成设置的默认值，否则就是用本来的值</span>
   <span style="color: #008000;">#
</span>   <span style="color: #008000;">#</span><span style="color: #008000;"> 7  default_if_none:  如果值是None，就替换成设置的默认值，否则就使用本来的值</span>


<span style="color: #008000;">#</span><span style="color: #008000;">实例:</span>

<span style="color: #008000;">#</span><span style="color: #008000;">value1="aBcDe"</span>
{{ value1|upper }}&lt;br&gt;

<span style="color: #008000;">#</span><span style="color: #008000;">value2=5</span>
{{ value2|add:3 }}&lt;br&gt;

<span style="color: #008000;">#</span><span style="color: #008000;">value3='he  llo wo r ld'</span>
{{ value3|cut:<span style="color: #800000;">'</span> <span style="color: #800000;">'</span> }}&lt;br&gt;

<span style="color: #008000;">#</span><span style="color: #008000;">import datetime</span><span style="color: #008000;">
#</span><span style="color: #008000;">value4=datetime.datetime.now()</span>
{{ value4|date:<span style="color: #800000;">'</span><span style="color: #800000;">Y-m-d</span><span style="color: #800000;">'</span> }}&lt;br&gt;

<span style="color: #008000;">#</span><span style="color: #008000;">value5=[]</span>
{{ value5|default:<span style="color: #800000;">'</span><span style="color: #800000;">空的</span><span style="color: #800000;">'</span> }}&lt;br&gt;

<span style="color: #008000;">#</span><span style="color: #008000;">value6='&lt;a href="#"&gt;跳转&lt;/a&gt;'</span>
<span style="color: #000000;">
{{ value6 }}

{</span>% autoescape off %<span style="color: #000000;">}
  {{ value6 }}
{</span>% endautoescape %<span style="color: #000000;">}

{{ value6</span>|safe }}&lt;br&gt;<span style="color: #000000;">

{{ value6</span>|<span style="color: #000000;">striptags }}

</span><span style="color: #008000;">#</span><span style="color: #008000;">value7='1234'</span>
{{ value7|filesizeformat }}&lt;br&gt;<span style="color: #000000;">
{{ value7</span>|first }}&lt;br&gt;<span style="color: #000000;">
{{ value7</span>|length }}&lt;br&gt;<span style="color: #000000;">
{{ value7</span>|slice:<span style="color: #800000;">"</span><span style="color: #800000;">:-1</span><span style="color: #800000;">"</span> }}&lt;br&gt;

<span style="color: #008000;">#</span><span style="color: #008000;">value8='http://www.baidu.com/?a=1&amp;b=3'</span>
{{ value8|urlencode }}&lt;br&gt;<span style="color: #000000;">
    value9</span>=<span style="color: #800000;">'</span><span style="color: #800000;">hello I am yuan</span><span style="color: #800000;">'</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h4>2 标签(tag)的使用（使用大括号和百分比的组合来表示使用tag）</h4>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_118448" class="syntaxhighlighter  csharp"><div class="toolbar"><span><a href="https://www.cnblogs.com/yuanchenqi/articles/6083427.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="csharp plain">{% tags %}</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="color: #000080;"><strong><strong>－－－－－－</strong>{% if %} 的使用</strong>&nbsp;</span></p>
<p>{% if %}标签计算一个变量值，如果是“true”，即它存在、不为空并且不是false的boolean值,系统则会显示{% if %}和{% endif %}间的所有内容</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;7bea3a95-887a-4095-af33-e3d4f641cc27&#39;)"><img id="code_img_closed_7bea3a95-887a-4095-af33-e3d4f641cc27" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_7bea3a95-887a-4095-af33-e3d4f641cc27" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;7bea3a95-887a-4095-af33-e3d4f641cc27&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_7bea3a95-887a-4095-af33-e3d4f641cc27" class="cnblogs_code_hide">
<pre>{% <span style="color: #0000ff;">if</span> num &gt;= 100 <span style="color: #0000ff;">and</span> 8 %<span style="color: #000000;">}

    {</span>% <span style="color: #0000ff;">if</span> num &gt; 200 %<span style="color: #000000;">}
        </span>&lt;p&gt;num大于200&lt;/p&gt;<span style="color: #000000;">
    {</span>% <span style="color: #0000ff;">else</span> %<span style="color: #000000;">}
        </span>&lt;p&gt;num大于100小于200&lt;/p&gt;<span style="color: #000000;">
    {</span>% endif %<span style="color: #000000;">}

{</span>% <span style="color: #0000ff;">elif</span> num &lt; 100%<span style="color: #000000;">}
    </span>&lt;p&gt;num小于100&lt;/p&gt;<span style="color: #000000;">

{</span>% <span style="color: #0000ff;">else</span> %<span style="color: #000000;">}
    </span>&lt;p&gt;num等于100&lt;/p&gt;<span style="color: #000000;">

{</span>% endif %<span style="color: #000000;">}



{</span>% <span style="color: #0000ff;">if</span> %<span style="color: #000000;">} 标签接受and，or或者not来测试多个变量值或者否定一个给定的变量
{</span>% <span style="color: #0000ff;">if</span> %<span style="color: #000000;">} 标签不允许同一标签里同时出现and和or，否则逻辑容易产生歧义，例如下面的标签是不合法的：

{</span>% <span style="color: #0000ff;">if</span> obj1 <span style="color: #0000ff;">and</span> obj2 <span style="color: #0000ff;">or</span> obj3 %}  </pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p><span style="color: #000080;"><strong><strong>－－－－－－</strong>{% for %}的使用</strong></span></p>
<p>{% for %}标签允许你按顺序遍历一个序列中的各个元素,每次循环模板系统都会渲染{% for %}和{% endfor %}之间的所有内容</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;0e3494ed-dc73-4f9b-ab33-33d67be8bb70&#39;)"><img id="code_img_closed_0e3494ed-dc73-4f9b-ab33-33d67be8bb70" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_0e3494ed-dc73-4f9b-ab33-33d67be8bb70" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;0e3494ed-dc73-4f9b-ab33-33d67be8bb70&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_0e3494ed-dc73-4f9b-ab33-33d67be8bb70" class="cnblogs_code_hide">
<pre>&lt;ul&gt;<span style="color: #000000;">
{</span>% <span style="color: #0000ff;">for</span> obj <span style="color: #0000ff;">in</span> list %<span style="color: #000000;">}
    </span>&lt;li&gt;{{ obj.name }}&lt;/li&gt;<span style="color: #000000;">
{</span>% endfor %<span style="color: #000000;">}
</span>&lt;/ul&gt;


<span style="color: #008000;">#</span><span style="color: #008000;">在标签里添加reversed来反序循环列表：</span>
<span style="color: #000000;">
    {</span>% <span style="color: #0000ff;">for</span> obj <span style="color: #0000ff;">in</span> list reversed %<span style="color: #000000;">}
    ...
    {</span>% endfor %<span style="color: #000000;">}

</span><span style="color: #008000;">#</span><span style="color: #008000;">{% for %}标签可以嵌套：</span>
<span style="color: #000000;">
    {</span>% <span style="color: #0000ff;">for</span> country <span style="color: #0000ff;">in</span> countries %<span style="color: #000000;">}
        </span>&lt;h1&gt;{{ country.name }}&lt;/h1&gt;
        &lt;ul&gt;<span style="color: #000000;">
         {</span>% <span style="color: #0000ff;">for</span> city <span style="color: #0000ff;">in</span> country.city_list %<span style="color: #000000;">}
            </span>&lt;li&gt;{{ city }}&lt;/li&gt;<span style="color: #000000;">
         {</span>% endfor %<span style="color: #000000;">}
        </span>&lt;/ul&gt;<span style="color: #000000;">
    {</span>% endfor %<span style="color: #000000;">}


</span><span style="color: #008000;">#</span><span style="color: #008000;">系统不支持中断循环，系统也不支持continue语句，{% for %}标签内置了一个forloop模板变量，</span><span style="color: #008000;">
#</span><span style="color: #008000;">这个变量含有一些属性可以提供给你一些关于循环的信息</span>

1<span style="color: #000000;">，forloop.counter表示循环的次数，它从1开始计数，第一次循环设为1:

    {</span>% <span style="color: #0000ff;">for</span> item <span style="color: #0000ff;">in</span> todo_list %<span style="color: #000000;">}
        </span>&lt;p&gt;{{ forloop.counter }}: {{ item }}&lt;/p&gt;<span style="color: #000000;">
    {</span>% endfor %<span style="color: #000000;">}
</span>2<span style="color: #000000;">，forloop.counter0 类似于forloop.counter，但它是从0开始计数，第一次循环设为0
</span>3<span style="color: #000000;">，forloop.revcounter
</span>4<span style="color: #000000;">，forloop.revcounter0
</span>5<span style="color: #000000;">，forloop.first当第一次循环时值为True，在特别情况下很有用：

    
    {</span>% <span style="color: #0000ff;">for</span> object <span style="color: #0000ff;">in</span> objects %<span style="color: #000000;">}   
         {</span>% <span style="color: #0000ff;">if</span> forloop.first %}&lt;li <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">first</span><span style="color: #800000;">"</span>&gt;{% <span style="color: #0000ff;">else</span> %}&lt;li&gt;{% endif %<span style="color: #000000;">}   
         {{ object }}   
        </span>&lt;/li&gt;<span style="color: #000000;">  
    {</span>% endfor %<span style="color: #000000;">}  
    
</span><span style="color: #008000;">#</span><span style="color: #008000;"> 富有魔力的forloop变量只能在循环中得到，当模板解析器到达{% endfor %}时forloop就消失了</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 如果你的模板context已经包含一个叫forloop的变量，Django会用{% for %}标签替代它</span><span style="color: #008000;">
#</span><span style="color: #008000;"> Django会在for标签的块中覆盖你定义的forloop变量的值</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 在其他非循环的地方，你的forloop变量仍然可用</span>


<span style="color: #008000;">#</span><span style="color: #008000;">{% empty %}</span>
<span style="color: #000000;">
{{li }}
      {</span>%  <span style="color: #0000ff;">for</span> i <span style="color: #0000ff;">in</span> li %<span style="color: #000000;">}
          </span>&lt;li&gt;{{ forloop.counter0 }}----{{ i }}&lt;/li&gt;<span style="color: #000000;">
      {</span>% empty %<span style="color: #000000;">}
          </span>&lt;li&gt;this <span style="color: #0000ff;">is</span> empty!&lt;/li&gt;<span style="color: #000000;">
      {</span>% endfor %<span style="color: #000000;">}

</span><span style="color: #008000;">#</span><span style="color: #008000;">         [11, 22, 33, 44, 55]</span><span style="color: #008000;">
#</span><span style="color: #008000;">            0----11</span><span style="color: #008000;">
#</span><span style="color: #008000;">            1----22</span><span style="color: #008000;">
#</span><span style="color: #008000;">            2----33</span><span style="color: #008000;">
#</span><span style="color: #008000;">            3----44</span><span style="color: #008000;">
#</span><span style="color: #008000;">            4----55</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p><span style="color: #000080;"><strong><strong>－－－－－－</strong>{%csrf_token%}：csrf_token标签</strong></span></p>
<p>&nbsp; &nbsp; &nbsp;用于生成csrf_token的标签，用于防治跨站攻击验证。注意如果你在view的index里用的是render_to_response方法，不会生效</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp; 其实，这里是会生成一个input标签，和其他表单标签一起提交给后台的。</p>
<p><span style="color: #000080;"><strong><strong>－－－－－－</strong>{% url %}: &nbsp;引用路由配置的地址</strong></span></p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;dbb142fc-e867-4953-a92d-b811a4195335&#39;)"><img id="code_img_closed_dbb142fc-e867-4953-a92d-b811a4195335" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_dbb142fc-e867-4953-a92d-b811a4195335" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;dbb142fc-e867-4953-a92d-b811a4195335&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_dbb142fc-e867-4953-a92d-b811a4195335" class="cnblogs_code_hide">
<pre>&lt;form action=<span style="color: #800000;">"</span><span style="color: #800000;">{% url </span><span style="color: #800000;">"</span>bieming<span style="color: #800000;">"</span><span style="color: #800000;">%}</span><span style="color: #800000;">"</span> &gt;
          &lt;input type=<span style="color: #800000;">"</span><span style="color: #800000;">text</span><span style="color: #800000;">"</span>&gt;
          &lt;input type=<span style="color: #800000;">"</span><span style="color: #800000;">submit</span><span style="color: #800000;">"</span>value=<span style="color: #800000;">"</span><span style="color: #800000;">提交</span><span style="color: #800000;">"</span>&gt;<span style="color: #000000;">
          {</span>%csrf_token%<span style="color: #000000;">}
</span>&lt;/form&gt;</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p><span style="color: #000080;"><strong><strong>－－－－－－</strong>{% with %}:用更简单的变量名替代复杂的变量名</strong></span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_704541" class="syntaxhighlighter  csharp"><div class="toolbar"><span><a href="https://www.cnblogs.com/yuanchenqi/articles/6083427.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="csharp plain">{% with total=fhjsaldfhjsdfhlasdfhljsdal %} {{ total }} {% endwith %}</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="color: #000080;"><strong><strong>－－－－－－</strong>{% verbatim %}: 禁止render</strong></span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_748754" class="syntaxhighlighter  csharp"><div class="toolbar"><span><a href="https://www.cnblogs.com/yuanchenqi/articles/6083427.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="csharp plain">{% verbatim %}</code></div><div class="line number2 index1 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">{{ hello }}</code></div><div class="line number3 index2 alt2"><code class="csharp plain">{% endverbatim %}</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><strong><span style="color: #000080;"><strong>－－－－－－</strong>{% load %}:&nbsp;加载标签库</span> <br></strong></p>
<h4>3<strong> 自定义filter和<strong>simple_tag</strong></strong></h4>
<p><span style="color: #000080;"><strong><strong>－－－－－－</strong>a、在app中创建templatetags模块(必须的)</strong></span></p>
<p><span style="color: #000080;"><strong><strong>－－－－－－</strong>b、创建任意 .py 文件，如：my_tags.py</strong></span></p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;ac87efcf-e45e-46ec-945f-fa939ccd14a1&#39;)"><img id="code_img_closed_ac87efcf-e45e-46ec-945f-fa939ccd14a1" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_ac87efcf-e45e-46ec-945f-fa939ccd14a1" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;ac87efcf-e45e-46ec-945f-fa939ccd14a1&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_ac87efcf-e45e-46ec-945f-fa939ccd14a1" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">from</span> django <span style="color: #0000ff;">import</span><span style="color: #000000;"> template
</span><span style="color: #0000ff;">from</span> django.utils.safestring <span style="color: #0000ff;">import</span><span style="color: #000000;"> mark_safe

register </span>= template.Library()   <span style="color: #008000;">#</span><span style="color: #008000;">register的名字是固定的,不可改变</span>
<span style="color: #000000;">

@register.filter
</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> filter_multi(v1,v2):
    </span><span style="color: #0000ff;">return</span>  v1 *<span style="color: #000000;"> v2


@register.simple_tag
</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> simple_tag_multi(v1,v2):
    </span><span style="color: #0000ff;">return</span>  v1 *<span style="color: #000000;"> v2


@register.simple_tag
</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> my_input(id,arg):
    result </span>= <span style="color: #800000;">"</span><span style="color: #800000;">&lt;input type='text' id='%s' class='%s' /&gt;</span><span style="color: #800000;">"</span> %<span style="color: #000000;">(id,arg,)
    </span><span style="color: #0000ff;">return</span> mark_safe(result)</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p><span style="color: #000080;"><strong><strong>－－－－－－</strong>c、在使用自定义simple_tag和filter的html文件中导入之前创建的 my_tags.py ：{% load my_tags %}</strong></span></p>
<p><span style="color: #000080;"><strong><strong>－－－－－－</strong>d、使用simple_tag和filter（如何调用）</strong></span></p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;6dbef1a6-8c72-4a70-a9f5-a3655fe11c5d&#39;)"><img id="code_img_closed_6dbef1a6-8c72-4a70-a9f5-a3655fe11c5d" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_6dbef1a6-8c72-4a70-a9f5-a3655fe11c5d" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;6dbef1a6-8c72-4a70-a9f5-a3655fe11c5d&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_6dbef1a6-8c72-4a70-a9f5-a3655fe11c5d" class="cnblogs_code_hide">
<pre>-------------------------------<span style="color: #000000;">.html
{</span>% load xxx %}   <span style="color: #008000;">#</span><span style="color: #008000;">首行</span>
    
    
    
    
 <span style="color: #008000;">#</span><span style="color: #008000;"> num=12</span>
{{ num|filter_multi:2 }} <span style="color: #008000;">#</span><span style="color: #008000;">24</span>
<span style="color: #000000;">
{{ num</span>|filter_multi:<span style="color: #800000;">"</span><span style="color: #800000;">[22,333,4444]</span><span style="color: #800000;">"</span><span style="color: #000000;"> }}


{</span>% simple_tag_multi 2 5 %<span style="color: #000000;">}  参数不限,但不能放在if for语句中
{</span>% simple_tag_multi num 5 %}</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p><span style="color: #000080;"><strong><strong>－－－－－－</strong>e、在settings中的INSTALLED_APPS配置当前app，不然django无法找到自定义的simple_tag.</strong></span></p>
<p><strong><span style="color: #800080;">注意：</span></strong></p>
<p>filter可以用在if等语句后，simple_tag不可以</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;67ee868e-17b0-4480-bd1b-daa96555d8dc&#39;)"><img id="code_img_closed_67ee868e-17b0-4480-bd1b-daa96555d8dc" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_67ee868e-17b0-4480-bd1b-daa96555d8dc" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;67ee868e-17b0-4480-bd1b-daa96555d8dc&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_67ee868e-17b0-4480-bd1b-daa96555d8dc" class="cnblogs_code_hide">
<pre>{% <span style="color: #0000ff;">if</span> num|filter_multi:30 &gt; 100 %<span style="color: #000000;">}
    {{ num</span>|filter_multi:30<span style="color: #000000;"> }}
{</span>% endif %}</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h4><strong> 4 <strong>extend模板继承</strong></strong></h4>
<p><span style="color: #000080;"><strong><span style="font-size: 16px;"><tt class="docutils literal"><span class="pre"><strong>－－－－－－</strong>include</span></tt>&nbsp;</span>模板标签</strong></span></p>
<p><span style="font-size: 14px;">在讲解了模板加载机制之后，我们再介绍一个利用该机制的内建模板标签：&nbsp;<tt class="docutils literal"><span class="pre">{%&nbsp;<span class="pre">include&nbsp;<span class="pre">%}</span></span></span></tt>&nbsp;。该标签允许在（模板中）包含其它的模板的内容。 标签的参数是所要包含的模板名称，可以是一个变量，也可以是用单/双引号硬编码的字符串。 每当在多个模板中出现相同的代码时，就应该考虑是否要使用&nbsp;<tt class="docutils literal"><span class="pre">{%&nbsp;<span class="pre">include&nbsp;<span class="pre">%}</span></span></span></tt>&nbsp;来减少重复。</span></p>
<p id="cn386" class="cn"><span style="color: #000080;"><strong>－－－－－－extend(继承)模板标签</strong></span></p>
<p id="cn387" class="cn">到目前为止，我们的模板范例都只是些零星的 HTML 片段，但在实际应用中，你将用 Django 模板系统来创建整个 HTML 页面。 这就带来一个常见的 Web 开发问题： 在整个网站中，如何减少共用页面区域（比如站点导航）所引起的重复和冗余代码？</p>
<p id="cn388" class="cn">解决该问题的传统做法是使用&nbsp;<em>服务器端的 includes</em>&nbsp;，你可以在 HTML 页面中使用该指令将一个网页嵌入到另一个中。 事实上， Django 通过刚才讲述的&nbsp;<tt class="docutils literal"><span class="pre">{%&nbsp;<span class="pre">include&nbsp;<span class="pre">%}</span></span></span></tt>&nbsp;支持了这种方法。 但是用 Django 解决此类问题的首选方法是使用更加优雅的策略——&nbsp;<em>模板继承</em>&nbsp;。</p>
<p id="cn389" class="cn">本质上来说，模板继承就是先构造一个基础框架模板，而后在其子模板中对它所包含站点公用部分和定义块进行重载。</p>
<p id="cn390" class="cn">让我们通过修改&nbsp;<tt class="docutils literal"><span class="pre">current_datetime.html</span></tt>&nbsp;文件，为&nbsp;<tt class="docutils literal"><span class="pre">current_datetime</span></tt>&nbsp;创建一个更加完整的模板来体会一下这种做法：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;53034c68-6709-4b0b-91dd-e5022fb7636b&#39;)"><img id="code_img_closed_53034c68-6709-4b0b-91dd-e5022fb7636b" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_53034c68-6709-4b0b-91dd-e5022fb7636b" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;53034c68-6709-4b0b-91dd-e5022fb7636b&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_53034c68-6709-4b0b-91dd-e5022fb7636b" class="cnblogs_code_hide">
<pre>&lt;!DOCTYPE HTML PUBLIC <span style="color: #800000;">"</span><span style="color: #800000;">-//W3C//DTD HTML 4.01//EN</span><span style="color: #800000;">"</span>&gt;
&lt;html lang=<span style="color: #800000;">"</span><span style="color: #800000;">en</span><span style="color: #800000;">"</span>&gt;
&lt;head&gt;
    &lt;title&gt;The current time&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;My helpful timestamp site&lt;/h1&gt;
    &lt;p&gt;It <span style="color: #0000ff;">is</span> now {{ current_date }}.&lt;/p&gt;
 
    &lt;hr&gt;
    &lt;p&gt;Thanks <span style="color: #0000ff;">for</span> visiting my site.&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>这看起来很棒，但如果我们要为&nbsp;<tt class="docutils literal"><span class="pre">hours_ahead</span></tt>&nbsp;视图创建另一个模板会发生什么事情呢？</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;c504d06a-ce57-4d1b-a6c8-48cf36fb736b&#39;)"><img id="code_img_closed_c504d06a-ce57-4d1b-a6c8-48cf36fb736b" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_c504d06a-ce57-4d1b-a6c8-48cf36fb736b" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;c504d06a-ce57-4d1b-a6c8-48cf36fb736b&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_c504d06a-ce57-4d1b-a6c8-48cf36fb736b" class="cnblogs_code_hide">
<pre>&lt;!DOCTYPE HTML PUBLIC <span style="color: #800000;">"</span><span style="color: #800000;">-//W3C//DTD HTML 4.01//EN</span><span style="color: #800000;">"</span>&gt;
&lt;html lang=<span style="color: #800000;">"</span><span style="color: #800000;">en</span><span style="color: #800000;">"</span>&gt;
&lt;head&gt;
    &lt;title&gt;Future time&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;My helpful timestamp site&lt;/h1&gt;
    &lt;p&gt;In {{ hour_offset }} hour(s), it will be {{ next_time }}.&lt;/p&gt;
 
    &lt;hr&gt;
    &lt;p&gt;Thanks <span style="color: #0000ff;">for</span> visiting my site.&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;　　</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p id="cn396" class="cn">很明显，我们刚才重复了大量的 HTML 代码。 想象一下，如果有一个更典型的网站，它有导航条、样式表，可能还有一些 JavaScript 代码，事情必将以向每个模板填充各种冗余的 HTML 而告终。</p>
<p id="cn397" class="cn">解决这个问题的服务器端 include 方案是找出两个模板中的共同部分，将其保存为不同的模板片段，然后在每个模板中进行 include。 也许你会把模板头部的一些代码保存为&nbsp;<tt class="docutils literal"><span class="pre">header.html</span></tt>&nbsp;文件：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;ef6d1330-c944-4d3c-91aa-583113b3602d&#39;)"><img id="code_img_closed_ef6d1330-c944-4d3c-91aa-583113b3602d" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_ef6d1330-c944-4d3c-91aa-583113b3602d" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;ef6d1330-c944-4d3c-91aa-583113b3602d&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_ef6d1330-c944-4d3c-91aa-583113b3602d" class="cnblogs_code_hide">
<pre>&lt;!DOCTYPE HTML PUBLIC <span style="color: #800000;">"</span><span style="color: #800000;">-//W3C//DTD HTML 4.01//EN</span><span style="color: #800000;">"</span>&gt;
&lt;html lang=<span style="color: #800000;">"</span><span style="color: #800000;">en</span><span style="color: #800000;">"</span>&gt;
&lt;head&gt;</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>你可能会把底部保存到文件&nbsp;<tt class="docutils literal"><span class="pre">footer.html</span></tt>&nbsp;:</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;cb48badb-f77a-41ba-ab19-331d60447355&#39;)"><img id="code_img_closed_cb48badb-f77a-41ba-ab19-331d60447355" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_cb48badb-f77a-41ba-ab19-331d60447355" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;cb48badb-f77a-41ba-ab19-331d60447355&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_cb48badb-f77a-41ba-ab19-331d60447355" class="cnblogs_code_hide">
<pre>&lt;hr&gt;
    &lt;p&gt;Thanks <span style="color: #0000ff;">for</span> visiting my site.&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p id="cn403" class="cn">对基于 include 的策略，头部和底部的包含很简单。 麻烦的是中间部分。 在此范例中，每个页面都有一个<tt class="docutils literal"><span class="pre">&lt;h1&gt;My&nbsp;<span class="pre">helpful&nbsp;<span class="pre">timestamp&nbsp;<span class="pre">site&lt;/h1&gt;</span></span></span></span></tt>&nbsp;标题，但是这个标题不能放在&nbsp;<tt class="docutils literal"><span class="pre">header.html</span></tt>&nbsp;中，因为每个页面的&nbsp;<tt class="docutils literal"><span class="pre">&lt;title&gt;</span></tt>&nbsp;是不同的。 如果我们将&nbsp;<tt class="docutils literal"><span class="pre">&lt;h1&gt;</span></tt>&nbsp;包含在头部，我们就不得不包含&nbsp;<tt class="docutils literal"><span class="pre">&lt;title&gt;</span></tt>&nbsp;，但这样又不允许在每个页面对它进行定制。 何去何从呢？</p>
<p id="cn404" class="cn">Django 的模板继承系统解决了这些问题。 你可以将其视为服务器端 include 的逆向思维版本。 你可以对那些<em>不同</em>&nbsp;的代码段进行定义，而不是&nbsp;<em>共同</em>&nbsp;代码段。</p>
<p id="cn405" class="cn">第一步是定义&nbsp;基础模板,该框架之后将由子模板所继承。 以下是我们目前所讲述范例的基础模板：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;80ba373d-69e0-4c39-a98d-70ff08b93cc3&#39;)"><img id="code_img_closed_80ba373d-69e0-4c39-a98d-70ff08b93cc3" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_80ba373d-69e0-4c39-a98d-70ff08b93cc3" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;80ba373d-69e0-4c39-a98d-70ff08b93cc3&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_80ba373d-69e0-4c39-a98d-70ff08b93cc3" class="cnblogs_code_hide">
<pre>&lt;!DOCTYPE HTML PUBLIC <span style="color: #800000;">"</span><span style="color: #800000;">-//W3C//DTD HTML 4.01//EN</span><span style="color: #800000;">"</span>&gt;
&lt;html lang=<span style="color: #800000;">"</span><span style="color: #800000;">en</span><span style="color: #800000;">"</span>&gt;
&lt;head&gt;
    &lt;title&gt;{% block title %}{% endblock %}&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;My helpful timestamp site&lt;/h1&gt;<span style="color: #000000;">
    {</span>% block content %}{% endblock %<span style="color: #000000;">}
    {</span>% block footer %<span style="color: #000000;">}
    </span>&lt;hr&gt;
    &lt;p&gt;Thanks <span style="color: #0000ff;">for</span> visiting my site.&lt;/p&gt;<span style="color: #000000;">
    {</span>% endblock %<span style="color: #000000;">}
</span>&lt;/body&gt;
&lt;/html&gt;</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>这个叫做&nbsp;<tt class="docutils literal"><span class="pre">base.html</span></tt>&nbsp;的模板定义了一个简单的 HTML 框架文档，我们将在本站点的所有页面中使用。 子模板的作用就是重载、添加或保留那些块的内容。 （如果你一直按顺序学习到这里，保存这个文件到你的template目录下，命名为&nbsp;<tt class="docutils literal"><span class="pre">base.html</span></tt>&nbsp;.）</p>
<p id="cn409" class="cn">我们使用模板标签：&nbsp;<tt class="docutils literal"><span class="pre">{%&nbsp;<span class="pre">block&nbsp;<span class="pre">%}</span></span></span></tt>&nbsp;。 所有的&nbsp;<tt class="docutils literal"><span class="pre">{%&nbsp;<span class="pre">block&nbsp;<span class="pre">%}</span></span></span></tt>&nbsp;标签告诉模板引擎，子模板可以重载这些部分。 每个<tt class="docutils literal"><span class="pre">{%&nbsp;<span class="pre">block&nbsp;<span class="pre">%}</span></span></span></tt>标签所要做的是告诉模板引擎，该模板下的这一块内容将有可能被子模板覆盖。</p>
<p id="cn410" class="cn">现在我们已经有了一个基本模板，我们可以修改&nbsp;<tt class="docutils literal"><span class="pre">current_datetime.html</span></tt>&nbsp;模板来 使用它：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;d05f986c-0315-4500-bfdf-8713d14a6e66&#39;)"><img id="code_img_closed_d05f986c-0315-4500-bfdf-8713d14a6e66" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_d05f986c-0315-4500-bfdf-8713d14a6e66" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;d05f986c-0315-4500-bfdf-8713d14a6e66&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_d05f986c-0315-4500-bfdf-8713d14a6e66" class="cnblogs_code_hide">
<pre>{% extends <span style="color: #800000;">"</span><span style="color: #800000;">base.html</span><span style="color: #800000;">"</span> %<span style="color: #000000;">}
 
{</span>% block title %}The current time{% endblock %<span style="color: #000000;">}
 
{</span>% block content %<span style="color: #000000;">}
</span>&lt;p&gt;It <span style="color: #0000ff;">is</span> now {{ current_date }}.&lt;/p&gt;<span style="color: #000000;">
{</span>% endblock %}</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>再为&nbsp;<tt class="docutils literal"><span class="pre">hours_ahead</span></tt>&nbsp;视图创建一个模板，看起来是这样的：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;8a4f449e-e78a-47da-a3eb-2372268c75d7&#39;)"><img id="code_img_closed_8a4f449e-e78a-47da-a3eb-2372268c75d7" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_8a4f449e-e78a-47da-a3eb-2372268c75d7" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;8a4f449e-e78a-47da-a3eb-2372268c75d7&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_8a4f449e-e78a-47da-a3eb-2372268c75d7" class="cnblogs_code_hide">
<pre>{% extends <span style="color: #800000;">"</span><span style="color: #800000;">base.html</span><span style="color: #800000;">"</span> %<span style="color: #000000;">}
 
{</span>% block title %}Future time{% endblock %<span style="color: #000000;">}
 
{</span>% block content %<span style="color: #000000;">}
</span>&lt;p&gt;In {{ hour_offset }} hour(s), it will be {{ next_time }}.&lt;/p&gt;<span style="color: #000000;">
{</span>% endblock %}</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p id="cn416" class="cn">看起来很漂亮是不是？ 每个模板只包含对自己而言&nbsp;<em>独一无二</em>&nbsp;的代码。 无需多余的部分。 如果想进行站点级的设计修改，仅需修改&nbsp;<tt class="docutils literal"><span class="pre">base.html</span></tt>&nbsp;，所有其它模板会立即反映出所作修改。</p>
<p id="cn417" class="cn">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #000080;"><strong> 以下是其工作方式： </strong></span></p>
<p id="cn418" class="cn">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 在加载&nbsp;<tt class="docutils literal"><span class="pre">current_datetime.html</span></tt>&nbsp;模板时，模板引擎发现了&nbsp;<tt class="docutils literal"><span class="pre">{%&nbsp;<span class="pre">extends&nbsp;<span class="pre">%}</span></span></span></tt>&nbsp;标签， 注意到该模板是一个子模板。 模板引擎立即装载其父模板，即本例中的&nbsp;<tt class="docutils literal"><span class="pre">base.html</span></tt>&nbsp;。此时，模板引擎注意到&nbsp;<tt class="docutils literal"><span class="pre">base.html</span></tt>&nbsp;中的三个&nbsp;<tt class="docutils literal"><span class="pre">{%&nbsp;<span class="pre">block&nbsp;<span class="pre">%}</span></span></span></tt>&nbsp;标签，并用子模板的内容替换这些 block 。因此，引擎将会使用我们在&nbsp;<tt class="docutils literal"><span class="pre">{&nbsp;<span class="pre">block&nbsp;<span class="pre">title&nbsp;<span class="pre">%}</span></span></span></span></tt>&nbsp;中定义的标题，对&nbsp;<tt class="docutils literal"><span class="pre">{%&nbsp;<span class="pre">block&nbsp;<span class="pre">content&nbsp;<span class="pre">%}</span></span></span></span></tt>&nbsp;也是如此。 所以，网页标题一块将由<tt class="docutils literal"><span class="pre">{%&nbsp;<span class="pre">block&nbsp;<span class="pre">title&nbsp;<span class="pre">%}</span></span></span></span></tt>替换，同样地，网页的内容一块将由&nbsp;<tt class="docutils literal"><span class="pre">{%&nbsp;<span class="pre">block&nbsp;<span class="pre">content&nbsp;<span class="pre">%}</span></span></span></span></tt>替换。</p>
<p id="cn421" class="cn">&nbsp;&nbsp;&nbsp;&nbsp; 注意由于子模板并没有定义&nbsp;<tt class="docutils literal"><span class="pre">footer</span></tt>&nbsp;块，模板系统将使用在父模板中定义的值。 父模板&nbsp;<tt class="docutils literal"><span class="pre">{%&nbsp;<span class="pre">block&nbsp;<span class="pre">%}</span></span></span></tt>&nbsp;标签中的内容总是被当作一条退路。继承并不会影响到模板的上下文。 换句话说，任何处在继承树上的模板都可以访问到你传到模板中的每一个模板变量。你可以根据需要使用任意多的继承次数。 使用继承的一种常见方式是下面的三层法：</p>
<div class="cnblogs_code">
<pre><span style="color: #000000;">   &lt;1&gt; 创建 base.html 模板，在其中定义站点的主要外观感受。 这些都是不常修改甚至从不修改的部分。
   &lt;2&gt; 为网站的每个区域创建 base_SECTION.html 模板(例如, base_photos.html 和 base_forum.html )。这些模板对base.html 进行拓展，<br>       并包含区域特定的风格与设计。
   &lt;3&gt; 为每种类型的页面创建独立的模板，例如论坛页面或者图片库。 这些模板拓展相应的区域模板。</span></pre>
</div>
<p id="cn425" class="cn">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 这个方法可最大限度地重用代码，并使得向公共区域（如区域级的导航）添加内容成为一件轻松的工作。</p>
<p id="cn426" class="cn">以下是使用模板继承的一些诀窍：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;cb881d70-824c-4186-a217-0821fc4d0fa9&#39;)"><img id="code_img_closed_cb881d70-824c-4186-a217-0821fc4d0fa9" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_cb881d70-824c-4186-a217-0821fc4d0fa9" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;cb881d70-824c-4186-a217-0821fc4d0fa9&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_cb881d70-824c-4186-a217-0821fc4d0fa9" class="cnblogs_code_hide">
<pre>&lt;1&gt;如果在模板中使用 {% extends %<span style="color: #000000;">} ，必须保证其为模板中的第一个模板标记。 否则，模板继承将不起作用。

 </span>&lt;2&gt;一般来说，基础模板中的 {% block %<span style="color: #000000;">} 标签越多越好。 记住，子模板不必定义父模板中所有的代码块，因此
    你可以用合理的缺省值对一些代码块进行填充，然后只对子模板所需的代码块进行（重）定义。 俗话说，钩子越
    多越好。

 </span>&lt;3&gt;如果发觉自己在多个模板之间拷贝代码，你应该考虑将该代码段放置到父模板的某个 {% block %<span style="color: #000000;">} 中。
    如果你需要访问父模板中的块的内容，使用 {{ block.super }}这个标签吧，这一个魔法变量将会表现出父模
    板中的内容。 如果只想在上级代码块基础上添加内容，而不是全部重载，该变量就显得非常有用了。

 </span>&lt;4&gt;不允许在同一个模板中定义多个同名的 {% block %<span style="color: #000000;">} 。 存在这样的限制是因为block 标签的工作方式是双向的。
    也就是说，block 标签不仅挖了一个要填的坑，也定义了在父模板中这个坑所填充的内容。如果模板中出现了两个
    相同名称的 {</span>% block %} 标签，父模板将无从得知要使用哪个块的内容。</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h2>八 Models</h2>
<h3>数据库的配置</h3>
<h4>1&nbsp;&nbsp;&nbsp; django默认支持sqlite，mysql, oracle,postgresql数据库。</h4>
<p>&nbsp; &nbsp; <strong>&nbsp;&lt;1&gt; sqlite</strong></p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; django默认使用sqlite的数据库，默认自带sqlite的数据库驱动 , 引擎名称：django.db.backends.sqlite3</p>
<p>&nbsp; &nbsp; &nbsp;<strong>&lt;2&gt; mysql</strong></p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 引擎名称：django.db.backends.mysql</p>
<h4>2 &nbsp; &nbsp;mysql驱动程序</h4>
<ul>
<li>&nbsp;&nbsp; MySQLdb(mysql python)</li>
<li>&nbsp;&nbsp; mysqlclient</li>
<li>&nbsp;&nbsp; MySQL</li>
<li>&nbsp;&nbsp; PyMySQL(纯python的mysql驱动程序)</li>
</ul>
<h4>3 &nbsp; &nbsp; 在django的项目中会默认使用sqlite数据库，在settings里有如下设置：</h4>
<p>&nbsp; &nbsp; &nbsp; &nbsp;<img src="./Web框架Django_files/877318-20160725174034403-1279755536.png" alt="" width="292" height="89">&nbsp;&nbsp; &nbsp;</p>
<p>如果我们想要更改数据库，需要修改如下：</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<img src="./Web框架Django_files/877318-20160725174434450-97368753.png" alt="" width="280" height="121">&nbsp; &nbsp;</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;388a8497-e4ff-4837-a0b7-aef31206edc8&#39;)"><img id="code_img_closed_388a8497-e4ff-4837-a0b7-aef31206edc8" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_388a8497-e4ff-4837-a0b7-aef31206edc8" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;388a8497-e4ff-4837-a0b7-aef31206edc8&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_388a8497-e4ff-4837-a0b7-aef31206edc8" class="cnblogs_code_hide">
<pre>DATABASES =<span style="color: #000000;"> {

    </span><span style="color: #800000;">'</span><span style="color: #800000;">default</span><span style="color: #800000;">'</span><span style="color: #000000;">: {

        </span><span style="color: #800000;">'</span><span style="color: #800000;">ENGINE</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">django.db.backends.mysql</span><span style="color: #800000;">'</span><span style="color: #000000;">, 

        </span><span style="color: #800000;">'</span><span style="color: #800000;">NAME</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">books</span><span style="color: #800000;">'</span>,    <span style="color: #008000;">#</span><span style="color: #008000;">你的数据库名称</span>

        <span style="color: #800000;">'</span><span style="color: #800000;">USER</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">root</span><span style="color: #800000;">'</span>,   <span style="color: #008000;">#</span><span style="color: #008000;">你的数据库用户名</span>

        <span style="color: #800000;">'</span><span style="color: #800000;">PASSWORD</span><span style="color: #800000;">'</span>: <span style="color: #800000;">''</span>, <span style="color: #008000;">#</span><span style="color: #008000;">你的数据库密码</span>

        <span style="color: #800000;">'</span><span style="color: #800000;">HOST</span><span style="color: #800000;">'</span>: <span style="color: #800000;">''</span>, <span style="color: #008000;">#</span><span style="color: #008000;">你的数据库主机，留空默认为localhost</span>

        <span style="color: #800000;">'</span><span style="color: #800000;">PORT</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">3306</span><span style="color: #800000;">'</span>, <span style="color: #008000;">#</span><span style="color: #008000;">你的数据库端口</span>
<span style="color: #000000;">
    }

}</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p><span style="color: #800080;"><strong>注意：</strong></span></p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;4bf18b7f-7726-4aa4-9906-7329a67a6fc6&#39;)"><img id="code_img_closed_4bf18b7f-7726-4aa4-9906-7329a67a6fc6" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_4bf18b7f-7726-4aa4-9906-7329a67a6fc6" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;4bf18b7f-7726-4aa4-9906-7329a67a6fc6&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_4bf18b7f-7726-4aa4-9906-7329a67a6fc6" class="cnblogs_code_hide">
<pre><span style="color: #000000;">NAME即数据库的名字，在mysql连接前该数据库必须已经创建，而上面的sqlite数据库下的db.sqlite3则是项目自动创建

USER和PASSWORD分别是数据库的用户名和密码。

设置完后，再启动我们的Django项目前，我们需要激活我们的mysql。

然后，启动项目，会报错：no module named MySQLdb

这是因为django默认你导入的驱动是MySQLdb，可是MySQLdb对于py3有很大问题，所以我们需要的驱动是PyMySQL

所以，我们只需要找到项目名文件下的__init__,在里面写入：

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> pymysql
pymysql.install_as_MySQLdb()

问题解决！</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h3>ORM(对象关系映射)</h3>
<p>用于实现面向对象编程语言里不同类型系统的数据之间的转换，换言之，就是用面向对象的方式去操作数据库的创建表以及增删改查等操作。</p>
<p><span style="color: #ff6600;">优点： 1 ORM使得我们的通用数据库交互变得简单易行，而且完全不用考虑该死的SQL语句。快速开发，由此而来。</span></p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 可以避免一些新手程序猿写sql语句带来的性能问题。</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 比如 我们查询User表中的所有字段:</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<img src="./Web框架Django_files/877318-20160726125657669-710701713.png" alt="" width="516" height="363"></p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 新手可能会用select ＊ from &nbsp;auth_user,这样会因为多了一个匹配动作而影响效率的。</p>
<p>&nbsp;<span style="color: #ff6600;">缺点：1&nbsp; 性能有所牺牲，不过现在的各种ORM框架都在尝试各种方法，比如缓存，延迟加载登来减轻这个问题。效果很显著。</span></p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2 &nbsp;对于个别复杂查询，ORM仍然力不从心，为了解决这个问题，ORM一般也支持写raw sql。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3&nbsp; 通过QuerySet的query属性查询对应操作的sql语句</p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_911279" class="syntaxhighlighter  csharp"><div class="toolbar"><span><a href="https://www.cnblogs.com/yuanchenqi/articles/6083427.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="csharp plain">author_obj=models.Author.objects.filter(id=2)</code></div><div class="line number2 index1 alt1"><code class="csharp plain">print(author_obj.query)</code></div></div></td></tr></tbody></table></div></div>
</div>
<p>&nbsp; &nbsp; &nbsp;下面要开始学习Django ORM语法了，为了更好的理解，我们来做一个基本的 书籍/作者/出版商 数据库结构。 我们这样做是因为 这是一个众所周知的例子，很多SQL有关的书籍也常用这个举例。</p>
<h4>表(模型)的创建：</h4>
<p>实例：我们来假定下面这些概念，字段和关系</p>
<p>作者模型：一个作者有姓名。</p>
<p>作者详细模型：把作者的详情放到详情表，包含性别，email地址和出生日期，作者详情模型和作者模型之间是一对一的关系（one－to－one）（类似于每个人和他的身份证之间的关系），在大多数情况下我们没有必要将他们拆分成两张表，这里只是引出一对一的概念。</p>
<p>出版商模型：出版商有名称，地址，所在城市，省，国家和网站。</p>
<p>书籍模型：书籍有书名和出版日期，一本书可能会有多个作者，一个作者也可以写多本书，所以作者和书籍的关系就是多对多的关联关系（many－to－many），一本书只应该由一个出版商出版，所以出版商和书籍是一对多关联关系（one－to－many），也被称作外键。</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;df1fd0c4-cfc3-48e8-8ceb-77ced7bcaa84&#39;)"><img id="code_img_closed_df1fd0c4-cfc3-48e8-8ceb-77ced7bcaa84" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_df1fd0c4-cfc3-48e8-8ceb-77ced7bcaa84" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;df1fd0c4-cfc3-48e8-8ceb-77ced7bcaa84&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_df1fd0c4-cfc3-48e8-8ceb-77ced7bcaa84" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">from</span> django.db <span style="color: #0000ff;">import</span> models&lt;br&gt;
<span style="color: #0000ff;">class</span><span style="color: #000000;"> Publisher(models.Model):
    name </span>= models.CharField(max_length=30, verbose_name=<span style="color: #800000;">"</span><span style="color: #800000;">名称</span><span style="color: #800000;">"</span><span style="color: #000000;">)
    address </span>= models.CharField(<span style="color: #800000;">"</span><span style="color: #800000;">地址</span><span style="color: #800000;">"</span>, max_length=50<span style="color: #000000;">)
    city </span>= models.CharField(<span style="color: #800000;">'</span><span style="color: #800000;">城市</span><span style="color: #800000;">'</span>,max_length=60<span style="color: #000000;">)
    state_province </span>= models.CharField(max_length=30<span style="color: #000000;">)
    country </span>= models.CharField(max_length=50<span style="color: #000000;">)
    website </span>=<span style="color: #000000;"> models.URLField()
 
    </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Meta:
        verbose_name </span>= <span style="color: #800000;">'</span><span style="color: #800000;">出版商</span><span style="color: #800000;">'</span><span style="color: #000000;">
        verbose_name_plural </span>=<span style="color: #000000;"> verbose_name
 
    </span><span style="color: #0000ff;">def</span> <span style="color: #800080;">__str__</span><span style="color: #000000;">(self):
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> self.name
 
</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Author(models.Model):
    name </span>= models.CharField(max_length=30<span style="color: #000000;">)
    </span><span style="color: #0000ff;">def</span> <span style="color: #800080;">__str__</span><span style="color: #000000;">(self):
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> self.name
 
</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> AuthorDetail(models.Model):
    sex </span>= models.BooleanField(max_length=1, choices=((0, <span style="color: #800000;">'</span><span style="color: #800000;">男</span><span style="color: #800000;">'</span>),(1, <span style="color: #800000;">'</span><span style="color: #800000;">女</span><span style="color: #800000;">'</span><span style="color: #000000;">),))
    email </span>=<span style="color: #000000;"> models.EmailField()
    address </span>= models.CharField(max_length=50<span style="color: #000000;">)
    birthday </span>=<span style="color: #000000;"> models.DateField()
    author </span>=<span style="color: #000000;"> models.OneToOneField(Author)
 
</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Book(models.Model):
    title </span>= models.CharField(max_length=100<span style="color: #000000;">)
    authors </span>=<span style="color: #000000;"> models.ManyToManyField(Author)
    publisher </span>=<span style="color: #000000;"> models.ForeignKey(Publisher)
    publication_date </span>=<span style="color: #000000;"> models.DateField()
    price</span>=models.DecimalField(max_digits=5,decimal_places=2,default=10<span style="color: #000000;">)
    </span><span style="color: #0000ff;">def</span> <span style="color: #800080;">__str__</span><span style="color: #000000;">(self):
        </span><span style="color: #0000ff;">return</span> self.title</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p><span style="color: #000080;">注意1：记得在settings里的INSTALLED_APPS中加入'app01',然后再同步数据库。</span></p>
<p><span style="color: #000080;">注意2: models.ForeignKey("Publish") &amp; models.ForeignKey(Publish)</span></p>
<p><strong><span style="color: #800080;">分析代码：</span></strong></p>
<p>&nbsp; &nbsp; &nbsp;&nbsp; &lt;1&gt;&nbsp; 每个数据模型都是django.db.models.Model的子类，它的父类Model包含了所有必要的和数据库交互的方法。并提供了一个简介漂亮的定义数据库字段的语法。</p>
<p>&nbsp; &nbsp; &nbsp;&nbsp; &lt;2&gt;&nbsp; 每个模型相当于单个数据库表（多对多关系例外，会多生成一张关系表），每个属性也是这个表中的字段。属性名就是字段名，它的类型（例如CharField）相当于数据库的字段类型（例如varchar）。大家可以留意下其它的类型都和数据库里的什么字段对应。</p>
<p>&nbsp; &nbsp; &nbsp;&nbsp; &lt;3&gt;&nbsp; 模型之间的三种关系：一对一，一对多，多对多。</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;一对一：实质就是在主外键（author_id就是foreign key）的关系基础上，给外键加了一个UNIQUE＝True的属性；</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 一对多：就是主外键关系；（foreign key）</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 多对多：(<span>ManyToManyField</span>) 自动创建第三张表(当然我们也可以自己创建第三张表：两个foreign key)</p>
<p>&nbsp; &nbsp; &nbsp;&nbsp; &lt;4&gt; &nbsp;<strong><span style="color: #800080;">模型常用的字段类型参数</span></strong></p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;c4651dac-a97f-4877-8bab-1d03aff8b9f2&#39;)"><img id="code_img_closed_c4651dac-a97f-4877-8bab-1d03aff8b9f2" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_c4651dac-a97f-4877-8bab-1d03aff8b9f2" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;c4651dac-a97f-4877-8bab-1d03aff8b9f2&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_c4651dac-a97f-4877-8bab-1d03aff8b9f2" class="cnblogs_code_hide">
<pre>&lt;1&gt;<span style="color: #000000;"> CharField
        </span><span style="color: #008000;">#</span><span style="color: #008000;">字符串字段, 用于较短的字符串.</span>
        <span style="color: #008000;">#</span><span style="color: #008000;">CharField 要求必须有一个参数 maxlength, 用于从数据库层和Django校验层限制该字段所允许的最大字符数.</span>

&lt;2&gt;<span style="color: #000000;"> IntegerField
       </span><span style="color: #008000;">#</span><span style="color: #008000;">用于保存一个整数.</span>

&lt;3&gt;<span style="color: #000000;"> FloatField
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 一个浮点数. 必须 提供两个参数:</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> 参数    描述</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> max_digits    总位数(不包括小数点和符号)</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> decimal_places    小数位数</span>
                <span style="color: #008000;">#</span><span style="color: #008000;"> 举例来说, 要保存最大值为 999 (小数点后保存2位),你要这样定义字段:</span>
                <span style="color: #008000;">#
</span>                <span style="color: #008000;">#</span><span style="color: #008000;"> models.FloatField(..., max_digits=5, decimal_places=2)</span>
                <span style="color: #008000;">#</span><span style="color: #008000;"> 要保存最大值一百万(小数点后保存10位)的话,你要这样定义:</span>
                <span style="color: #008000;">#
</span>                <span style="color: #008000;">#</span><span style="color: #008000;"> models.FloatField(..., max_digits=19, decimal_places=10)</span>
                <span style="color: #008000;">#</span><span style="color: #008000;"> admin 用一个文本框(&lt;input type="text"&gt;)表示该字段保存的数据.</span>

&lt;4&gt;<span style="color: #000000;"> AutoField
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 一个 IntegerField, 添加记录时它会自动增长. 你通常不需要直接使用这个字段; </span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> 自定义一个主键：my_id=models.AutoField(primary_key=True)</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> 如果你不指定主键的话,系统会自动添加一个主键字段到你的 model.</span>

&lt;5&gt;<span style="color: #000000;"> BooleanField
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> A true/false field. admin 用 checkbox 来表示此类字段.</span>

&lt;6&gt;<span style="color: #000000;"> TextField
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 一个容量很大的文本字段.</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> admin 用一个 &lt;textarea&gt; (文本区域)表示该字段数据.(一个多行编辑框).</span>

&lt;7&gt;<span style="color: #000000;"> EmailField
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 一个带有检查Email合法性的 CharField,不接受 maxlength 参数.</span>

&lt;8&gt;<span style="color: #000000;"> DateField
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 一个日期字段. 共有下列额外的可选参数:</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> Argument    描述</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> auto_now    当对象被保存时,自动将该字段的值设置为当前时间.通常用于表示 "last-modified" 时间戳.</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> auto_now_add    当对象首次被创建时,自动将该字段的值设置为当前时间.通常用于表示对象创建时间.</span>
        <span style="color: #008000;">#</span><span style="color: #008000;">（仅仅在admin中有意义...)</span>

&lt;9&gt;<span style="color: #000000;"> DateTimeField
        </span><span style="color: #008000;">#</span><span style="color: #008000;">  一个日期时间字段. 类似 DateField 支持同样的附加选项.</span>

&lt;10&gt;<span style="color: #000000;"> ImageField
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 类似 FileField, 不过要校验上传对象是否是一个合法图片.#它有两个可选参数:height_field和width_field,</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> 如果提供这两个参数,则图片将按提供的高度和宽度规格保存.     </span>
&lt;11&gt;<span style="color: #000000;"> FileField
     </span><span style="color: #008000;">#</span><span style="color: #008000;"> 一个文件上传字段.</span>
     <span style="color: #008000;">#</span><span style="color: #008000;">要求一个必须有的参数: upload_to, 一个用于保存上载文件的本地文件系统路径. 这个路径必须包含 strftime #formatting, </span>
     <span style="color: #008000;">#</span><span style="color: #008000;">该格式将被上载文件的 date/time </span>
     <span style="color: #008000;">#</span><span style="color: #008000;">替换(so that uploaded files don't fill up the given directory).</span>
     <span style="color: #008000;">#</span><span style="color: #008000;"> admin 用一个&lt;input type="file"&gt;部件表示该字段保存的数据(一个文件上传部件) .</span>

     <span style="color: #008000;">#</span><span style="color: #008000;">注意：在一个 model 中使用 FileField 或 ImageField 需要以下步骤:</span>
            <span style="color: #008000;">#</span><span style="color: #008000;">（1）在你的 settings 文件中, 定义一个完整路径给 MEDIA_ROOT 以便让 Django在此处保存上传文件. </span>
            <span style="color: #008000;">#</span><span style="color: #008000;"> (出于性能考虑,这些文件并不保存到数据库.) 定义MEDIA_URL 作为该目录的公共 URL. 要确保该目录对 </span>
            <span style="color: #008000;">#</span><span style="color: #008000;">  WEB服务器用户帐号是可写的.</span>
            <span style="color: #008000;">#</span><span style="color: #008000;">（2） 在你的 model 中添加 FileField 或 ImageField, 并确保定义了 upload_to 选项,以告诉 Django</span>
            <span style="color: #008000;">#</span><span style="color: #008000;"> 使用 MEDIA_ROOT 的哪个子目录保存上传文件.你的数据库中要保存的只是文件的路径(相对于 MEDIA_ROOT). </span>
            <span style="color: #008000;">#</span><span style="color: #008000;"> 出于习惯你一定很想使用 Django 提供的 get_&lt;#fieldname&gt;_url 函数.举例来说,如果你的 ImageField </span>
            <span style="color: #008000;">#</span><span style="color: #008000;"> 叫作 mug_shot, 你就可以在模板中以 {{ object.#get_mug_shot_url }} 这样的方式得到图像的绝对路径.</span>

&lt;12&gt;<span style="color: #000000;"> URLField
      </span><span style="color: #008000;">#</span><span style="color: #008000;"> 用于保存 URL. 若 verify_exists 参数为 True (默认), 给定的 URL 会预先检查是否存在( 即URL是否被有效装入且</span>
      <span style="color: #008000;">#</span><span style="color: #008000;"> 没有返回404响应).</span>
      <span style="color: #008000;">#</span><span style="color: #008000;"> admin 用一个 &lt;input type="text"&gt; 文本框表示该字段保存的数据(一个单行编辑框)</span>

&lt;13&gt;<span style="color: #000000;"> NullBooleanField
       </span><span style="color: #008000;">#</span><span style="color: #008000;"> 类似 BooleanField, 不过允许 NULL 作为其中一个选项. 推荐使用这个字段而不要用 BooleanField 加 null=True 选项</span>
       <span style="color: #008000;">#</span><span style="color: #008000;"> admin 用一个选择框 &lt;select&gt; (三个可选择的值: "Unknown", "Yes" 和 "No" ) 来表示这种字段数据.</span>

&lt;14&gt;<span style="color: #000000;"> SlugField
       </span><span style="color: #008000;">#</span><span style="color: #008000;"> "Slug" 是一个报纸术语. slug 是某个东西的小小标记(短签), 只包含字母,数字,下划线和连字符.#它们通常用于URLs</span>
       <span style="color: #008000;">#</span><span style="color: #008000;"> 若你使用 Django 开发版本,你可以指定 maxlength. 若 maxlength 未指定, Django 会使用默认长度: 50.  #在</span>
       <span style="color: #008000;">#</span><span style="color: #008000;"> 以前的 Django 版本,没有任何办法改变50 这个长度.</span>
       <span style="color: #008000;">#</span><span style="color: #008000;"> 这暗示了 db_index=True.</span>
       <span style="color: #008000;">#</span><span style="color: #008000;"> 它接受一个额外的参数: prepopulate_from, which is a list of fields from which to auto-#populate </span>
       <span style="color: #008000;">#</span><span style="color: #008000;"> the slug, via JavaScript,in the object's admin form: models.SlugField</span>
       <span style="color: #008000;">#</span><span style="color: #008000;"> (prepopulate_from=("pre_name", "name"))prepopulate_from 不接受 DateTimeFields.</span>

&lt;13&gt;<span style="color: #000000;"> XMLField
        </span><span style="color: #008000;">#</span><span style="color: #008000;">一个校验值是否为合法XML的 TextField,必须提供参数: schema_path, 它是一个用来校验文本的 RelaxNG schema #的文件系统路径.</span>

&lt;14&gt;<span style="color: #000000;"> FilePathField
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 可选项目为某个特定目录下的文件名. 支持三个特殊的参数, 其中第一个是必须提供的.</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> 参数    描述</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> path    必需参数. 一个目录的绝对文件系统路径. FilePathField 据此得到可选项目. </span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> Example: "/home/images".</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> match    可选参数. 一个正则表达式, 作为一个字符串, FilePathField 将使用它过滤文件名.  </span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> 注意这个正则表达式只会应用到 base filename 而不是</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> 路径全名. Example: "foo.*\.txt^", 将匹配文件 foo23.txt 却不匹配 bar.txt 或 foo23.gif.</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> recursive可选参数.要么 True 要么 False. 默认值是 False. 是否包括 path 下面的全部子目录.</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> 这三个参数可以同时使用.</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> match 仅应用于 base filename, 而不是路径全名. 那么,这个例子:</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> FilePathField(path="/home/images", match="foo.*", recursive=True)</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> ...会匹配 /home/images/foo.gif 而不匹配 /home/images/foo/bar.gif</span>

&lt;15&gt;<span style="color: #000000;"> IPAddressField
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 一个字符串形式的 IP 地址, (i.e. "24.124.1.30").</span>
&lt;16&gt;<span style="color: #008000;">#</span><span style="color: #008000;"> CommaSeparatedIntegerField</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> 用于存放逗号分隔的整数值. 类似 CharField, 必须要有maxlength参数.</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;5&gt;&nbsp; <strong><span style="color: #800080;">Field重要参数</span></strong></p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;10447b3b-653a-426f-a13c-585d3930782d&#39;)"><img id="code_img_closed_10447b3b-653a-426f-a13c-585d3930782d" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_10447b3b-653a-426f-a13c-585d3930782d" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;10447b3b-653a-426f-a13c-585d3930782d&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_10447b3b-653a-426f-a13c-585d3930782d" class="cnblogs_code_hide">
<pre>    &lt;1&gt;<span style="color: #000000;"> null ： 数据库中字段是否可以为空

    </span>&lt;2&gt;<span style="color: #000000;"> blank： django的 Admin 中添加数据时是否可允许空值

    </span>&lt;3&gt;<span style="color: #000000;"> default：设定缺省值

    </span>&lt;4&gt;<span style="color: #000000;"> editable：如果为假，admin模式下将不能改写。缺省为真

    </span>&lt;5&gt;<span style="color: #000000;"> primary_key：设置主键，如果没有设置django创建表时会自动加上：
        id </span>= meta.AutoField(<span style="color: #800000;">'</span><span style="color: #800000;">ID</span><span style="color: #800000;">'</span>, primary_key=<span style="color: #000000;">True)
        primary_key</span>=True implies blank=False, null=False <span style="color: #0000ff;">and</span> unique=<span style="color: #000000;">True. Only one
        primary key </span><span style="color: #0000ff;">is</span><span style="color: #000000;"> allowed on an object.

    </span>&lt;6&gt;<span style="color: #000000;"> unique：数据唯一

    </span>&lt;7&gt;<span style="color: #000000;"> verbose_name　　Admin中字段的显示名称

    </span>&lt;8&gt;<span style="color: #000000;"> validator_list：有效性检查。非有效产生 django.core.validators.ValidationError 错误


    </span>&lt;9&gt;<span style="color: #000000;"> db_column，db_index 如果为真将为此字段创建索引

    </span>&lt;10&gt;<span style="color: #000000;">choices：一个用来选择值的2维元组。第一个值是实际存储的值，第二个用来方便进行选择。
                如SEX_CHOICES</span>= (( ‘F’,<span style="color: #800000;">'</span><span style="color: #800000;">Female’),(‘M’,</span><span style="color: #800000;">'</span><span style="color: #000000;">Male’),)
                gender </span>= models.CharField(max_length=2,choices = SEX_CHOICES)</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h4>表的操作(增删改查)：</h4>
<p><span style="color: #003366;"><strong><strong>-------------------------------------</strong>增(create&nbsp; ,&nbsp; save)&nbsp;<strong>-------------------------------</strong></strong></span></p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./Web框架Django_files/copycode.gif" alt="复制代码"></a></span></div>
<pre><span style="color: #0000ff;">from</span> app01.models <span style="color: #0000ff;">import</span> *

    <span style="color: #008000;">#</span><span style="color: #008000;">create方式一:   Author.objects.create(name='Alvin')</span>

    <span style="color: #008000;">#</span><span style="color: #008000;">create方式二:   Author.objects.create(**{"name":"alex"})</span>

    <span style="color: #008000;">#</span><span style="color: #008000;">save方式一:     author=Author(name="alvin")</span>
<span style="color: #000000;">                    author.save()

    </span><span style="color: #008000;">#</span><span style="color: #008000;">save方式二:     author=Author()</span>
                    author.name=<span style="color: #800000;">"</span><span style="color: #800000;">alvin</span><span style="color: #800000;">"</span><span style="color: #000000;">
                    author.save()</span></pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./Web框架Django_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p><strong><span style="color: #800080;">重点来了－－－－－－－&gt;<span style="color: #ff0000;">那么如何创建存在一对多或多对多关系的一本书的信息呢？(如何处理外键关系的字段如一对多的<code class="python spaces"></code><code class="python plain">publisher和</code>多对多的authors)</span></span></strong></p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;046cf4c2-1556-42ca-8a91-7c518216ff61&#39;)"><img id="code_img_closed_046cf4c2-1556-42ca-8a91-7c518216ff61" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_046cf4c2-1556-42ca-8a91-7c518216ff61" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;046cf4c2-1556-42ca-8a91-7c518216ff61&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_046cf4c2-1556-42ca-8a91-7c518216ff61" class="cnblogs_code_hide">
<pre><span style="color: #008000;">#</span><span style="color: #008000;">一对多(ForeignKey):</span>

    <span style="color: #008000;">#</span><span style="color: #008000;">方式一: 由于绑定一对多的字段,比如publish,存到数据库中的字段名叫publish_id,所以我们可以直接给这个</span>
    <span style="color: #008000;">#</span><span style="color: #008000;">       字段设定对应值:</span>
           Book.objects.create(title=<span style="color: #800000;">'</span><span style="color: #800000;">php</span><span style="color: #800000;">'</span><span style="color: #000000;">,
                               publisher_id</span>=2,   <span style="color: #008000;">#</span><span style="color: #008000;">这里的2是指为该book对象绑定了Publisher表中id=2的行对象</span>
                               publication_date=<span style="color: #800000;">'</span><span style="color: #800000;">2017-7-7</span><span style="color: #800000;">'</span><span style="color: #000000;">,
                               price</span>=99<span style="color: #000000;">)


    </span><span style="color: #008000;">#</span><span style="color: #008000;">方式二:</span>
    <span style="color: #008000;">#</span><span style="color: #008000;">       &lt;1&gt; 先获取要绑定的Publisher对象:</span>
        pub_obj=Publisher(name=<span style="color: #800000;">'</span><span style="color: #800000;">河大出版社</span><span style="color: #800000;">'</span>,address=<span style="color: #800000;">'</span><span style="color: #800000;">保定</span><span style="color: #800000;">'</span>,city=<span style="color: #800000;">'</span><span style="color: #800000;">保定</span><span style="color: #800000;">'</span><span style="color: #000000;">,
                state_province</span>=<span style="color: #800000;">'</span><span style="color: #800000;">河北</span><span style="color: #800000;">'</span>,country=<span style="color: #800000;">'</span><span style="color: #800000;">China</span><span style="color: #800000;">'</span>,website=<span style="color: #800000;">'</span><span style="color: #800000;">http://www.hbu.com</span><span style="color: #800000;">'</span><span style="color: #000000;">)
    OR  pub_obj</span>=Publisher.objects.get(id=1<span style="color: #000000;">)

    </span><span style="color: #008000;">#</span><span style="color: #008000;">       &lt;2&gt;将 publisher_id=2 改为  publisher=pub_obj</span>

<span style="color: #008000;">#</span><span style="color: #008000;">多对多(ManyToManyField()):</span>
<span style="color: #000000;">
    author1</span>=Author.objects.get(id=1<span style="color: #000000;">)
    author2</span>=Author.objects.filter(name=<span style="color: #800000;">'</span><span style="color: #800000;">alvin</span><span style="color: #800000;">'</span><span style="color: #000000;">)[0]
    book</span>=Book.objects.get(id=1<span style="color: #000000;">)
    book.authors.add(author1,author2)
    </span><span style="color: #008000;">#</span><span style="color: #008000;">等同于:</span>
    book.authors.add(*<span style="color: #000000;">[author1,author2])
    book.authors.remove(</span>*<span style="color: #000000;">[author1,author2])
    </span><span style="color: #008000;">#</span><span style="color: #008000;">-------------------</span>
    book=models.Book.objects.filter(id__gt=1<span style="color: #000000;">)
    authors</span>=models.Author.objects.filter(id=1<span style="color: #000000;">)[0]
    authors.book_set.add(</span>*<span style="color: #000000;">book)
    authors.book_set.remove(</span>*<span style="color: #000000;">book)
    </span><span style="color: #008000;">#</span><span style="color: #008000;">-------------------</span>
    book.authors.add(1<span style="color: #000000;">)
    book.authors.remove(</span>1<span style="color: #000000;">)
    authors.book_set.add(</span>1<span style="color: #000000;">)
    authors.book_set.remove(</span>1<span style="color: #000000;">)

</span><span style="color: #008000;">#</span><span style="color: #008000;">注意: 如果第三张表是通过models.ManyToManyField()自动创建的,那么绑定关系只有上面一种方式</span><span style="color: #008000;">
#</span><span style="color: #008000;">     如果第三张表是自己创建的:</span>
     <span style="color: #0000ff;">class</span><span style="color: #000000;"> Book2Author(models.Model):
            author</span>=models.ForeignKey(<span style="color: #800000;">"</span><span style="color: #800000;">Author</span><span style="color: #800000;">"</span><span style="color: #000000;">)
            Book</span>=  models.ForeignKey(<span style="color: #800000;">"</span><span style="color: #800000;">Book</span><span style="color: #800000;">"</span><span style="color: #000000;">)
</span><span style="color: #008000;">#</span><span style="color: #008000;">     那么就还有一种方式:</span>
            author_obj=models.Author.objects.filter(id=2<span style="color: #000000;">)[0]
            book_obj  </span>=models.Book.objects.filter(id=3<span style="color: #000000;">)[0]

            s</span>=models.Book2Author.objects.create(author_id=1,Book_id=2<span style="color: #000000;">)
            s.save()
            s</span>=models.Book2Author(author=author_obj,Book_id=1<span style="color: #000000;">)
            s.save()</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p><span style="color: #ff6600;"><strong><span style="color: #003366;"><strong>-----------------------------------------</strong>删（delete）&nbsp;<strong>---------------------------------------------</strong></span></strong></span></p>
<div class="cnblogs_code">
<pre>&gt;&gt;&gt; Book.objects.filter(id=1<span style="color: #000000;">).delete()
(</span>3, {<span style="color: #800000;">'</span><span style="color: #800000;">app01.Book_authors</span><span style="color: #800000;">'</span>: 2, <span style="color: #800000;">'</span><span style="color: #800000;">app01.Book</span><span style="color: #800000;">'</span>: 1})</pre>
</div>
<p>我们表面上删除了一条信息，实际却删除了三条，因为我们删除的这本书在Book_authors表中有两条相关信息，这种删除方式就是django默认的级联删除。</p>
<p><span style="color: #003366;"><strong><strong>如果是多对多的关系： remove()和clear()方法：</strong></strong></span>&nbsp;</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./Web框架Django_files/copycode.gif" alt="复制代码"></a></span></div>
<pre><span style="color: #008000;">#</span><span style="color: #008000;">正向</span>
book = models.Book.objects.filter(id=1<span style="color: #000000;">)

</span><span style="color: #008000;">#</span><span style="color: #008000;">删除第三张表中和女孩1关联的所有关联信息</span>
book.author.clear()        <span style="color: #008000;">#</span><span style="color: #008000;">清空与book中id=1 关联的所有数据</span>
book.author.remove(2)  <span style="color: #008000;">#</span><span style="color: #008000;">可以为id</span>
book.author.remove(*[1,2,3,4])     <span style="color: #008000;">#</span><span style="color: #008000;">可以为列表,前面加*</span>

<span style="color: #008000;">#</span><span style="color: #008000;">反向</span>
author = models.Author.objects.filter(id=1<span style="color: #000000;">)
author.book_set.clear() </span><span style="color: #008000;">#</span><span style="color: #008000;">清空与boy中id=1 关联的所有数据</span></pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./Web框架Django_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p><span style="color: #003366;"><strong><strong>-----------------------------------------</strong></strong><strong>改（</strong>update和save）&nbsp;<strong>----------------------------------------</strong></span></p>
<p>实例：</p>
<p>&nbsp; &nbsp;&nbsp;<img src="./Web框架Django_files/877318-20160727122351763-1427837148.png" alt="" width="595" height="120"></p>
<p>注意：</p>
<p>&lt;1&gt; 第二种方式修改不能用get的原因是：update是QuerySet对象的方法，get返回的是一个model对象，它没有update方法，而filter返回的是一个QuerySet对象(filter里面的条件可能有多个条件符合，比如name＝'alvin',可能有两个name＝'alvin'的行数据)。</p>
<p>&lt;2&gt;<span style="font-size: 15px;"><tt class="docutils literal">在“插入和更新数据”小节中，我们有提到模型的save()方法，这个方法会更新一行里的所有列。 而某些情况下，我们只需要更新行里的某几列。</tt></span></p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;c4731228-f010-4354-90e7-d103029eb14c&#39;)"><img id="code_img_closed_c4731228-f010-4354-90e7-d103029eb14c" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_c4731228-f010-4354-90e7-d103029eb14c" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;c4731228-f010-4354-90e7-d103029eb14c&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_c4731228-f010-4354-90e7-d103029eb14c" class="cnblogs_code_hide">
<pre><span style="color: #008000;">#</span><span style="color: #008000;">---------------- update方法直接设定对应属性----------------</span>
    models.Book.objects.filter(id=3).update(title=<span style="color: #800000;">"</span><span style="color: #800000;">PHP</span><span style="color: #800000;">"</span><span style="color: #000000;">)
    </span><span style="color: #008000;">#</span><span style="color: #008000;">#sql:</span>
    <span style="color: #008000;">#</span><span style="color: #008000;">#UPDATE "app01_book" SET "title" = 'PHP' WHERE "app01_book"."id" = 3; args=('PHP', 3)</span>


<span style="color: #008000;">#</span><span style="color: #008000;">--------------- save方法会将所有属性重新设定一遍,效率低-----------</span>
    obj=models.Book.objects.filter(id=3<span style="color: #000000;">)[0]
    obj.title</span>=<span style="color: #800000;">"</span><span style="color: #800000;">Python</span><span style="color: #800000;">"</span><span style="color: #000000;">
    obj.save()
</span><span style="color: #008000;">#</span><span style="color: #008000;"> SELECT "app01_book"."id", "app01_book"."title", "app01_book"."price", </span><span style="color: #008000;">
#</span><span style="color: #008000;"> "app01_book"."color", "app01_book"."page_num", </span><span style="color: #008000;">
#</span><span style="color: #008000;"> "app01_book"."publisher_id" FROM "app01_book" WHERE "app01_book"."id" = 3 LIMIT 1; </span><span style="color: #008000;">
#</span> <span style="color: #008000;">
#</span><span style="color: #008000;"> UPDATE "app01_book" SET "title" = 'Python', "price" = 3333, "color" = 'red', "page_num" = 556,</span><span style="color: #008000;">
#</span><span style="color: #008000;"> "publisher_id" = 1 WHERE "app01_book"."id" = 3; </span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 在这个例子里我们可以看到Django的save()方法更新了不仅仅是title列的值，还有更新了所有的列。 若title以外的列有可能会被其他的进程所改动的情况下，只更改title列显然是更加明智的。更改某一指定的列，我们可以调用结果集（QuerySet）对象的update()方法,与之等同的SQL语句变得更高效，并且不会引起竞态条件。</p>
<p>此外，update()方法对于任何结果集（QuerySet）均有效，这意味着你可以同时更新多条记录update()方法会返回一个整型数值，表示受影响的记录条数。</p>
<p>注意，这里因为update返回的是一个整形，所以没法用query属性；对于每次创建一个对象，想显示对应的raw sql，需要在settings加上日志记录部分：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;46955246-cd17-4743-9668-5bffb8b7b010&#39;)"><img id="code_img_closed_46955246-cd17-4743-9668-5bffb8b7b010" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_46955246-cd17-4743-9668-5bffb8b7b010" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;46955246-cd17-4743-9668-5bffb8b7b010&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_46955246-cd17-4743-9668-5bffb8b7b010" class="cnblogs_code_hide">
<pre>LOGGING =<span style="color: #000000;"> {
    </span><span style="color: #800000;">'</span><span style="color: #800000;">version</span><span style="color: #800000;">'</span>: 1<span style="color: #000000;">,
    </span><span style="color: #800000;">'</span><span style="color: #800000;">disable_existing_loggers</span><span style="color: #800000;">'</span><span style="color: #000000;">: False,
    </span><span style="color: #800000;">'</span><span style="color: #800000;">handlers</span><span style="color: #800000;">'</span><span style="color: #000000;">: {
        </span><span style="color: #800000;">'</span><span style="color: #800000;">console</span><span style="color: #800000;">'</span><span style="color: #000000;">:{
            </span><span style="color: #800000;">'</span><span style="color: #800000;">level</span><span style="color: #800000;">'</span>:<span style="color: #800000;">'</span><span style="color: #800000;">DEBUG</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">class</span><span style="color: #800000;">'</span>:<span style="color: #800000;">'</span><span style="color: #800000;">logging.StreamHandler</span><span style="color: #800000;">'</span><span style="color: #000000;">,
        },
    },
    </span><span style="color: #800000;">'</span><span style="color: #800000;">loggers</span><span style="color: #800000;">'</span><span style="color: #000000;">: {
        </span><span style="color: #800000;">'</span><span style="color: #800000;">django.db.backends</span><span style="color: #800000;">'</span><span style="color: #000000;">: {
            </span><span style="color: #800000;">'</span><span style="color: #800000;">handlers</span><span style="color: #800000;">'</span>: [<span style="color: #800000;">'</span><span style="color: #800000;">console</span><span style="color: #800000;">'</span><span style="color: #000000;">],
            </span><span style="color: #800000;">'</span><span style="color: #800000;">propagate</span><span style="color: #800000;">'</span><span style="color: #000000;">: True,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">level</span><span style="color: #800000;">'</span>:<span style="color: #800000;">'</span><span style="color: #800000;">DEBUG</span><span style="color: #800000;">'</span><span style="color: #000000;">,
        },
    }
}</span></pre>
</div>
<span class="cnblogs_code_collapse">LOGGING</span></div>
<p><span style="color: #003366;"><strong>注意：如果是多对多的改：</strong></span></p>
<p>&nbsp;</p>
<div class="cnblogs_code">
<pre>    obj=Book.objects.filter(id=1<span style="color: #000000;">)[0]
    author</span>=Author.objects.filter(id__gt=2<span style="color: #000000;">)

    obj.author.clear()
    obj.author.add(</span>*author)</pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #003366;"><strong>---------------------------------------</strong><strong>查（filter，value等) <strong>-------------------------------------</strong></strong></span></p>
<p><span style="color: #800080;"><strong>----------&gt;查询API：</strong></span></p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;878e7290-8d2b-4380-8155-8e899408c9a5&#39;)"><img id="code_img_closed_878e7290-8d2b-4380-8155-8e899408c9a5" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_878e7290-8d2b-4380-8155-8e899408c9a5" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;878e7290-8d2b-4380-8155-8e899408c9a5&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_878e7290-8d2b-4380-8155-8e899408c9a5" class="cnblogs_code_hide">
<pre><span style="color: #008000;">#</span><span style="color: #008000;"> 查询相关API：</span>

<span style="color: #008000;">#</span><span style="color: #008000;">  &lt;1&gt;filter(**kwargs):      它包含了与所给筛选条件相匹配的对象</span>

<span style="color: #008000;">#</span><span style="color: #008000;">  &lt;2&gt;all():                 查询所有结果</span>

<span style="color: #008000;">#</span><span style="color: #008000;">  &lt;3&gt;get(**kwargs):         返回与所给筛选条件相匹配的对象，返回结果有且只有一个，如果符合筛选条件的对象超过一个或者没有都会抛出错误。</span>

<span style="color: #008000;">#</span><span style="color: #008000;">-----------下面的方法都是对查询的结果再进行处理:比如 objects.filter.values()--------</span>

<span style="color: #008000;">#</span><span style="color: #008000;">  &lt;4&gt;values(*field):        返回一个ValueQuerySet——一个特殊的QuerySet，运行后得到的并不是一系列 model的实例化对象，而是一个可迭代的字典序列</span>
                                     
<span style="color: #008000;">#</span><span style="color: #008000;">  &lt;5&gt;exclude(**kwargs):     它包含了与所给筛选条件不匹配的对象</span>

<span style="color: #008000;">#</span><span style="color: #008000;">  &lt;6&gt;order_by(*field):      对查询结果排序</span>

<span style="color: #008000;">#</span><span style="color: #008000;">  &lt;7&gt;reverse():             对查询结果反向排序</span>

<span style="color: #008000;">#</span><span style="color: #008000;">  &lt;8&gt;distinct():            从返回结果中剔除重复纪录</span>

<span style="color: #008000;">#</span><span style="color: #008000;">  &lt;9&gt;values_list(*field):   它与values()非常相似，它返回的是一个元组序列，values返回的是一个字典序列</span>

<span style="color: #008000;">#</span><span style="color: #008000;">  &lt;10&gt;count():              返回数据库中匹配查询(QuerySet)的对象数量。</span>

<span style="color: #008000;">#</span><span style="color: #008000;"> &lt;11&gt;first():               返回第一条记录</span>

<span style="color: #008000;">#</span><span style="color: #008000;"> &lt;12&gt;last():                返回最后一条记录</span>

<span style="color: #008000;">#</span><span style="color: #008000;">  &lt;13&gt;exists():             如果QuerySet包含数据，就返回True，否则返回False。</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p><strong>补充：</strong></p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;cec15313-1b98-498c-b24f-d25db0fb1a69&#39;)"><img id="code_img_closed_cec15313-1b98-498c-b24f-d25db0fb1a69" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_cec15313-1b98-498c-b24f-d25db0fb1a69" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;cec15313-1b98-498c-b24f-d25db0fb1a69&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_cec15313-1b98-498c-b24f-d25db0fb1a69" class="cnblogs_code_hide">
<pre><span style="color: #008000;">#</span><span style="color: #008000;">扩展查询,有时候DJANGO的查询API不能方便的设置查询条件，提供了另外的扩展查询方法extra:</span><span style="color: #008000;">
#</span><span style="color: #008000;">extra(select=None, where=None, params=None, tables=None,order_by=None, select_params=None</span>
<span style="color: #000000;">
(</span>1)  Entry.objects.extra(select={<span style="color: #800000;">'</span><span style="color: #800000;">is_recent</span><span style="color: #800000;">'</span>: <span style="color: #800000;">"</span><span style="color: #800000;">pub_date &gt; '2006-01-01'</span><span style="color: #800000;">"</span><span style="color: #000000;">})
(</span>2<span style="color: #000000;">)  Blog.objects.extra(
        select</span>=SortedDict([(<span style="color: #800000;">'</span><span style="color: #800000;">a</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">%s</span><span style="color: #800000;">'</span>), (<span style="color: #800000;">'</span><span style="color: #800000;">b</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">%s</span><span style="color: #800000;">'</span><span style="color: #000000;">)]),
        select_params</span>=(<span style="color: #800000;">'</span><span style="color: #800000;">one</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">two</span><span style="color: #800000;">'</span><span style="color: #000000;">))

(</span>3)  q = Entry.objects.extra(select={<span style="color: #800000;">'</span><span style="color: #800000;">is_recent</span><span style="color: #800000;">'</span>: <span style="color: #800000;">"</span><span style="color: #800000;">pub_date &gt; '2006-01-01'</span><span style="color: #800000;">"</span><span style="color: #000000;">})
     q </span>= q.extra(order_by = [<span style="color: #800000;">'</span><span style="color: #800000;">-is_recent</span><span style="color: #800000;">'</span><span style="color: #000000;">])

(</span>4)  Entry.objects.extra(where=[<span style="color: #800000;">'</span><span style="color: #800000;">headline=%s</span><span style="color: #800000;">'</span>], params=[<span style="color: #800000;">'</span><span style="color: #800000;">Lennon</span><span style="color: #800000;">'</span>])  </pre>
</div>
<span class="cnblogs_code_collapse">extra</span></div>
<p><strong><span style="color: #800080;">----------&gt;惰性机制：</span></strong></p>
<p>所谓惰性机制：Publisher.objects.all()或者.filter()等都只是返回了一个QuerySet（查询结果集对象），它并不会马上执行sql，而是当调用QuerySet的时候才执行。</p>
<p><strong>QuerySet特点：</strong></p>
<p>&nbsp; &nbsp; &nbsp;&nbsp; &lt;1&gt;&nbsp; 可迭代的</p>
<p>&nbsp; &nbsp; &nbsp;&nbsp; &lt;2&gt;&nbsp; 可切片</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;151addf3-6143-4426-9fca-ae25c1934ce0&#39;)"><img id="code_img_closed_151addf3-6143-4426-9fca-ae25c1934ce0" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_151addf3-6143-4426-9fca-ae25c1934ce0" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;151addf3-6143-4426-9fca-ae25c1934ce0&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_151addf3-6143-4426-9fca-ae25c1934ce0" class="cnblogs_code_hide">
<pre>    <span style="color: #008000;">#</span><span style="color: #008000;">objs=models.Book.objects.all()#[obj1,obj2,ob3...]</span>

    <span style="color: #008000;">#</span><span style="color: #008000;">QuerySet:   可迭代</span>

    <span style="color: #008000;">#</span><span style="color: #008000;"> for obj in objs:#每一obj就是一个行对象</span>
    <span style="color: #008000;">#</span><span style="color: #008000;">     print("obj:",obj)</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> QuerySet:  可切片</span>

    <span style="color: #008000;">#</span><span style="color: #008000;"> print(objs[1])</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> print(objs[1:4])</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> print(objs[::-1])</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p><strong>QuerySet的高效使用：</strong></p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;b7dccf52-4044-4537-9de6-f722b14acfb7&#39;)"><img id="code_img_closed_b7dccf52-4044-4537-9de6-f722b14acfb7" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_b7dccf52-4044-4537-9de6-f722b14acfb7" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;b7dccf52-4044-4537-9de6-f722b14acfb7&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_b7dccf52-4044-4537-9de6-f722b14acfb7" class="cnblogs_code_hide">
<pre>&lt;1&gt;<span style="color: #000000;">Django的queryset是惰性的

     Django的queryset对应于数据库的若干记录（row），通过可选的查询来过滤。例如，下面的代码会得
     到数据库中名字为‘Dave’的所有的人:person_set </span>= Person.objects.filter(first_name=<span style="color: #800000;">"</span><span style="color: #800000;">Dave</span><span style="color: #800000;">"</span><span style="color: #000000;">)
     上面的代码并没有运行任何的数据库查询。你可以使用person_set，给它加上一些过滤条件，或者将它传给某个函数，
     这些操作都不会发送给数据库。这是对的，因为数据库查询是显著影响web应用性能的因素之一。

</span>&lt;2&gt;<span style="color: #000000;">要真正从数据库获得数据，你可以遍历queryset或者使用if queryset,总之你用到数据时就会执行sql.
   为了验证这些,需要在settings里加入 LOGGING(验证方式)
        obj</span>=models.Book.objects.filter(id=3<span style="color: #000000;">)
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> for i in obj:</span>
        <span style="color: #008000;">#</span><span style="color: #008000;">     print(i)</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> if obj:</span>
        <span style="color: #008000;">#</span><span style="color: #008000;">     print("ok")</span>

&lt;3&gt;<span style="color: #000000;">queryset是具有cache的
     当你遍历queryset时，所有匹配的记录会从数据库获取，然后转换成Django的model。这被称为执行
    （evaluation）.这些model会保存在queryset内置的cache中，这样如果你再次遍历这个queryset，
     你不需要重复运行通用的查询。
        obj</span>=models.Book.objects.filter(id=3<span style="color: #000000;">)

        </span><span style="color: #008000;">#</span><span style="color: #008000;"> for i in obj:</span>
        <span style="color: #008000;">#</span><span style="color: #008000;">     print(i)</span>
                          <span style="color: #008000;">#</span><span style="color: #008000;"># models.Book.objects.filter(id=3).update(title="GO")</span>
                          <span style="color: #008000;">#</span><span style="color: #008000;"># obj_new=models.Book.objects.filter(id=3)</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> for i in obj:</span>
        <span style="color: #008000;">#</span><span style="color: #008000;">     print(i)   #LOGGING只会打印一次</span>

&lt;4&gt;<span style="color: #000000;">
     简单的使用if语句进行判断也会完全执行整个queryset并且把数据放入cache，虽然你并不需要这些
     数据！为了避免这个，可以用exists()方法来检查是否有数据：

            obj </span>= Book.objects.filter(id=4<span style="color: #000000;">)
            </span><span style="color: #008000;">#</span><span style="color: #008000;">  exists()的检查可以避免数据放入queryset的cache。</span>
            <span style="color: #0000ff;">if</span><span style="color: #000000;"> obj.exists():
                </span><span style="color: #0000ff;">print</span>(<span style="color: #800000;">"</span><span style="color: #800000;">hello world!</span><span style="color: #800000;">"</span><span style="color: #000000;">)

</span>&lt;5&gt;<span style="color: #000000;">当queryset非常巨大时，cache会成为问题

     处理成千上万的记录时，将它们一次装入内存是很浪费的。更糟糕的是，巨大的queryset可能会锁住系统
     进程，让你的程序濒临崩溃。要避免在遍历数据的同时产生queryset cache，可以使用iterator()方法
     来获取数据，处理完数据就将其丢弃。
        objs </span>=<span style="color: #000000;"> Book.objects.all().iterator()
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> iterator()可以一次只从数据库获取少量数据，这样可以节省内存</span>
        <span style="color: #0000ff;">for</span> obj <span style="color: #0000ff;">in</span><span style="color: #000000;"> objs:
            </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(obj.name)
        </span><span style="color: #008000;">#</span><span style="color: #008000;">BUT,再次遍历没有打印,因为迭代器已经在上一次遍历(next)到最后一次了,没得遍历了</span>
        <span style="color: #0000ff;">for</span> obj <span style="color: #0000ff;">in</span><span style="color: #000000;"> objs:
            </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(obj.name)

     </span><span style="color: #008000;">#</span><span style="color: #008000;">当然，使用iterator()方法来防止生成cache，意味着遍历同一个queryset时会重复执行查询。所以使</span>
     <span style="color: #008000;">#</span><span style="color: #008000;">用iterator()的时候要当心，确保你的代码在操作一个大的queryset时没有重复执行查询</span>
<span style="color: #000000;">
总结:
    queryset的cache是用于减少程序对数据库的查询，在通常的使用下会保证只有在需要的时候才会查询数据库。
使用exists()和iterator()方法可以优化程序对内存的使用。不过，由于它们并不会生成queryset cache，可能
会造成额外的数据库查询。</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p><strong><span style="color: #800080;">----------&gt;对象查询，单表条件查询，多表条件关联查询</span></strong></p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;acf49dba-875f-4b80-9dd7-9566de492e1a&#39;)"><img id="code_img_closed_acf49dba-875f-4b80-9dd7-9566de492e1a" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_acf49dba-875f-4b80-9dd7-9566de492e1a" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;acf49dba-875f-4b80-9dd7-9566de492e1a&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_acf49dba-875f-4b80-9dd7-9566de492e1a" class="cnblogs_code_hide">
<pre><span style="color: #008000;">#</span><span style="color: #008000;">--------------------对象形式的查找--------------------------</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> 正向查找</span>
    ret1=<span style="color: #000000;">models.Book.objects.first()
    </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(ret1.title)
    </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(ret1.price)
    </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(ret1.publisher)
    </span><span style="color: #0000ff;">print</span>(ret1.publisher.name)  <span style="color: #008000;">#</span><span style="color: #008000;">因为一对多的关系所以ret1.publisher是一个对象,而不是一个queryset集合</span>

    <span style="color: #008000;">#</span><span style="color: #008000;"> 反向查找</span>
    ret2=<span style="color: #000000;">models.Publish.objects.last()
    </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(ret2.name)
    </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(ret2.city)
    </span><span style="color: #008000;">#</span><span style="color: #008000;">如何拿到与它绑定的Book对象呢?</span>
    <span style="color: #0000ff;">print</span>(ret2.book_set.all()) <span style="color: #008000;">#</span><span style="color: #008000;">ret2.book_set是一个queryset集合</span>

<span style="color: #008000;">#</span><span style="color: #008000;">---------------了不起的双下划线(__)之单表条件查询----------------</span>

<span style="color: #008000;">#</span><span style="color: #008000;">    models.Tb1.objects.filter(id__lt=10, id__gt=1)   # 获取id大于1 且 小于10的值</span><span style="color: #008000;">
#
#</span><span style="color: #008000;">    models.Tb1.objects.filter(id__in=[11, 22, 33])   # 获取id等于11、22、33的数据</span><span style="color: #008000;">
#</span><span style="color: #008000;">    models.Tb1.objects.exclude(id__in=[11, 22, 33])  # not in</span><span style="color: #008000;">
#
#</span><span style="color: #008000;">    models.Tb1.objects.filter(name__contains="ven")</span><span style="color: #008000;">
#</span><span style="color: #008000;">    models.Tb1.objects.filter(name__icontains="ven") # icontains大小写不敏感</span><span style="color: #008000;">
#
#</span><span style="color: #008000;">    models.Tb1.objects.filter(id__range=[1, 2])   # 范围bettwen and</span><span style="color: #008000;">
#
#</span><span style="color: #008000;">    startswith，istartswith, endswith, iendswith,</span>

<span style="color: #008000;">#</span><span style="color: #008000;">----------------了不起的双下划线(__)之多表条件关联查询---------------</span>

<span style="color: #008000;">#</span><span style="color: #008000;"> 正向查找(条件)</span>

<span style="color: #008000;">#</span><span style="color: #008000;">     ret3=models.Book.objects.filter(title='Python').values('id')</span><span style="color: #008000;">
#</span><span style="color: #008000;">     print(ret3)#[{'id': 1}]</span>

      <span style="color: #008000;">#</span><span style="color: #008000;">正向查找(条件)之一对多</span>
<span style="color: #000000;">
      ret4</span>=models.Book.objects.filter(title=<span style="color: #800000;">'</span><span style="color: #800000;">Python</span><span style="color: #800000;">'</span>).values(<span style="color: #800000;">'</span><span style="color: #800000;">publisher__city</span><span style="color: #800000;">'</span><span style="color: #000000;">)
      </span><span style="color: #0000ff;">print</span>(ret4)  <span style="color: #008000;">#</span><span style="color: #008000;">[{'publisher__city': '北京'}]</span>

      <span style="color: #008000;">#</span><span style="color: #008000;">正向查找(条件)之多对多</span>
      ret5=models.Book.objects.filter(title=<span style="color: #800000;">'</span><span style="color: #800000;">Python</span><span style="color: #800000;">'</span>).values(<span style="color: #800000;">'</span><span style="color: #800000;">author__name</span><span style="color: #800000;">'</span><span style="color: #000000;">)
      </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(ret5)
      ret6</span>=models.Book.objects.filter(author__name=<span style="color: #800000;">"</span><span style="color: #800000;">alex</span><span style="color: #800000;">"</span>).values(<span style="color: #800000;">'</span><span style="color: #800000;">title</span><span style="color: #800000;">'</span><span style="color: #000000;">)
      </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(ret6)

      </span><span style="color: #008000;">#</span><span style="color: #008000;">注意</span>
      <span style="color: #008000;">#</span><span style="color: #008000;">正向查找的publisher__city或者author__name中的publisher,author是book表中绑定的字段</span>
      <span style="color: #008000;">#</span><span style="color: #008000;">一对多和多对多在这里用法没区别</span>

<span style="color: #008000;">#</span><span style="color: #008000;"> 反向查找(条件)</span>

    <span style="color: #008000;">#</span><span style="color: #008000;">反向查找之一对多:</span>
    ret8=models.Publisher.objects.filter(book__title=<span style="color: #800000;">'</span><span style="color: #800000;">Python</span><span style="color: #800000;">'</span>).values(<span style="color: #800000;">'</span><span style="color: #800000;">name</span><span style="color: #800000;">'</span><span style="color: #000000;">)
    </span><span style="color: #0000ff;">print</span>(ret8)<span style="color: #008000;">#</span><span style="color: #008000;">[{'name': '人大出版社'}]  注意,book__title中的book就是Publisher的关联表名</span>
<span style="color: #000000;">
    ret9</span>=models.Publisher.objects.filter(book__title=<span style="color: #800000;">'</span><span style="color: #800000;">Python</span><span style="color: #800000;">'</span>).values(<span style="color: #800000;">'</span><span style="color: #800000;">book__authors</span><span style="color: #800000;">'</span><span style="color: #000000;">)
    </span><span style="color: #0000ff;">print</span>(ret9)<span style="color: #008000;">#</span><span style="color: #008000;">[{'book__authors': 1}, {'book__authors': 2}]</span>

    <span style="color: #008000;">#</span><span style="color: #008000;">反向查找之多对多:</span>
    ret10=models.Author.objects.filter(book__title=<span style="color: #800000;">'</span><span style="color: #800000;">Python</span><span style="color: #800000;">'</span>).values(<span style="color: #800000;">'</span><span style="color: #800000;">name</span><span style="color: #800000;">'</span><span style="color: #000000;">)
    </span><span style="color: #0000ff;">print</span>(ret10)<span style="color: #008000;">#</span><span style="color: #008000;">[{'name': 'alex'}, {'name': 'alvin'}]</span>

    <span style="color: #008000;">#</span><span style="color: #008000;">注意</span>
    <span style="color: #008000;">#</span><span style="color: #008000;">正向查找的book__title中的book是表名Book</span>
    <span style="color: #008000;">#</span><span style="color: #008000;">一对多和多对多在这里用法没区别</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>注意：条件查询即与对象查询对应，是指在filter，values等方法中的通过__来明确查询条件。</p>
<p><strong><span style="color: #800080;">----------&gt;聚合查询和分组查询</span></strong></p>
<p><strong>&lt;1&gt; aggregate(*args,**kwargs):</strong></p>
<p>&nbsp;&nbsp; 通过对QuerySet进行计算，返回一个聚合值的字典。aggregate()中每一个参数都指定一个包含在字典中的返回值。即在查询集上生成聚合。</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;4009463d-9d85-4ac1-8d02-fdb9a8f17276&#39;)"><img id="code_img_closed_4009463d-9d85-4ac1-8d02-fdb9a8f17276" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_4009463d-9d85-4ac1-8d02-fdb9a8f17276" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;4009463d-9d85-4ac1-8d02-fdb9a8f17276&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_4009463d-9d85-4ac1-8d02-fdb9a8f17276" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">from</span> django.db.models <span style="color: #0000ff;">import</span><span style="color: #000000;"> Avg,Min,Sum,Max

从整个查询集生成统计值。比如，你想要计算所有在售书的平均价钱。Django的查询语法提供了一种方式描述所有
图书的集合。

</span>&gt;&gt;&gt; Book.objects.all().aggregate(Avg(<span style="color: #800000;">'</span><span style="color: #800000;">price</span><span style="color: #800000;">'</span><span style="color: #000000;">))
{</span><span style="color: #800000;">'</span><span style="color: #800000;">price__avg</span><span style="color: #800000;">'</span>: 34.35<span style="color: #000000;">}

aggregate()子句的参数描述了我们想要计算的聚合值，在这个例子中，是Book模型中price字段的平均值

aggregate()是QuerySet 的一个终止子句，意思是说，它返回一个包含一些键值对的字典。键的名称是聚合值的
标识符，值是计算出来的聚合值。键的名称是按照字段和聚合函数的名称自动生成出来的。如果你想要为聚合值指定
一个名称，可以向聚合子句提供它:
</span>&gt;&gt;&gt; Book.objects.aggregate(average_price=Avg(<span style="color: #800000;">'</span><span style="color: #800000;">price</span><span style="color: #800000;">'</span><span style="color: #000000;">))
{</span><span style="color: #800000;">'</span><span style="color: #800000;">average_price</span><span style="color: #800000;">'</span>: 34.35<span style="color: #000000;">}


如果你也想知道所有图书价格的最大值和最小值，可以这样查询：
</span>&gt;&gt;&gt; Book.objects.aggregate(Avg(<span style="color: #800000;">'</span><span style="color: #800000;">price</span><span style="color: #800000;">'</span>), Max(<span style="color: #800000;">'</span><span style="color: #800000;">price</span><span style="color: #800000;">'</span>), Min(<span style="color: #800000;">'</span><span style="color: #800000;">price</span><span style="color: #800000;">'</span><span style="color: #000000;">))
{</span><span style="color: #800000;">'</span><span style="color: #800000;">price__avg</span><span style="color: #800000;">'</span>: 34.35, <span style="color: #800000;">'</span><span style="color: #800000;">price__max</span><span style="color: #800000;">'</span>: Decimal(<span style="color: #800000;">'</span><span style="color: #800000;">81.20</span><span style="color: #800000;">'</span>), <span style="color: #800000;">'</span><span style="color: #800000;">price__min</span><span style="color: #800000;">'</span>: Decimal(<span style="color: #800000;">'</span><span style="color: #800000;">12.99</span><span style="color: #800000;">'</span>)}</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p><strong>&lt;2&gt; annotate(*args,**kwargs):</strong></p>
<p>&nbsp;&nbsp; 可以通过计算查询结果中每一个对象所关联的对象集合，从而得出总计值(也可以是平均值或总和)，即为查询集的每一项生成聚合。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 查询alex出的书总价格&nbsp;<strong><span style="color: #800080;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></strong></p>
<p>&nbsp; &nbsp; &nbsp; &nbsp;<img src="./Web框架Django_files/877318-20160728162237841-2135175019.png" alt="" width="613" height="106"></p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; 查询各个作者出的书的总价格,这里就涉及到分组了，分组条件是authors__name</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp;<img src="./Web框架Django_files/877318-20160728163440934-1014909443.png" alt="" width="658" height="93">&nbsp; &nbsp;&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 查询各个出版社最便宜的书价是多少</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp;<img src="./Web框架Django_files/877318-20160728163809997-549295571.png" alt="" width="668" height="92"></p>
<p><strong><span style="color: #800080;">----------&gt;F查询和Q查询</span></strong></p>
<p><strong><span style="color: #800080;"><span style="font-size: 13px; color: #333399;"><strong>仅仅靠单一的关键字参数查询已经很难满足查询要求。此时Django为我们提供了F和Q查询：</strong></span></span></strong></p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;80e60684-ba13-4b98-89f7-9b20eed4f270&#39;)"><img id="code_img_closed_80e60684-ba13-4b98-89f7-9b20eed4f270" class="code_img_closed" src="./Web框架Django_files/ContractedBlock.gif" alt=""><img id="code_img_opened_80e60684-ba13-4b98-89f7-9b20eed4f270" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;80e60684-ba13-4b98-89f7-9b20eed4f270&#39;,event)" src="./Web框架Django_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_80e60684-ba13-4b98-89f7-9b20eed4f270" class="cnblogs_code_hide">
<pre><span style="color: #008000;">#</span><span style="color: #008000;"> F 使用查询条件的值,专门取对象中某列值的操作</span>

    <span style="color: #008000;">#</span><span style="color: #008000;"> from django.db.models import F</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.update(num=F('num')+1)</span>


<span style="color: #008000;">#</span><span style="color: #008000;"> Q 构建搜索条件</span>
    <span style="color: #0000ff;">from</span> django.db.models <span style="color: #0000ff;">import</span><span style="color: #000000;"> Q

    </span><span style="color: #008000;">#</span><span style="color: #008000;">1 Q对象(django.db.models.Q)可以对关键字参数进行封装，从而更好地应用多个查询</span>
    q1=models.Book.objects.filter(Q(title__startswith=<span style="color: #800000;">'</span><span style="color: #800000;">P</span><span style="color: #800000;">'</span><span style="color: #000000;">)).all()
    </span><span style="color: #0000ff;">print</span>(q1)<span style="color: #008000;">#</span><span style="color: #008000;">[&lt;Book: Python&gt;, &lt;Book: Perl&gt;]</span>

    <span style="color: #008000;">#</span><span style="color: #008000;"> 2、可以组合使用&amp;,|操作符，当一个操作符是用于两个Q的对象,它产生一个新的Q对象。</span>
    Q(title__startswith=<span style="color: #800000;">'</span><span style="color: #800000;">P</span><span style="color: #800000;">'</span>) | Q(title__startswith=<span style="color: #800000;">'</span><span style="color: #800000;">J</span><span style="color: #800000;">'</span><span style="color: #000000;">)

    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 3、Q对象可以用~操作符放在前面表示否定，也可允许否定与不否定形式的组合</span>
    Q(title__startswith=<span style="color: #800000;">'</span><span style="color: #800000;">P</span><span style="color: #800000;">'</span>) | ~Q(pub_date__year=2005<span style="color: #000000;">)

    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 4、应用范围：</span>

    <span style="color: #008000;">#</span><span style="color: #008000;"> Each lookup function that takes keyword-arguments (e.g. filter(),</span>
    <span style="color: #008000;">#</span><span style="color: #008000;">  exclude(), get()) can also be passed one or more Q objects as</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> positional (not-named) arguments. If you provide multiple Q object</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> arguments to a lookup function, the arguments will be “AND”ed</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> together. For example:</span>
<span style="color: #000000;">
    Book.objects.get(
        Q(title__startswith</span>=<span style="color: #800000;">'</span><span style="color: #800000;">P</span><span style="color: #800000;">'</span><span style="color: #000000;">),
        Q(pub_date</span>=date(2005, 5, 2)) | Q(pub_date=date(2005, 5, 6<span style="color: #000000;">))
    )

    </span><span style="color: #008000;">#</span><span style="color: #008000;">sql:</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> SELECT * from polls WHERE question LIKE 'P%'</span>
    <span style="color: #008000;">#</span><span style="color: #008000;">     AND (pub_date = '2005-05-02' OR pub_date = '2005-05-06')</span>

    <span style="color: #008000;">#</span><span style="color: #008000;"> import datetime</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> e=datetime.date(2005,5,6)  #2005-05-06</span>

    <span style="color: #008000;">#</span><span style="color: #008000;"> 5、Q对象可以与关键字参数查询一起使用，不过一定要把Q对象放在关键字参数查询的前面。</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> 正确：</span>
<span style="color: #000000;">    Book.objects.get(
        Q(pub_date</span>=date(2005, 5, 2)) | Q(pub_date=date(2005, 5, 6<span style="color: #000000;">)),
        title__startswith</span>=<span style="color: #800000;">'</span><span style="color: #800000;">P</span><span style="color: #800000;">'</span><span style="color: #000000;">)
    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 错误：</span>
<span style="color: #000000;">    Book.objects.get(
        question__startswith</span>=<span style="color: #800000;">'</span><span style="color: #800000;">P</span><span style="color: #800000;">'</span><span style="color: #000000;">,
        Q(pub_date</span>=date(2005, 5, 2)) | Q(pub_date=date(2005, 5, 6)))</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h4>raw sql</h4>
<p>django中models的操作,也是调用了ORM框架来实现的,pymysql 或者mysqldb,所以我们也可以使用原生的SQL语句来操作数据库!</p>
<h3>九 admin的配置</h3>
<p>admin是django强大功能之一，它能共从数据库中读取数据，呈现在页面中，进行管理。默认情况下，它的功能已经非常强大，如果你不需要复杂的功能，它已经够用，但是有时候，一些特殊的功能还需要定制，比如搜索功能，下面这一系列文章就逐步深入介绍如何定制适合自己的admin应用。</p>
<p>如果你觉得英文界面不好用，可以在setting.py 文件中修改以下选项</p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_134957" class="syntaxhighlighter  python"><div class="toolbar"><span><a href="https://www.cnblogs.com/yuanchenqi/articles/6083427.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="python plain">LANGUAGE_CODE </code><code class="python keyword">=</code> <code class="python string">'en-us'</code>&nbsp; <code class="python comments">#LANGUAGE_CODE = 'zh-hans'</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><strong>一 &nbsp;认识ModelAdmin</strong></p>
<p>&nbsp; &nbsp;管理界面的定制类，如需扩展特定的model界面需从该类继承。</p>
<p><strong>二 注册medel类到admin的两种方式：</strong></p>
<p>&nbsp; &nbsp;&nbsp; &lt;1&gt; &nbsp; 使用register的方法</p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_396032" class="syntaxhighlighter  python"><div class="toolbar"><span><a href="https://www.cnblogs.com/yuanchenqi/articles/6083427.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="python plain">admin.site.register(Book,MyAdmin)</code></div></div></td></tr></tbody></table></div></div>
</div>
<p>&nbsp; &nbsp;&nbsp; &lt;2&gt; &nbsp; 使用register的装饰器</p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_264384" class="syntaxhighlighter  python"><div class="toolbar"><span><a href="https://www.cnblogs.com/yuanchenqi/articles/6083427.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="python decorator">@admin</code><code class="python plain">.register(Book)</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><strong>三 掌握一些常用的设置技巧</strong></p>
<ul>
<li>&nbsp; &nbsp; list_display: &nbsp;&nbsp;&nbsp; 指定要显示的字段</li>
<li>&nbsp; &nbsp; search_fields:&nbsp; 指定搜索的字段</li>
<li>&nbsp; &nbsp; list_filter:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 指定列表过滤器</li>
<li>&nbsp; &nbsp; ordering：&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 指定排序字段</li>
</ul>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./Web框架Django_files/copycode.gif" alt="复制代码"></a></span></div>
<pre><span style="color: #0000ff;">from</span> django.contrib <span style="color: #0000ff;">import</span><span style="color: #000000;"> admin
</span><span style="color: #0000ff;">from</span> app01.models <span style="color: #0000ff;">import</span> *
<span style="color: #008000;">#</span><span style="color: #008000;"> Register your models here.</span>

<span style="color: #008000;">#</span><span style="color: #008000;"> @admin.register(Book)#-----&gt;单给某个表加一个定制</span>
<span style="color: #0000ff;">class</span><span style="color: #000000;"> MyAdmin(admin.ModelAdmin):
    list_display </span>= (<span style="color: #800000;">"</span><span style="color: #800000;">title</span><span style="color: #800000;">"</span>,<span style="color: #800000;">"</span><span style="color: #800000;">price</span><span style="color: #800000;">"</span>,<span style="color: #800000;">"</span><span style="color: #800000;">publisher</span><span style="color: #800000;">"</span><span style="color: #000000;">)
    search_fields </span>= (<span style="color: #800000;">"</span><span style="color: #800000;">title</span><span style="color: #800000;">"</span>,<span style="color: #800000;">"</span><span style="color: #800000;">publisher</span><span style="color: #800000;">"</span><span style="color: #000000;">)
    list_filter </span>= (<span style="color: #800000;">"</span><span style="color: #800000;">publisher</span><span style="color: #800000;">"</span><span style="color: #000000;">,)
    ordering </span>= (<span style="color: #800000;">"</span><span style="color: #800000;">price</span><span style="color: #800000;">"</span><span style="color: #000000;">,)
    fieldsets </span>=<span style="color: #000000;">[
        (None,               {</span><span style="color: #800000;">'</span><span style="color: #800000;">fields</span><span style="color: #800000;">'</span>: [<span style="color: #800000;">'</span><span style="color: #800000;">title</span><span style="color: #800000;">'</span><span style="color: #000000;">]}),
        (</span><span style="color: #800000;">'</span><span style="color: #800000;">price information</span><span style="color: #800000;">'</span>, {<span style="color: #800000;">'</span><span style="color: #800000;">fields</span><span style="color: #800000;">'</span>: [<span style="color: #800000;">'</span><span style="color: #800000;">price</span><span style="color: #800000;">'</span>,<span style="color: #800000;">"</span><span style="color: #800000;">publisher</span><span style="color: #800000;">"</span>], <span style="color: #800000;">'</span><span style="color: #800000;">classes</span><span style="color: #800000;">'</span>: [<span style="color: #800000;">'</span><span style="color: #800000;">collapse</span><span style="color: #800000;">'</span><span style="color: #000000;">]}),
    ]

admin.site.register(Book,MyAdmin)
admin.site.register(Publish)
admin.site.register(Author)</span></pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./Web框架Django_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>&nbsp;</p>
<p>参考文献：http://www.admin10000.com/document/2220.html</p>
<p>&nbsp;</p></div><div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
<div id="BlogPostCategory"></div>
<div id="EntryTag"></div>
<div id="blog_post_info"><div id="green_channel">
        <a href="javascript:void(0);" id="green_channel_digg" onclick="DiggIt(6083427,cb_blogId,1);green_channel_success(this,&#39;谢谢推荐！&#39;);">好文要顶</a>
            <a id="green_channel_follow" onclick="follow(&#39;6d0ad0ce-3cb7-e511-9fc1-ac853d9f53cc&#39;);" href="javascript:void(0);">关注我</a>
    <a id="green_channel_favorite" onclick="AddToWz(cb_entryId);return false;" href="javascript:void(0);">收藏该文</a>
    <a id="green_channel_weibo" href="javascript:void(0);" title="分享至新浪微博" onclick="ShareToTsina()"><img src="./Web框架Django_files/icon_weibo_24.png" alt=""></a>
    <a id="green_channel_wechat" href="javascript:void(0);" title="分享至微信" onclick="shareOnWechat()"><img src="./Web框架Django_files/wechat.png" alt=""></a>
</div>
<div id="author_profile">
    <div id="author_profile_info" class="author_profile_info">
            <a href="http://home.cnblogs.com/u/yuanchenqi/" target="_blank"><img src="./Web框架Django_files/20160110101629.png" class="author_avatar" alt=""></a>
        <div id="author_profile_detail" class="author_profile_info">
            <a href="http://home.cnblogs.com/u/yuanchenqi/">Yuan先生</a><br>
            <a href="http://home.cnblogs.com/u/yuanchenqi/followees">关注 - 0</a><br>
            <a href="http://home.cnblogs.com/u/yuanchenqi/followers">粉丝 - 1961</a>
        </div>
    </div>
    <div class="clear"></div>
    <div id="author_profile_honor"></div>
    <div id="author_profile_follow">
                <a href="javascript:void(0);" onclick="follow(&#39;6d0ad0ce-3cb7-e511-9fc1-ac853d9f53cc&#39;);return false;">+加关注</a>
    </div>
</div>
<div id="div_digg">
    <div class="diggit" onclick="votePost(6083427,&#39;Digg&#39;)">
        <span class="diggnum" id="digg_count">15</span>
    </div>
    <div class="buryit" onclick="votePost(6083427,&#39;Bury&#39;)">
        <span class="burynum" id="bury_count">2</span>
    </div>
    <div class="clear"></div>
    <div class="diggword" id="digg_tips">
    </div>
</div>
<script type="text/javascript">
    currentDiggType = 0;
</script></div>
<div class="clear"></div>
<div id="post_next_prev"><a href="https://www.cnblogs.com/yuanchenqi/articles/6070667.html" class="p_n_p_prefix">« </a> 上一篇：<a href="https://www.cnblogs.com/yuanchenqi/articles/6070667.html" title="发布于2016-11-16 18:06">前端学习之jquery</a><br><a href="https://www.cnblogs.com/yuanchenqi/articles/6183600.html" class="p_n_p_prefix">» </a> 下一篇：<a href="https://www.cnblogs.com/yuanchenqi/articles/6183600.html" title="发布于2016-12-15 15:56">Mysql与sql语句</a><br></div>
</div>


		</div>
		<div class="postDesc">posted @ <span id="post-date">2016-11-20 20:36</span> <a href="https://www.cnblogs.com/yuanchenqi/">Yuan先生</a> 阅读(<span id="post_view_count">18371</span>) 评论(<span id="post_comment_count">9</span>) &nbsp;<a href="https://i.cnblogs.com/EditArticles.aspx?postid=6083427" rel="nofollow">编辑</a> <a href="https://www.cnblogs.com/yuanchenqi/articles/6083427.html#" onclick="AddToWz(6083427);return false;">收藏</a></div>
	</div>
	<script type="text/javascript">var allowComments=false,cb_blogId=262677,cb_entryId=6083427,cb_blogApp=currentBlogApp,cb_blogUserGuid='6d0ad0ce-3cb7-e511-9fc1-ac853d9f53cc',cb_entryCreatedDate='2016/11/20 20:36:00';loadViewCount(cb_entryId);var cb_postType=2;</script>
	
</div><!--end: topics 文章、评论容器-->
</div><a name="!comments"></a><div id="blog-comments-placeholder"><div id="comments_pager_top"></div>
<!--done-->
<br>
<div class="feedback_area_title">发表评论</div>
<div class="feedbackNoItems"></div>
	

		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="https://www.cnblogs.com/yuanchenqi/articles/6083427.html#3752536" class="layer">#1楼</a><a name="3752536" id="comment_anchor_3752536"></a> <span class="comment_date">2017-08-08 02:18</span> | <a id="a_comment_author_3752536" href="https://www.cnblogs.com/great-zhi/" target="_blank">great_zhi</a> <a href="http://msg.cnblogs.com/send/great_zhi" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3752536" class="blog_comment_body">比alex的好多了</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3752536,&#39;Digg&#39;,this)">支持(5)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3752536,&#39;Bury&#39;,this)">反对(0)</a></div><br>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="https://www.cnblogs.com/yuanchenqi/articles/6083427.html#3787151" class="layer">#2楼</a><a name="3787151" id="comment_anchor_3787151"></a> <span class="comment_date">2017-09-17 20:57</span> | <a id="a_comment_author_3787151" href="https://www.cnblogs.com/dengwei1/" target="_blank">西雅图的邂逅</a> <a href="http://msg.cnblogs.com/send/%E8%A5%BF%E9%9B%85%E5%9B%BE%E7%9A%84%E9%82%82%E9%80%85" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3787151" class="blog_comment_body">课讲的不错</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3787151,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3787151,&#39;Bury&#39;,this)">反对(0)</a></div><br>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="https://www.cnblogs.com/yuanchenqi/articles/6083427.html#3789141" class="layer">#3楼</a><a name="3789141" id="comment_anchor_3789141"></a> <span class="comment_date">2017-09-19 09:26</span> | <a id="a_comment_author_3789141" href="https://www.cnblogs.com/definenull/" target="_blank">define_null</a> <a href="http://msg.cnblogs.com/send/define_null" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3789141" class="blog_comment_body"><a href="https://www.cnblogs.com/yuanchenqi/articles/6083427.html#3752536" title="查看所回复的评论" onclick="commentManager.renderComments(0,50,3752536);">@</a>
great_zhi<br>敢黑我金角大王?</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3789141,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3789141,&#39;Bury&#39;,this)">反对(0)</a></div><br>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="https://www.cnblogs.com/yuanchenqi/articles/6083427.html#3789143" class="layer">#4楼</a><a name="3789143" id="comment_anchor_3789143"></a> <span class="comment_date">2017-09-19 09:29</span> | <a id="a_comment_author_3789143" href="https://www.cnblogs.com/great-zhi/" target="_blank">great_zhi</a> <a href="http://msg.cnblogs.com/send/great_zhi" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3789143" class="blog_comment_body"><a href="https://www.cnblogs.com/yuanchenqi/articles/6083427.html#3789141" title="查看所回复的评论" onclick="commentManager.renderComments(0,50,3789141);">@</a>
define_null<br>事实啊 他讲的太啰嗦了！我说的是事实！！！</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3789143,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3789143,&#39;Bury&#39;,this)">反对(0)</a></div><br>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="https://www.cnblogs.com/yuanchenqi/articles/6083427.html#3835658" class="layer">#5楼</a><a name="3835658" id="comment_anchor_3835658"></a> <span class="comment_date">2017-11-09 10:47</span> | <a id="a_comment_author_3835658" href="https://www.cnblogs.com/amang/" target="_blank">深以为然</a> <a href="http://msg.cnblogs.com/send/%E6%B7%B1%E4%BB%A5%E4%B8%BA%E7%84%B6" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3835658" class="blog_comment_body">支持一下</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3835658,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3835658,&#39;Bury&#39;,this)">反对(0)</a></div><br>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="https://www.cnblogs.com/yuanchenqi/articles/6083427.html#3836479" class="layer">#6楼</a><a name="3836479" id="comment_anchor_3836479"></a> <span class="comment_date">2017-11-10 03:30</span> | <a id="a_comment_author_3836479" href="http://home.cnblogs.com/u/1276397/" target="_blank">其修远兮666</a> <a href="http://msg.cnblogs.com/send/%E5%85%B6%E4%BF%AE%E8%BF%9C%E5%85%AE666" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3836479" class="blog_comment_body">课讲的真不错，逻辑进度都挺好的，您讲的视频看过的都懂了。谢谢！</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3836479,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3836479,&#39;Bury&#39;,this)">反对(0)</a></div><br>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="https://www.cnblogs.com/yuanchenqi/articles/6083427.html#3868493" class="layer">#7楼</a><a name="3868493" id="comment_anchor_3868493"></a> <span class="comment_date">2017-12-18 16:31</span> | <a id="a_comment_author_3868493" href="https://www.cnblogs.com/wj-1314/" target="_blank">战争热诚</a> <a href="http://msg.cnblogs.com/send/%E6%88%98%E4%BA%89%E7%83%AD%E8%AF%9A" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3868493" class="blog_comment_body">老师您好，我在学习您博客的第一部分，什么是web框架的时候，运行您博客的step1<div class="cnblogs_Highlighter sh-gutter"><div><div id="highlighter_979382" class="syntaxhighlighter  csharp"><div class="toolbar"><span><a href="https://www.cnblogs.com/yuanchenqi/articles/6083427.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="csharp keyword">from</code> <code class="csharp plain">wsgiref.simple_server import make_server</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="csharp plain">def application(environ, start_response):</code></div><div class="line number5 index4 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">start_response(</code><code class="csharp string">'200 OK'</code><code class="csharp plain">, [(</code><code class="csharp string">'Content-Type'</code><code class="csharp plain">, </code><code class="csharp string">'text/html'</code><code class="csharp plain">)])</code></div><div class="line number6 index5 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp keyword">return</code> <code class="csharp plain">[b</code><code class="csharp string">'&lt;h1&gt;Hello, web!&lt;/h1&gt;'</code><code class="csharp plain">]</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="csharp plain">httpd = make_server(</code><code class="csharp string">''</code><code class="csharp plain">, 8080, application)</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="csharp plain">print(</code><code class="csharp string">'Serving HTTP on port 8000...'</code><code class="csharp plain">)</code></div><div class="line number12 index11 alt1"><code class="csharp preprocessor"># 开始监听HTTP请求:</code></div><div class="line number13 index12 alt2"><code class="csharp plain">httpd.serve_forever()</code></div></div></td></tr></tbody></table></div></div></div><br><br>出现如下错误<br><br><div class="cnblogs_Highlighter sh-gutter"><div><div id="highlighter_461621" class="syntaxhighlighter  csharp"><div class="toolbar"><span><a href="https://www.cnblogs.com/yuanchenqi/articles/6083427.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="csharp plain">Traceback (most recent call last):</code></div><div class="line number2 index1 alt1"><code class="csharp spaces">&nbsp;&nbsp;</code><code class="csharp plain">File </code><code class="csharp string">"D:/pycode/老男孩全栈工程师教育/server3.py"</code><code class="csharp plain">, line 14, </code><code class="csharp keyword">in</code> <code class="csharp plain">&lt;module&gt;</code></div><div class="line number3 index2 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">httpd = make_server(host=</code><code class="csharp string">''</code><code class="csharp plain">,port=8888,app =application)</code></div><div class="line number4 index3 alt1"><code class="csharp spaces">&nbsp;&nbsp;</code><code class="csharp plain">File </code><code class="csharp string">"D:\python3\lib\wsgiref\simple_server.py"</code><code class="csharp plain">, line 153, </code><code class="csharp keyword">in</code> <code class="csharp plain">make_server</code></div><div class="line number5 index4 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">server = server_class((host, port), handler_class)</code></div><div class="line number6 index5 alt1"><code class="csharp spaces">&nbsp;&nbsp;</code><code class="csharp plain">File </code><code class="csharp string">"D:\python3\lib\socketserver.py"</code><code class="csharp plain">, line 453, </code><code class="csharp keyword">in</code> <code class="csharp plain">__init__</code></div><div class="line number7 index6 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">self.server_bind()</code></div><div class="line number8 index7 alt1"><code class="csharp spaces">&nbsp;&nbsp;</code><code class="csharp plain">File </code><code class="csharp string">"D:\python3\lib\wsgiref\simple_server.py"</code><code class="csharp plain">, line 50, </code><code class="csharp keyword">in</code> <code class="csharp plain">server_bind</code></div><div class="line number9 index8 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">HTTPServer.server_bind(self)</code></div><div class="line number10 index9 alt1"><code class="csharp spaces">&nbsp;&nbsp;</code><code class="csharp plain">File </code><code class="csharp string">"D:\python3\lib\http\server.py"</code><code class="csharp plain">, line 139, </code><code class="csharp keyword">in</code> <code class="csharp plain">server_bind</code></div><div class="line number11 index10 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">self.server_name = socket.getfqdn(host)</code></div><div class="line number12 index11 alt1"><code class="csharp spaces">&nbsp;&nbsp;</code><code class="csharp plain">File </code><code class="csharp string">"D:\python3\lib\socket.py"</code><code class="csharp plain">, line 673, </code><code class="csharp keyword">in</code> <code class="csharp plain">getfqdn</code></div><div class="line number13 index12 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">hostname, aliases, ipaddrs = gethostbyaddr(name)</code></div><div class="line number14 index13 alt1"><code class="csharp plain">UnicodeDecodeError: </code><code class="csharp string">'utf-8'</code> <code class="csharp plain">codec can't decode </code><code class="csharp keyword">byte</code> <code class="csharp plain">0xcd </code><code class="csharp keyword">in</code> <code class="csharp plain">position 0: invalid continuation </code><code class="csharp keyword">byte</code></div></div></td></tr></tbody></table></div></div></div><br><br><br>请问怎么解决</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3868493,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3868493,&#39;Bury&#39;,this)">反对(1)</a></div><span id="comment_3868493_avatar" style="display:none;">http://pic.cnblogs.com/face/1226410/20170825182409.png</span><br>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="https://www.cnblogs.com/yuanchenqi/articles/6083427.html#3884375" class="layer">#8楼</a><a name="3884375" id="comment_anchor_3884375"></a> <span class="comment_date">2018-01-08 16:06</span> | <a id="a_comment_author_3884375" href="https://www.cnblogs.com/pythonkids/" target="_blank">Alan_chow</a> <a href="http://msg.cnblogs.com/send/Alan_chow" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3884375" class="blog_comment_body">写的太好了，细致，实用。跳过了不少坑。</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3884375,&#39;Digg&#39;,this)">支持(2)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3884375,&#39;Bury&#39;,this)">反对(0)</a></div><br>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="https://www.cnblogs.com/yuanchenqi/articles/6083427.html#3889305" class="layer">#9楼</a><a name="3889305" id="comment_anchor_3889305"></a><span id="comment-maxId" style="display:none;">3889305</span><span id="comment-maxDate" style="display:none;">2018/1/15 16:43:29</span> <span class="comment_date">2018-01-15 16:43</span> | <a id="a_comment_author_3889305" href="https://www.cnblogs.com/lijianming/" target="_blank">雪竺轩</a> <a href="http://msg.cnblogs.com/send/%E9%9B%AA%E7%AB%BA%E8%BD%A9" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3889305" class="blog_comment_body">老师你博客的目录能开放吗</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3889305,&#39;Digg&#39;,this)">支持(18)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3889305,&#39;Bury&#39;,this)">反对(2)</a></div><span id="comment_3889305_avatar" style="display:none;">http://pic.cnblogs.com/face/1289523/20180131191206.png</span><br>
			</div>
		</div>
	<div id="comments_pager_bottom"></div></div><script type="text/javascript">var commentManager = new blogCommentManager();commentManager.renderComments(0);</script>
<div id="comment_form" class="commentform">
<a name="commentform"></a>
<div id="divCommentShow"></div>
<div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" onclick="return RefreshCommentList();" id="lnk_RefreshComments" runat="server" clientidmode="Static">刷新评论</a><a href="https://www.cnblogs.com/yuanchenqi/articles/6083427.html#" onclick="return RefreshPage();">刷新页面</a><a href="https://www.cnblogs.com/yuanchenqi/articles/6083427.html#top">返回顶部</a></div>
<div id="comment_form_container">（评论功能已被禁用）</div>
<div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
<div id="ad_t2"></div>
<div id="opt_under_post"></div>
<div id="cnblogs_c1" class="c_ad_block"></div>
<div id="under_post_news"><div class="itnews c_ad_block"><b>最新IT新闻</b>:<br> ·  <a href="https://news.cnblogs.com/n/609290/" target="_blank">亚马逊AI惹众怒：竟然自己学会了“重男轻女”</a><br> ·  <a href="https://news.cnblogs.com/n/609288/" target="_blank">深击|资本助推下快递普涨：前线博弈+体系失衡</a><br> ·  <a href="https://news.cnblogs.com/n/609287/" target="_blank">美团、小米均大跌10%再创上市新低 新股破发率上升</a><br> ·  <a href="https://news.cnblogs.com/n/609286/" target="_blank">招商银行周天虹：AI时代的分布式数据库是什么样的？</a><br> ·  <a href="https://news.cnblogs.com/n/609285/" target="_blank">国产手游侵权日本动漫《海贼王》 被判赔偿300万</a><br>» <a href="http://news.cnblogs.com/" title="IT新闻" target="_blank">更多新闻...</a></div></div>
<script async="async" src="./Web框架Django_files/gpt.js.下载"></script>
<script>
  var googletag = googletag || {};
  googletag.cmd = googletag.cmd || [];
</script>

<script>
  googletag.cmd.push(function() {
    googletag.defineSlot('/1090369/C2', [468, 60], 'div-gpt-ad-1539008685004-0').addService(googletag.pubads());
    googletag.pubads().enableSingleRequest();
    googletag.enableServices();
  });
</script>
<div id="cnblogs_c2" class="c_ad_block">
    <div id="div-gpt-ad-1539008685004-0" style="height:60px; width:468px;">
    <script>
    if (new Date() >= new Date(2018, 9, 13)) {
        googletag.cmd.push(function() { googletag.display('div-gpt-ad-1539008685004-0'); });
    }
    </script>
    </div>
</div>
<div id="under_post_kb"><div class="itnews c_ad_block" id="kb_block"><b>最新知识库文章</b>:<br><div id="kb_recent"> ·  <a href="https://kb.cnblogs.com/page/606682/" target="_blank">为什么说 Java 程序员必须掌握 Spring Boot ？</a><br> ·  <a href="https://kb.cnblogs.com/page/606645/" target="_blank">在学习中，有一个比掌握知识更重要的能力</a><br> ·  <a href="https://kb.cnblogs.com/page/603663/" target="_blank">如何招到一个靠谱的程序员</a><br> ·  <a href="https://kb.cnblogs.com/page/573614/" target="_blank">一个故事看懂“区块链”</a><br> ·  <a href="https://kb.cnblogs.com/page/603697/" target="_blank">被踢出去的用户</a><br></div>» <a href="https://kb.cnblogs.com/" target="_blank">更多知识库文章...</a></div></div>
<div id="HistoryToday" class="c_ad_block"></div>
<script type="text/javascript">
    fixPostBody();
    setTimeout(function () { incrementViewCount(cb_entryId); }, 50);
    deliverAdT2();
    deliverAdC1();
    deliverAdC2();    
    loadNewsAndKb();
    loadBlogSignature();
    LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
    GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate, cb_postType);
    loadOptUnderPost();
    GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);   
</script>
</div>


	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->

	<div id="sideBar">
		<div id="sideBarMain">
			
			<div id="calendar"><div id="blog-calendar" style="display:none"></div><script type="text/javascript">loadBlogDefaultCalendar();</script></div>
			
			<div id="leftcontentcontainer">
				<div id="blog-sidecolumn"><div id="sidebar_search" class="sidebar-block"></div></div><script type="text/javascript">loadBlogSideColumn();</script>
			</div>
			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	</div><!--end: main -->
	<div class="clear"></div>
	<div id="footer">
		
<!--done-->
Copyright ©2018 Yuan先生
	</div><!--end: footer -->
</div><!--end: home 自定义的最大容器 -->
<!--PageEndHtml Block Begin-->
<script language="javascript" type="text/javascript">
//生成目录索引列表
function GenerateContentList()
{
  var jquery_h1_list = $('#cnblogs_post_body h1').not('.catListTitle').not('#blogTitle h1');//如果你的章节标题不是h4,只需要将这里的h4换掉即可
  if(jquery_h1_list.length>0)
  {
    var content = '<a name="_labelTop"></a>';
    content	+= '<div id="navCategory">';
    content	+= '<p style="font-size:25px;color:#EE1289;"><i>知识预览</i></p>';
    content	+= '<ul id="sortChapter">';
    for(var i =0;i<jquery_h1_list.length;i++)
    {
      var go_to_top = '<div style="text-align: right"><a href="#_labelTop">回到顶部</a><a name="_label' + i + '"></a></div>';
      $(jquery_h1_list[i]).before(go_to_top);
      var li_content = '<li><a href="#_label' + i + '"style="color: #003366;text-decoration:none;font-size:18px">' + $(jquery_h1_list[i]).text() + '</a></li>';
      content += li_content;
    }
    content	+= '</ul>';
    content	+= '</div>';
    if($('#cnblogs_post_body').length != 0 )
    {
      $($('#cnblogs_post_body')[0]).prepend(content);
    }
  }	
}
GenerateContentList();




$('#Header1_HeaderTitle').attr('href','https://i.cnblogs.com/EditArticles.aspx')

</script>
<!--PageEndHtml Block End-->


</body></html>